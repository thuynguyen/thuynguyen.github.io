function encode64(input){for(var chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",i=0,l=input.length,key="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";l>i;)chr1=input.charCodeAt(i++),chr2=input.charCodeAt(i++),chr3=input.charCodeAt(i++),enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+key.charAt(enc1)+key.charAt(enc2)+key.charAt(enc3)+key.charAt(enc4);return output}!function(e,t){function M(e){var t=e.length,n=b.type(e);return b.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}function F(e){var t=_[e]={};return b.each(e.match(w)||[],function(e,n){t[n]=!0}),t}function P(e,n,r,i){if(b.acceptData(e)){var o,a,s=b.expando,u="string"==typeof n,l=e.nodeType,p=l?b.cache:e,f=l?e[s]:e[s]&&s;if(f&&p[f]&&(i||p[f].data)||!u||r!==t)return f||(l?e[s]=f=c.pop()||b.guid++:f=s),p[f]||(p[f]={},l||(p[f].toJSON=b.noop)),("object"==typeof n||"function"==typeof n)&&(i?p[f]=b.extend(p[f],n):p[f].data=b.extend(p[f].data,n)),o=p[f],i||(o.data||(o.data={}),o=o.data),r!==t&&(o[b.camelCase(n)]=r),u?(a=o[n],null==a&&(a=o[b.camelCase(n)])):a=o,a}}function R(e,t,n){if(b.acceptData(e)){var r,i,o,a=e.nodeType,s=a?b.cache:e,u=a?e[b.expando]:b.expando;if(s[u]){if(t&&(o=n?s[u]:s[u].data)){b.isArray(t)?t=t.concat(b.map(t,b.camelCase)):t in o?t=[t]:(t=b.camelCase(t),t=t in o?[t]:t.split(" "));for(r=0,i=t.length;i>r;r++)delete o[t[r]];if(!(n?$:b.isEmptyObject)(o))return}(n||(delete s[u].data,$(s[u])))&&(a?b.cleanData([e],!0):b.support.deleteExpando||s!=s.window?delete s[u]:s[u]=null)}}}function W(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(B,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:O.test(r)?b.parseJSON(r):r}catch(o){}b.data(e,n,r)}else r=t}return r}function $(e){var t;for(t in e)if(("data"!==t||!b.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function it(){return!0}function ot(){return!1}function pt(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function ft(e,t,n){if(t=t||0,b.isFunction(t))return b.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return b.grep(e,function(e){return e===t===n});if("string"==typeof t){var r=b.grep(e,function(e){return 1===e.nodeType});if(ut.test(t))return b.filter(t,r,!n);t=b.filter(t,r)}return b.grep(e,function(e){return b.inArray(e,t)>=0===n})}function dt(e){var t=ht.split("|"),n=e.createDocumentFragment();if(n.createElement)for(;t.length;)n.createElement(t.pop());return n}function Lt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function Ht(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function qt(e){var t=Et.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Mt(e,t){for(var n,r=0;null!=(n=e[r]);r++)b._data(n,"globalEval",!t||b._data(t[r],"globalEval"))}function _t(e,t){if(1===t.nodeType&&b.hasData(e)){var n,r,i,o=b._data(e),a=b._data(t,o),s=o.events;if(s){delete a.handle,a.events={};for(n in s)for(r=0,i=s[n].length;i>r;r++)b.event.add(t,n,s[n][r])}a.data&&(a.data=b.extend({},a.data))}}function Ft(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!b.support.noCloneEvent&&t[b.expando]){i=b._data(t);for(r in i.events)b.removeEvent(t,r,i.handle);t.removeAttribute(b.expando)}"script"===n&&t.text!==e.text?(Ht(t).text=e.text,qt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),b.support.html5Clone&&e.innerHTML&&!b.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Nt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function Ot(e,n){var r,o,a=0,s=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!s)for(s=[],r=e.childNodes||e;null!=(o=r[a]);a++)!n||b.nodeName(o,n)?s.push(o):b.merge(s,Ot(o,n));return n===t||n&&b.nodeName(e,n)?b.merge([e],s):s}function Bt(e){Nt.test(e.type)&&(e.defaultChecked=e.checked)}function tn(e,t){if(t in e)return t;for(var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;i--;)if(t=en[i]+n,t in e)return t;return r}function nn(e,t){return e=t||e,"none"===b.css(e,"display")||!b.contains(e.ownerDocument,e)}function rn(e,t){for(var n,r,i,o=[],a=0,s=e.length;s>a;a++)r=e[a],r.style&&(o[a]=b._data(r,"olddisplay"),n=r.style.display,t?(o[a]||"none"!==n||(r.style.display=""),""===r.style.display&&nn(r)&&(o[a]=b._data(r,"olddisplay",un(r.nodeName)))):o[a]||(i=nn(r),(n&&"none"!==n||!i)&&b._data(r,"olddisplay",i?n:b.css(r,"display"))));for(a=0;s>a;a++)r=e[a],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[a]||"":"none"));return e}function on(e,t,n){var r=Vt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function an(e,t,n,r,i){for(var o=n===(r?"border":"content")?4:"width"===t?1:0,a=0;4>o;o+=2)"margin"===n&&(a+=b.css(e,n+Zt[o],!0,i)),r?("content"===n&&(a-=b.css(e,"padding"+Zt[o],!0,i)),"margin"!==n&&(a-=b.css(e,"border"+Zt[o]+"Width",!0,i))):(a+=b.css(e,"padding"+Zt[o],!0,i),"padding"!==n&&(a+=b.css(e,"border"+Zt[o]+"Width",!0,i)));return a}function sn(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,o=Rt(e),a=b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,o);if(0>=i||null==i){if(i=Wt(e,t,o),(0>i||null==i)&&(i=e.style[t]),Yt.test(i))return i;r=a&&(b.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+an(e,t,n||(a?"border":"content"),r,o)+"px"}function un(e){var t=o,n=Gt[e];return n||(n=ln(e,t),"none"!==n&&n||(Pt=(Pt||b("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(Pt[0].contentWindow||Pt[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=ln(e,t),Pt.detach()),Gt[e]=n),n}function ln(e,t){var n=b(t.createElement(e)).appendTo(t.body),r=b.css(n[0],"display");return n.remove(),r}function gn(e,t,n,r){var i;if(b.isArray(t))b.each(t,function(t,i){n||pn.test(e)?r(e,i):gn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==b.type(t))r(e,t);else for(i in t)gn(e+"["+i+"]",t[i],n,r)}function Hn(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(w)||[];if(b.isFunction(n))for(;r=o[i++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function qn(e,n,r,i){function s(u){var l;return o[u]=!0,b.each(e[u]||[],function(e,u){var c=u(n,r,i);return"string"!=typeof c||a||o[c]?a?!(l=c):t:(n.dataTypes.unshift(c),s(c),!1)}),l}var o={},a=e===jn;return s(n.dataTypes[0])||!o["*"]&&s("*")}function Mn(e,n){var r,i,o=b.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((o[i]?e:r||(r={}))[i]=n[i]);return r&&b.extend(!0,e,r),e}function _n(e,n,r){var i,o,a,s,u=e.contents,l=e.dataTypes,c=e.responseFields;for(s in c)s in r&&(n[c[s]]=r[s]);for(;"*"===l[0];)l.shift(),o===t&&(o=e.mimeType||n.getResponseHeader("Content-Type"));if(o)for(s in u)if(u[s]&&u[s].test(o)){l.unshift(s);break}if(l[0]in r)a=l[0];else{for(s in r){if(!l[0]||e.converters[s+" "+l[0]]){a=s;break}i||(i=s)}a=a||i}return a?(a!==l[0]&&l.unshift(a),r[a]):t}function Fn(e,t){var n,r,i,o,a={},s=0,u=e.dataTypes.slice(),l=u[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u[1])for(i in e.converters)a[i.toLowerCase()]=e.converters[i];for(;r=u[++s];)if("*"!==r){if("*"!==l&&l!==r){if(i=a[l+" "+r]||a["* "+r],!i)for(n in a)if(o=n.split(" "),o[1]===r&&(i=a[l+" "+o[0]]||a["* "+o[0]])){i===!0?i=a[n]:a[n]!==!0&&(r=o[0],u.splice(s--,0,r));break}if(i!==!0)if(i&&e["throws"])t=i(t);else try{t=i(t)}catch(c){return{state:"parsererror",error:i?c:"No conversion from "+l+" to "+r}}}l=r}return{state:"success",data:t}}function In(){try{return new e.XMLHttpRequest}catch(t){}}function zn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function Kn(){return setTimeout(function(){Xn=t}),Xn=b.now()}function Zn(e,t){b.each(t,function(t,n){for(var r=(Qn[t]||[]).concat(Qn["*"]),i=0,o=r.length;o>i;i++)if(r[i].call(e,t,n))return})}function er(e,t,n){var r,i,o=0,a=Gn.length,s=b.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;for(var t=Xn||Kn(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,o=1-r,a=0,u=l.tweens.length;u>a;a++)l.tweens[a].run(o);return s.notifyWith(e,[l,o,n]),1>o&&u?n:(s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:b.extend({},t),opts:b.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Kn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=b.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)l.tweens[n].run(1);return t?s.resolveWith(e,[l,t]):s.rejectWith(e,[l,t]),this}}),c=l.props;for(tr(c,l.opts.specialEasing);a>o;o++)if(r=Gn[o].call(l,e,c,l.opts))return r;return Zn(l,c),b.isFunction(l.opts.start)&&l.opts.start.call(e,l),b.fx.timer(b.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function tr(e,t){var n,r,i,o,a;for(i in e)if(r=b.camelCase(i),o=t[r],n=e[i],b.isArray(n)&&(o=n[1],n=e[i]=n[0]),i!==r&&(e[r]=n,delete e[i]),a=b.cssHooks[r],a&&"expand"in a){n=a.expand(n),delete e[r];for(i in n)i in e||(e[i]=n[i],t[i]=o)}else t[r]=o}function nr(e,t,n){var r,i,o,a,s,u,l,c,p,f=this,d=e.style,h={},g=[],m=e.nodeType&&nn(e);n.queue||(c=b._queueHooks(e,"fx"),null==c.unqueued&&(c.unqueued=0,p=c.empty.fire,c.empty.fire=function(){c.unqueued||p()}),c.unqueued++,f.always(function(){f.always(function(){c.unqueued--,b.queue(e,"fx").length||c.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[d.overflow,d.overflowX,d.overflowY],"inline"===b.css(e,"display")&&"none"===b.css(e,"float")&&(b.support.inlineBlockNeedsLayout&&"inline"!==un(e.nodeName)?d.zoom=1:d.display="inline-block")),n.overflow&&(d.overflow="hidden",b.support.shrinkWrapBlocks||f.always(function(){d.overflow=n.overflow[0],d.overflowX=n.overflow[1],d.overflowY=n.overflow[2]}));for(i in t)if(a=t[i],Vn.exec(a)){if(delete t[i],u=u||"toggle"===a,a===(m?"hide":"show"))continue;g.push(i)}if(o=g.length){s=b._data(e,"fxshow")||b._data(e,"fxshow",{}),"hidden"in s&&(m=s.hidden),u&&(s.hidden=!m),m?b(e).show():f.done(function(){b(e).hide()}),f.done(function(){var t;b._removeData(e,"fxshow");for(t in h)b.style(e,t,h[t])});for(i=0;o>i;i++)r=g[i],l=f.createTween(r,m?s[r]:0),h[r]=s[r]||b.style(e,r),r in s||(s[r]=l.start,m&&(l.end=l.start,l.start="width"===r||"height"===r?1:0))}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}function ir(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=Zt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function or(e){return b.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var n,r,i=typeof t,o=e.document,a=e.location,s=e.jQuery,u=e.$,l={},c=[],p="1.9.1",f=c.concat,d=c.push,h=c.slice,g=c.indexOf,m=l.toString,y=l.hasOwnProperty,v=p.trim,b=function(e,t){return new b.fn.init(e,t,r)},x=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,w=/\S+/g,T=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,N=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,k=/^[\],:{}\s]*$/,E=/(?:^|:|,)(?:\s*\[)+/g,S=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,A=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,j=/^-ms-/,D=/-([\da-z])/gi,L=function(e,t){return t.toUpperCase()},H=function(e){(o.addEventListener||"load"===e.type||"complete"===o.readyState)&&(q(),b.ready())},q=function(){o.addEventListener?(o.removeEventListener("DOMContentLoaded",H,!1),e.removeEventListener("load",H,!1)):(o.detachEvent("onreadystatechange",H),e.detachEvent("onload",H))};b.fn=b.prototype={jquery:p,constructor:b,init:function(e,n,r){var i,a;if(!e)return this;if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:N.exec(e),!i||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){if(n=n instanceof b?n[0]:n,b.merge(this,b.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:o,!0)),C.test(i[1])&&b.isPlainObject(n))for(i in n)b.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}if(a=o.getElementById(i[2]),a&&a.parentNode){if(a.id!==i[2])return r.find(e);this.length=1,this[0]=a}return this.context=o,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):b.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),b.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return h.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=b.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return b.each(this,e,t)},ready:function(e){return b.ready.promise().done(e),this},slice:function(){return this.pushStack(h.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(b.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:d,sort:[].sort,splice:[].splice},b.fn.init.prototype=b.fn,b.extend=b.fn.extend=function(){var e,n,r,i,o,a,s=arguments[0]||{},u=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},u=2),"object"==typeof s||b.isFunction(s)||(s={}),l===u&&(s=this,--u);l>u;u++)if(null!=(o=arguments[u]))for(i in o)e=s[i],r=o[i],s!==r&&(c&&r&&(b.isPlainObject(r)||(n=b.isArray(r)))?(n?(n=!1,a=e&&b.isArray(e)?e:[]):a=e&&b.isPlainObject(e)?e:{},s[i]=b.extend(c,a,r)):r!==t&&(s[i]=r));return s},b.extend({noConflict:function(t){return e.$===b&&(e.$=u),t&&e.jQuery===b&&(e.jQuery=s),b},isReady:!1,readyWait:1,holdReady:function(e){e?b.readyWait++:b.ready(!0)},ready:function(e){if(e===!0?!--b.readyWait:!b.isReady){if(!o.body)return setTimeout(b.ready);b.isReady=!0,e!==!0&&--b.readyWait>0||(n.resolveWith(o,[b]),b.fn.trigger&&b(o).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===b.type(e)},isArray:Array.isArray||function(e){return"array"===b.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[m.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==b.type(e)||e.nodeType||b.isWindow(e))return!1;try{if(e.constructor&&!y.call(e,"constructor")&&!y.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||y.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||o;var r=C.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=b.buildFragment([e],t,i),i&&b(i).remove(),b.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=b.trim(n),n&&k.test(n.replace(S,"@").replace(A,"]").replace(E,"")))?Function("return "+n)():(b.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(o){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||b.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&b.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(j,"ms-").replace(D,L)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,a=M(e);if(n){if(a)for(;o>i&&(r=t.apply(e[i],n),r!==!1);i++);else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(a)for(;o>i&&(r=t.call(e[i],i,e[i]),r!==!1);i++);else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:v&&!v.call("﻿ ")?function(e){return null==e?"":v.call(e)}:function(e){return null==e?"":(e+"").replace(T,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(M(Object(e))?b.merge(n,"string"==typeof e?[e]:e):d.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(g)return g.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,o=0;if("number"==typeof r)for(;r>o;o++)e[i++]=n[o];else for(;n[o]!==t;)e[i++]=n[o++];return e.length=i,e},grep:function(e,t,n){var r,i=[],o=0,a=e.length;for(n=!!n;a>o;o++)r=!!t(e[o],o),n!==r&&i.push(e[o]);return i},map:function(e,t,n){var r,i=0,o=e.length,a=M(e),s=[];if(a)for(;o>i;i++)r=t(e[i],i,n),null!=r&&(s[s.length]=r);else for(i in e)r=t(e[i],i,n),null!=r&&(s[s.length]=r);return f.apply([],s)},guid:1,proxy:function(e,n){var r,i,o;return"string"==typeof n&&(o=e[n],n=e,e=o),b.isFunction(e)?(r=h.call(arguments,2),i=function(){return e.apply(n||this,r.concat(h.call(arguments)))},i.guid=e.guid=e.guid||b.guid++,i):t},access:function(e,n,r,i,o,a,s){var u=0,l=e.length,c=null==r;if("object"===b.type(r)){o=!0;for(u in r)b.access(e,n,u,r[u],!0,a,s)}else if(i!==t&&(o=!0,b.isFunction(i)||(s=!0),c&&(s?(n.call(e,i),n=null):(c=n,n=function(e,t,n){return c.call(b(e),n)})),n))for(;l>u;u++)n(e[u],r,s?i:i.call(e[u],u,n(e[u],r)));return o?e:c?n.call(e):l?n(e[0],r):a},now:function(){return(new Date).getTime()}}),b.ready.promise=function(t){if(!n)if(n=b.Deferred(),"complete"===o.readyState)setTimeout(b.ready);else if(o.addEventListener)o.addEventListener("DOMContentLoaded",H,!1),e.addEventListener("load",H,!1);else{o.attachEvent("onreadystatechange",H),e.attachEvent("onload",H);var r=!1;try{r=null==e.frameElement&&o.documentElement}catch(i){}r&&r.doScroll&&function a(){if(!b.isReady){try{r.doScroll("left")}catch(e){return setTimeout(a,50)}q(),b.ready()}}()}return n.promise(t)},b.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()}),r=b(o);var _={};b.Callbacks=function(e){e="string"==typeof e?_[e]||F(e):b.extend({},e);var n,r,i,o,a,s,u=[],l=!e.once&&[],c=function(t){for(r=e.memory&&t,i=!0,a=s||0,s=0,o=u.length,n=!0;u&&o>a;a++)if(u[a].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,u&&(l?l.length&&c(l.shift()):r?u=[]:p.disable())},p={add:function(){if(u){var t=u.length;!function i(t){b.each(t,function(t,n){var r=b.type(n);"function"===r?e.unique&&p.has(n)||u.push(n):n&&n.length&&"string"!==r&&i(n)})}(arguments),n?o=u.length:r&&(s=t,c(r))}return this},remove:function(){return u&&b.each(arguments,function(e,t){for(var r;(r=b.inArray(t,u,r))>-1;)u.splice(r,1),n&&(o>=r&&o--,a>=r&&a--)}),this},has:function(e){return e?b.inArray(e,u)>-1:!(!u||!u.length)},empty:function(){return u=[],this},disable:function(){return u=l=r=t,this},disabled:function(){return!u},lock:function(){return l=t,r||p.disable(),this},locked:function(){return!l},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!u||i&&!l||(n?l.push(t):c(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!i}};return p},b.extend({Deferred:function(e){var t=[["resolve","done",b.Callbacks("once memory"),"resolved"],["reject","fail",b.Callbacks("once memory"),"rejected"],["notify","progress",b.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return b.Deferred(function(n){b.each(t,function(t,o){var a=o[0],s=b.isFunction(e[t])&&e[t];i[o[1]](function(){var e=s&&s.apply(this,arguments);e&&b.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[a+"With"](this===r?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?b.extend(e,r):r}},i={};return r.pipe=r.then,b.each(t,function(e,o){var a=o[2],s=o[3];r[o[1]]=a.add,s&&a.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=a.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var s,u,l,t=0,n=h.call(arguments),r=n.length,i=1!==r||e&&b.isFunction(e.promise)?r:0,o=1===i?e:b.Deferred(),a=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?h.call(arguments):r,n===s?o.notifyWith(t,n):--i||o.resolveWith(t,n)}};if(r>1)for(s=Array(r),u=Array(r),l=Array(r);r>t;t++)n[t]&&b.isFunction(n[t].promise)?n[t].promise().done(a(t,l,n)).fail(o.reject).progress(a(t,u,s)):--i;return i||o.resolveWith(l,n),o.promise()}}),b.support=function(){var t,n,r,a,s,u,l,c,p,f,d=o.createElement("div");if(d.setAttribute("className","t"),d.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=d.getElementsByTagName("*"),r=d.getElementsByTagName("a")[0],!n||!r||!n.length)return{};s=o.createElement("select"),l=s.appendChild(o.createElement("option")),a=d.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==d.className,leadingWhitespace:3===d.firstChild.nodeType,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:"/a"===r.getAttribute("href"),opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:!!a.value,optSelected:l.selected,enctype:!!o.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==o.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===o.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},a.checked=!0,t.noCloneChecked=a.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!l.disabled;try{delete d.test}catch(h){t.deleteExpando=!1}a=o.createElement("input"),a.setAttribute("value",""),t.input=""===a.getAttribute("value"),a.value="t",a.setAttribute("type","radio"),t.radioValue="t"===a.value,a.setAttribute("checked","t"),a.setAttribute("name","t"),u=o.createDocumentFragment(),u.appendChild(a),t.appendChecked=a.checked,t.checkClone=u.cloneNode(!0).cloneNode(!0).lastChild.checked,d.attachEvent&&(d.attachEvent("onclick",function(){t.noCloneEvent=!1}),d.cloneNode(!0).click());for(f in{submit:!0,change:!0,focusin:!0})d.setAttribute(c="on"+f,"t"),t[f+"Bubbles"]=c in e||d.attributes[c].expando===!1;return d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===d.style.backgroundClip,b(function(){var n,r,a,s="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",u=o.getElementsByTagName("body")[0];u&&(n=o.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",u.appendChild(n).appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",a=d.getElementsByTagName("td"),a[0].style.cssText="padding:0;margin:0;border:0;display:none",p=0===a[0].offsetHeight,a[0].style.display="",a[1].style.display="none",t.reliableHiddenOffsets=p&&0===a[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===d.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==u.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(d,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(d,null)||{width:"4px"}).width,r=d.appendChild(o.createElement("div")),r.style.cssText=d.style.cssText=s,r.style.marginRight=r.style.width="0",d.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof d.style.zoom!==i&&(d.innerHTML="",d.style.cssText=s+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.innerHTML="<div></div>",d.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==d.offsetWidth,t.inlineBlockNeedsLayout&&(u.style.zoom=1)),u.removeChild(n),n=d=a=r=null)}),n=s=u=l=r=a=null,t}();var O=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,B=/([A-Z])/g;b.extend({cache:{},expando:"jQuery"+(p+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?b.cache[e[b.expando]]:e[b.expando],!!e&&!$(e)},data:function(e,t,n){return P(e,t,n)},removeData:function(e,t){return R(e,t)},_data:function(e,t,n){return P(e,t,n,!0)},_removeData:function(e,t){return R(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&b.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),b.fn.extend({data:function(e,n){var r,i,o=this[0],a=0,s=null;if(e===t){if(this.length&&(s=b.data(o),1===o.nodeType&&!b._data(o,"parsedAttrs"))){for(r=o.attributes;r.length>a;a++)i=r[a].name,i.indexOf("data-")||(i=b.camelCase(i.slice(5)),W(o,i,s[i]));b._data(o,"parsedAttrs",!0)}return s}return"object"==typeof e?this.each(function(){b.data(this,e)}):b.access(this,function(n){return n===t?o?W(o,e,b.data(o,e)):null:(this.each(function(){b.data(this,e,n)}),t)},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){b.removeData(this,e)})}}),b.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=b._data(e,n),r&&(!i||b.isArray(r)?i=b._data(e,n,b.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=b.queue(e,t),r=n.length,i=n.shift(),o=b._queueHooks(e,t),a=function(){b.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),o.cur=i,i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return b._data(e,n)||b._data(e,n,{empty:b.Callbacks("once memory").add(function(){b._removeData(e,t+"queue"),b._removeData(e,n)})})}}),b.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?b.queue(this[0],e):n===t?this:this.each(function(){var t=b.queue(this,e,n);b._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&b.dequeue(this,e)})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},delay:function(e,t){return e=b.fx?b.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,o=b.Deferred(),a=this,s=this.length,u=function(){--i||o.resolveWith(a,[a])};for("string"!=typeof e&&(n=e,e=t),e=e||"fx";s--;)r=b._data(a[s],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(u));return u(),o.promise(n)}});var I,z,X=/[\t\r\n]/g,U=/\r/g,V=/^(?:input|select|textarea|button|object)$/i,Y=/^(?:a|area)$/i,J=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,G=/^(?:checked|selected)$/i,Q=b.support.getSetAttribute,K=b.support.input;b.fn.extend({attr:function(e,t){return b.access(this,b.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})},prop:function(e,t){return b.access(this,b.prop,e,t,arguments.length>1)},removeProp:function(e){return e=b.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,a=0,s=this.length,u="string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).addClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):" ")){for(o=0;i=t[o++];)0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=b.trim(r)}return this},removeClass:function(e){var t,n,r,i,o,a=0,s=this.length,u=0===arguments.length||"string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).removeClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):"")){for(o=0;i=t[o++];)for(;r.indexOf(" "+i+" ")>=0;)r=r.replace(" "+i+" "," ");n.className=e?b.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e,r="boolean"==typeof t;return this.each(b.isFunction(e)?function(n){b(this).toggleClass(e.call(this,n,this.className,t),t)}:function(){if("string"===n)for(var o,a=0,s=b(this),u=t,l=e.match(w)||[];o=l[a++];)u=r?u:!s.hasClass(o),s[u?"addClass":"removeClass"](o);else(n===i||"boolean"===n)&&(this.className&&b._data(this,"__className__",this.className),this.className=this.className||e===!1?"":b._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,r=this.length;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(X," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,o=this[0];return arguments.length?(i=b.isFunction(e),this.each(function(n){var o,a=b(this);1===this.nodeType&&(o=i?e.call(this,n,a.val()):e,null==o?o="":"number"==typeof o?o+="":b.isArray(o)&&(o=b.map(o,function(e){return null==e?"":e+""})),r=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()],r&&"set"in r&&r.set(this,o,"value")!==t||(this.value=o))})):o?(r=b.valHooks[o.type]||b.valHooks[o.nodeName.toLowerCase()],r&&"get"in r&&(n=r.get(o,"value"))!==t?n:(n=o.value,"string"==typeof n?n.replace(U,""):null==n?"":n)):void 0}}),b.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){for(var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type||0>i,a=o?null:[],s=o?i+1:r.length,u=0>i?s:o?i:0;s>u;u++)if(n=r[u],!(!n.selected&&u!==i||(b.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&b.nodeName(n.parentNode,"optgroup"))){if(t=b(n).val(),o)return t;a.push(t)}return a},set:function(e,t){var n=b.makeArray(t);return b(e).find("option").each(function(){this.selected=b.inArray(b(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,r){var o,a,s,u=e.nodeType;return e&&3!==u&&8!==u&&2!==u?typeof e.getAttribute===i?b.prop(e,n,r):(a=1!==u||!b.isXMLDoc(e),a&&(n=n.toLowerCase(),o=b.attrHooks[n]||(J.test(n)?z:I)),r===t?o&&a&&"get"in o&&null!==(s=o.get(e,n))?s:(typeof e.getAttribute!==i&&(s=e.getAttribute(n)),null==s?t:s):null!==r?o&&a&&"set"in o&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,r+""),r):(b.removeAttr(e,n),t)):void 0},removeAttr:function(e,t){var n,r,i=0,o=t&&t.match(w);if(o&&1===e.nodeType)for(;n=o[i++];)r=b.propFix[n]||n,J.test(n)?!Q&&G.test(n)?e[b.camelCase("default-"+n)]=e[r]=!1:e[r]=!1:b.attr(e,n,""),e.removeAttribute(Q?n:r)},attrHooks:{type:{set:function(e,t){if(!b.support.radioValue&&"radio"===t&&b.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,o,a,s=e.nodeType;return e&&3!==s&&8!==s&&2!==s?(a=1!==s||!b.isXMLDoc(e),a&&(n=b.propFix[n]||n,o=b.propHooks[n]),r!==t?o&&"set"in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get"in o&&null!==(i=o.get(e,n))?i:e[n]):void 0},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):V.test(e.nodeName)||Y.test(e.nodeName)&&e.href?0:t}}}}),z={get:function(e,n){var r=b.prop(e,n),i="boolean"==typeof r&&e.getAttribute(n),o="boolean"==typeof r?K&&Q?null!=i:G.test(n)?e[b.camelCase("default-"+n)]:!!i:e.getAttributeNode(n);
return o&&o.value!==!1?n.toLowerCase():t},set:function(e,t,n){return t===!1?b.removeAttr(e,n):K&&Q||!G.test(n)?e.setAttribute(!Q&&b.propFix[n]||n,n):e[b.camelCase("default-"+n)]=e[n]=!0,n}},K&&Q||(b.attrHooks.value={get:function(e,n){var r=e.getAttributeNode(n);return b.nodeName(e,"input")?e.defaultValue:r&&r.specified?r.value:t},set:function(e,n,r){return b.nodeName(e,"input")?(e.defaultValue=n,t):I&&I.set(e,n,r)}}),Q||(I=b.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&("id"===n||"name"===n||"coords"===n?""!==r.value:r.specified)?r.value:t},set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},b.attrHooks.contenteditable={get:I.get,set:function(e,t,n){I.set(e,""===t?!1:t,n)}},b.each(["width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}})})),b.support.hrefNormalized||(b.each(["href","src","width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return null==r?t:r}})}),b.each(["href","src"],function(e,t){b.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),b.support.style||(b.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),b.support.optSelected||(b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),b.support.enctype||(b.propFix.enctype="encoding"),b.support.checkOn||b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(e,n){return b.isArray(n)?e.checked=b.inArray(b(e).val(),n)>=0:t}})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;b.event={global:{},add:function(e,n,r,o,a){var s,u,l,c,p,f,d,h,g,m,y,v=b._data(e);if(v){for(r.handler&&(c=r,r=c.handler,a=c.selector),r.guid||(r.guid=b.guid++),(u=v.events)||(u=v.events={}),(f=v.handle)||(f=v.handle=function(e){return typeof b===i||e&&b.event.triggered===e.type?t:b.event.dispatch.apply(f.elem,arguments)},f.elem=e),n=(n||"").match(w)||[""],l=n.length;l--;)s=rt.exec(n[l])||[],g=y=s[1],m=(s[2]||"").split(".").sort(),p=b.event.special[g]||{},g=(a?p.delegateType:p.bindType)||g,p=b.event.special[g]||{},d=b.extend({type:g,origType:y,data:o,handler:r,guid:r.guid,selector:a,needsContext:a&&b.expr.match.needsContext.test(a),namespace:m.join(".")},c),(h=u[g])||(h=u[g]=[],h.delegateCount=0,p.setup&&p.setup.call(e,o,m,f)!==!1||(e.addEventListener?e.addEventListener(g,f,!1):e.attachEvent&&e.attachEvent("on"+g,f))),p.add&&(p.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),a?h.splice(h.delegateCount++,0,d):h.push(d),b.event.global[g]=!0;e=null}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,p,f,d,h,g,m=b.hasData(e)&&b._data(e);if(m&&(c=m.events)){for(t=(t||"").match(w)||[""],l=t.length;l--;)if(s=rt.exec(t[l])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){for(p=b.event.special[d]||{},d=(r?p.delegateType:p.bindType)||d,f=c[d]||[],s=s[2]&&RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),u=o=f.length;o--;)a=f[o],!i&&g!==a.origType||n&&n.guid!==a.guid||s&&!s.test(a.namespace)||r&&r!==a.selector&&("**"!==r||!a.selector)||(f.splice(o,1),a.selector&&f.delegateCount--,p.remove&&p.remove.call(e,a));u&&!f.length&&(p.teardown&&p.teardown.call(e,h,m.handle)!==!1||b.removeEvent(e,d,m.handle),delete c[d])}else for(d in c)b.event.remove(e,d+t[l],n,r,!0);b.isEmptyObject(c)&&(delete m.handle,b._removeData(e,"events"))}},trigger:function(n,r,i,a){var s,u,l,c,p,f,d,h=[i||o],g=y.call(n,"type")?n.type:n,m=y.call(n,"namespace")?n.namespace.split("."):[];if(l=f=i=i||o,3!==i.nodeType&&8!==i.nodeType&&!nt.test(g+b.event.triggered)&&(g.indexOf(".")>=0&&(m=g.split("."),g=m.shift(),m.sort()),u=0>g.indexOf(":")&&"on"+g,n=n[b.expando]?n:new b.Event(g,"object"==typeof n&&n),n.isTrigger=!0,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:b.makeArray(r,[n]),p=b.event.special[g]||{},a||!p.trigger||p.trigger.apply(i,r)!==!1)){if(!a&&!p.noBubble&&!b.isWindow(i)){for(c=p.delegateType||g,nt.test(c+g)||(l=l.parentNode);l;l=l.parentNode)h.push(l),f=l;f===(i.ownerDocument||o)&&h.push(f.defaultView||f.parentWindow||e)}for(d=0;(l=h[d++])&&!n.isPropagationStopped();)n.type=d>1?c:p.bindType||g,s=(b._data(l,"events")||{})[n.type]&&b._data(l,"handle"),s&&s.apply(l,r),s=u&&l[u],s&&b.acceptData(l)&&s.apply&&s.apply(l,r)===!1&&n.preventDefault();if(n.type=g,!(a||n.isDefaultPrevented()||p._default&&p._default.apply(i.ownerDocument,r)!==!1||"click"===g&&b.nodeName(i,"a")||!b.acceptData(i)||!u||!i[g]||b.isWindow(i))){f=i[u],f&&(i[u]=null),b.event.triggered=g;try{i[g]()}catch(v){}b.event.triggered=t,f&&(i[u]=f)}return n.result}},dispatch:function(e){e=b.event.fix(e);var n,r,i,o,a,s=[],u=h.call(arguments),l=(b._data(this,"events")||{})[e.type]||[],c=b.event.special[e.type]||{};if(u[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){for(s=b.event.handlers.call(this,e,l),n=0;(o=s[n++])&&!e.isPropagationStopped();)for(e.currentTarget=o.elem,a=0;(i=o.handlers[a++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((b.event.special[i.origType]||{}).handle||i.handler).apply(o.elem,u),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,o,a,s=[],u=n.delegateCount,l=e.target;if(u&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!=this;l=l.parentNode||this)if(1===l.nodeType&&(l.disabled!==!0||"click"!==e.type)){for(o=[],a=0;u>a;a++)i=n[a],r=i.selector+" ",o[r]===t&&(o[r]=i.needsContext?b(r,this).index(l)>=0:b.find(r,this,null,[l]).length),o[r]&&o.push(i);o.length&&s.push({elem:l,handlers:o})}return n.length>u&&s.push({elem:this,handlers:n.slice(u)}),s},fix:function(e){if(e[b.expando])return e;var t,n,r,i=e.type,a=e,s=this.fixHooks[i];for(s||(this.fixHooks[i]=s=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new b.Event(a),t=r.length;t--;)n=r[t],e[n]=a[n];return e.target||(e.target=a.srcElement||o),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,a):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,a,s=n.button,u=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||o,a=i.documentElement,r=i.body,e.pageX=n.clientX+(a&&a.scrollLeft||r&&r.scrollLeft||0)-(a&&a.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(a&&a.scrollTop||r&&r.scrollTop||0)-(a&&a.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&u&&(e.relatedTarget=u===e.target?n.toElement:u),e.which||s===t||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return b.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t}},focus:{trigger:function(){if(this!==o.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===o.activeElement&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=b.extend(new b.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?b.event.trigger(i,null,t):b.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},b.removeEvent=o.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},b.Event=function(e,n){return this instanceof b.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:ot):this.type=e,n&&b.extend(this,n),this.timeStamp=e&&e.timeStamp||b.now(),this[b.expando]=!0,t):new b.Event(e,n)},b.Event.prototype={isDefaultPrevented:ot,isPropagationStopped:ot,isImmediatePropagationStopped:ot,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){b.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return(!i||i!==r&&!b.contains(r,i))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),b.support.submitBubbles||(b.event.special.submit={setup:function(){return b.nodeName(this,"form")?!1:(b.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=b.nodeName(n,"input")||b.nodeName(n,"button")?n.form:t;r&&!b._data(r,"submitBubbles")&&(b.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),b._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&b.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return b.nodeName(this,"form")?!1:(b.event.remove(this,"._submit"),t)}}),b.support.changeBubbles||(b.event.special.change={setup:function(){return Z.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(b.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),b.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),b.event.simulate("change",this,e,!0)})),!1):(b.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!b._data(t,"changeBubbles")&&(b.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||b.event.simulate("change",this.parentNode,e,!0)}),b._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return b.event.remove(this,"._change"),!Z.test(this.nodeName)}}),b.support.focusinBubbles||b.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){b.event.simulate(t,e.target,b.event.fix(e),!0)};b.event.special[t]={setup:function(){0===n++&&o.addEventListener(e,r,!0)},teardown:function(){0===--n&&o.removeEventListener(e,r,!0)}}}),b.fn.extend({on:function(e,n,r,i,o){var a,s;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(a in e)this.on(a,n,r,e[a],o);return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1)i=ot;else if(!i)return this;return 1===o&&(s=i,i=function(e){return b().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=b.guid++)),this.each(function(){b.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,o;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,b(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(o in e)this.off(o,n,e[o]);return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=ot),this.each(function(){b.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){b.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?b.event.trigger(e,n,r,!0):t}}),function(e,t){function rt(e){return Y.test(e+"")}function it(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>i.cacheLength&&delete e[t.shift()],e[n]=r}}function ot(e){return e[x]=!0,e}function at(e){var t=p.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}}function st(e,t,n,r){var i,o,a,s,u,l,f,g,m,v;if((t?t.ownerDocument||t:w)!==p&&c(t),t=t||p,n=n||[],!e||"string"!=typeof e)return n;if(1!==(s=t.nodeType)&&9!==s)return[];if(!d&&!r){if(i=J.exec(e))if(a=i[1]){if(9===s){if(o=t.getElementById(a),!o||!o.parentNode)return n;if(o.id===a)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&y(t,o)&&o.id===a)return n.push(o),n}else{if(i[2])return H.apply(n,q.call(t.getElementsByTagName(e),0)),n;if((a=i[3])&&T.getByClassName&&t.getElementsByClassName)return H.apply(n,q.call(t.getElementsByClassName(a),0)),n}if(T.qsa&&!h.test(e)){if(f=!0,g=x,m=t,v=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){for(l=ft(e),(f=t.getAttribute("id"))?g=f.replace(K,"\\$&"):t.setAttribute("id",g),g="[id='"+g+"'] ",u=l.length;u--;)l[u]=g+dt(l[u]);m=V.test(e)&&t.parentNode||t,v=l.join(",")}if(v)try{return H.apply(n,q.call(m.querySelectorAll(v),0)),n}catch(b){}finally{f||t.removeAttribute("id")}}}return wt(e.replace(W,"$1"),t,n,r)}function ut(e,t){var n=t&&e,r=n&&(~t.sourceIndex||j)-(~e.sourceIndex||j);if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function ct(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function pt(e){return ot(function(t){return t=+t,ot(function(n,r){for(var i,o=e([],n.length,t),a=o.length;a--;)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}function ft(e,t){var n,r,o,a,s,u,l,c=E[e+" "];if(c)return t?0:c.slice(0);for(s=e,u=[],l=i.preFilter;s;){(!n||(r=$.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),u.push(o=[])),n=!1,(r=I.exec(s))&&(n=r.shift(),o.push({value:n,type:r[0].replace(W," ")}),s=s.slice(n.length));for(a in i.filter)!(r=U[a].exec(s))||l[a]&&!(r=l[a](r))||(n=r.shift(),o.push({value:n,type:a,matches:r}),s=s.slice(n.length));if(!n)break}return t?s.length:s?st.error(e):E(e,u).slice(0)}function dt(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function ht(e,t,n){var i=t.dir,o=n&&"parentNode"===i,a=C++;return t.first?function(t,n,r){for(;t=t[i];)if(1===t.nodeType||o)return e(t,n,r)}:function(t,n,s){var u,l,c,p=N+" "+a;if(s){for(;t=t[i];)if((1===t.nodeType||o)&&e(t,n,s))return!0}else for(;t=t[i];)if(1===t.nodeType||o)if(c=t[x]||(t[x]={}),(l=c[i])&&l[0]===p){if((u=l[1])===!0||u===r)return u===!0}else if(l=c[i]=[p],l[1]=e(t,n,s)||r,l[1]===!0)return!0}}function gt(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function mt(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;u>s;s++)(o=e[s])&&(!n||n(o,r,i))&&(a.push(o),l&&t.push(s));return a}function yt(e,t,n,r,i,o){return r&&!r[x]&&(r=yt(r)),i&&!i[x]&&(i=yt(i,o)),ot(function(o,a,s,u){var l,c,p,f=[],d=[],h=a.length,g=o||xt(t||"*",s.nodeType?[s]:s,[]),m=!e||!o&&t?g:mt(g,f,e,s,u),y=n?i||(o?e:h||r)?[]:a:m;if(n&&n(m,y,s,u),r)for(l=mt(y,d),r(l,[],s,u),c=l.length;c--;)(p=l[c])&&(y[d[c]]=!(m[d[c]]=p));if(o){if(i||e){if(i){for(l=[],c=y.length;c--;)(p=y[c])&&l.push(m[c]=p);i(null,y=[],l,u)}for(c=y.length;c--;)(p=y[c])&&(l=i?M.call(o,p):f[c])>-1&&(o[l]=!(a[l]=p))}}else y=mt(y===a?y.splice(h,y.length):y),i?i(null,a,y,u):H.apply(a,y)})}function vt(e){for(var t,n,r,o=e.length,a=i.relative[e[0].type],s=a||i.relative[" "],u=a?1:0,c=ht(function(e){return e===t},s,!0),p=ht(function(e){return M.call(t,e)>-1},s,!0),f=[function(e,n,r){return!a&&(r||n!==l)||((t=n).nodeType?c(e,n,r):p(e,n,r))}];o>u;u++)if(n=i.relative[e[u].type])f=[ht(gt(f),n)];else{if(n=i.filter[e[u].type].apply(null,e[u].matches),n[x]){for(r=++u;o>r&&!i.relative[e[r].type];r++);return yt(u>1&&gt(f),u>1&&dt(e.slice(0,u-1)).replace(W,"$1"),n,r>u&&vt(e.slice(u,r)),o>r&&vt(e=e.slice(r)),o>r&&dt(e))}f.push(n)}return gt(f)}function bt(e,t){var n=0,o=t.length>0,a=e.length>0,s=function(s,u,c,f,d){var h,g,m,y=[],v=0,b="0",x=s&&[],w=null!=d,T=l,C=s||a&&i.find.TAG("*",d&&u.parentNode||u),k=N+=null==T?1:Math.random()||.1;for(w&&(l=u!==p&&u,r=n);null!=(h=C[b]);b++){if(a&&h){for(g=0;m=e[g++];)if(m(h,u,c)){f.push(h);break}w&&(N=k,r=++n)}o&&((h=!m&&h)&&v--,s&&x.push(h))}if(v+=b,o&&b!==v){for(g=0;m=t[g++];)m(x,y,u,c);if(s){if(v>0)for(;b--;)x[b]||y[b]||(y[b]=L.call(f));y=mt(y)}H.apply(f,y),w&&!s&&y.length>0&&v+t.length>1&&st.uniqueSort(f)}return w&&(N=k,l=T),x};return o?ot(s):s}function xt(e,t,n){for(var r=0,i=t.length;i>r;r++)st(e,t[r],n);return n}function wt(e,t,n,r){var o,a,u,l,c,p=ft(e);if(!r&&1===p.length){if(a=p[0]=p[0].slice(0),a.length>2&&"ID"===(u=a[0]).type&&9===t.nodeType&&!d&&i.relative[a[1].type]){if(t=i.find.ID(u.matches[0].replace(et,tt),t)[0],!t)return n;e=e.slice(a.shift().value.length)}for(o=U.needsContext.test(e)?0:a.length;o--&&(u=a[o],!i.relative[l=u.type]);)if((c=i.find[l])&&(r=c(u.matches[0].replace(et,tt),V.test(a[0].type)&&t.parentNode||t))){if(a.splice(o,1),e=r.length&&dt(a),!e)return H.apply(n,q.call(r,0)),n;break}}return s(e,p)(r,t,d,n,V.test(e)),n}function Tt(){}var n,r,i,o,a,s,u,l,c,p,f,d,h,g,m,y,v,x="sizzle"+-new Date,w=e.document,T={},N=0,C=0,k=it(),E=it(),S=it(),A=typeof t,j=1<<31,D=[],L=D.pop,H=D.push,q=D.slice,M=D.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1},_="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",O=F.replace("w","w#"),B="([*^$|!~]?=)",P="\\["+_+"*("+F+")"+_+"*(?:"+B+_+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+O+")|)|)"+_+"*\\]",R=":("+F+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+P.replace(3,8)+")*)|.*)\\)|)",W=RegExp("^"+_+"+|((?:^|[^\\\\])(?:\\\\.)*)"+_+"+$","g"),$=RegExp("^"+_+"*,"+_+"*"),I=RegExp("^"+_+"*([\\x20\\t\\r\\n\\f>+~])"+_+"*"),z=RegExp(R),X=RegExp("^"+O+"$"),U={ID:RegExp("^#("+F+")"),CLASS:RegExp("^\\.("+F+")"),NAME:RegExp("^\\[name=['\"]?("+F+")['\"]?\\]"),TAG:RegExp("^("+F.replace("w","w*")+")"),ATTR:RegExp("^"+P),PSEUDO:RegExp("^"+R),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+_+"*(even|odd|(([+-]|)(\\d*)n|)"+_+"*(?:([+-]|)"+_+"*(\\d+)|))"+_+"*\\)|)","i"),needsContext:RegExp("^"+_+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+_+"*((?:-\\d)?\\d*)"+_+"*\\)|)(?=[^-]|$)","i")},V=/[\x20\t\r\n\f]*[+~]/,Y=/^[^{]+\{\s*\[native code/,J=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,G=/^(?:input|select|textarea|button)$/i,Q=/^h\d$/i,K=/'|\\/g,Z=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,et=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,tt=function(e,t){var n="0x"+t-65536;return n!==n?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{q.call(w.documentElement.childNodes,0)[0].nodeType}catch(nt){q=function(e){for(var t,n=[];t=this[e++];)n.push(t);return n}}a=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},c=st.setDocument=function(e){var n=e?e.ownerDocument||e:w;return n!==p&&9===n.nodeType&&n.documentElement?(p=n,f=n.documentElement,d=a(n),T.tagNameNoComments=at(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),T.attributes=at(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),T.getByClassName=at(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",e.getElementsByClassName&&e.getElementsByClassName("e").length?(e.lastChild.className="e",2===e.getElementsByClassName("e").length):!1}),T.getByName=at(function(e){e.id=x+0,e.innerHTML="<a name='"+x+"'></a><div name='"+x+"'></div>",f.insertBefore(e,f.firstChild);var t=n.getElementsByName&&n.getElementsByName(x).length===2+n.getElementsByName(x+0).length;return T.getIdNotName=!n.getElementById(x),f.removeChild(e),t}),i.attrHandle=at(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==A&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},T.getIdNotName?(i.find.ID=function(e,t){if(typeof t.getElementById!==A&&!d){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(i.find.ID=function(e,n){if(typeof n.getElementById!==A&&!d){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==A&&r.getAttributeNode("id").value===e?[r]:t:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==A&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=T.tagNameNoComments?function(e,n){return typeof n.getElementsByTagName!==A?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[i++];)1===n.nodeType&&r.push(n);return r}return o},i.find.NAME=T.getByName&&function(e,n){return typeof n.getElementsByName!==A?n.getElementsByName(name):t},i.find.CLASS=T.getByClassName&&function(e,n){return typeof n.getElementsByClassName===A||d?t:n.getElementsByClassName(e)},g=[],h=[":focus"],(T.qsa=rt(n.querySelectorAll))&&(at(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||h.push("\\["+_+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||h.push(":checked")}),at(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&h.push("[*^$]="+_+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||h.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),h.push(",.*:")})),(T.matchesSelector=rt(m=f.matchesSelector||f.mozMatchesSelector||f.webkitMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&at(function(e){T.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),g.push("!=",R)}),h=RegExp(h.join("|")),g=RegExp(g.join("|")),y=rt(f.contains)||f.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},v=f.compareDocumentPosition?function(e,t){var r;return e===t?(u=!0,0):(r=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&r||e.parentNode&&11===e.parentNode.nodeType?e===n||y(w,e)?-1:t===n||y(w,t)?1:0:4&r?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,o=e.parentNode,a=t.parentNode,s=[e],l=[t];if(e===t)return u=!0,0;if(!o||!a)return e===n?-1:t===n?1:o?-1:a?1:0;if(o===a)return ut(e,t);for(r=e;r=r.parentNode;)s.unshift(r);for(r=t;r=r.parentNode;)l.unshift(r);for(;s[i]===l[i];)i++;return i?ut(s[i],l[i]):s[i]===w?-1:l[i]===w?1:0},u=!1,[0,0].sort(v),T.detectDuplicates=u,p):p},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&c(e),t=t.replace(Z,"='$1']"),!(!T.matchesSelector||d||g&&g.test(t)||h.test(t)))try{var n=m.call(e,t);if(n||T.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(r){}return st(t,p,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==p&&c(e),y(e,t)},st.attr=function(e,t){var n;return(e.ownerDocument||e)!==p&&c(e),d||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):d||T.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},st.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,n=[],r=1,i=0;if(u=!T.detectDuplicates,e.sort(v),u){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));for(;i--;)e.splice(n[i],1)}return e},o=st.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=o(t);return n},i=st.selectors={cacheLength:50,createPseudo:ot,match:U,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return U.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&z.test(n)&&(t=ft(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(et,tt).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=k[e+" "];return t||(t=RegExp("(^|"+_+")"+e+"("+_+"|$)"))&&k(e,function(e){return t.test(e.className||typeof e.getAttribute!==A&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,p,f,d,h,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,y=s&&t.nodeName.toLowerCase(),v=!u&&!s;if(m){if(o){for(;g;){for(p=t;p=p[g];)if(s?p.nodeName.toLowerCase()===y:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?m.firstChild:m.lastChild],a&&v){for(c=m[x]||(m[x]={}),l=c[e]||[],d=l[0]===N&&l[1],f=l[0]===N&&l[2],p=d&&m.childNodes[d];p=++d&&p&&p[g]||(f=d=0)||h.pop();)if(1===p.nodeType&&++f&&p===t){c[e]=[N,d,f];break}}else if(v&&(l=(t[x]||(t[x]={}))[e])&&l[0]===N)f=l[1];else for(;(p=++d&&p&&p[g]||(f=d=0)||h.pop())&&((s?p.nodeName.toLowerCase()!==y:1!==p.nodeType)||!++f||(v&&((p[x]||(p[x]={}))[e]=[N,f]),p!==t)););return f-=i,f===r||0===f%r&&f/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return r[x]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?ot(function(e,n){for(var i,o=r(e,t),a=o.length;a--;)i=M.call(e,o[a]),e[i]=!(n[i]=o[a])}):function(e){return r(e,0,n)}):r}},pseudos:{not:ot(function(e){var t=[],n=[],r=s(e.replace(W,"$1"));return r[x]?ot(function(e,t,n,i){for(var o,a=r(e,null,i,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),!n.pop()}}),has:ot(function(e){return function(t){return st(e,t).length>0}}),contains:ot(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:ot(function(e){return X.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do if(n=d?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return Q.test(e.nodeName)},input:function(e){return G.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:pt(function(){return[0]}),last:pt(function(e,t){return[t-1]}),eq:pt(function(e,t,n){return[0>n?n+t:n]}),even:pt(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:pt(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:pt(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:pt(function(e,t,n){for(var r=0>n?n+t:n;t>++r;)e.push(r);return e})}};for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[n]=lt(n);for(n in{submit:!0,reset:!0})i.pseudos[n]=ct(n);s=st.compile=function(e,t){var n,r=[],i=[],o=S[e+" "];if(!o){for(t||(t=ft(e)),n=t.length;n--;)o=vt(t[n]),o[x]?r.push(o):i.push(o);o=S(e,bt(i,r))}return o},i.pseudos.nth=i.pseudos.eq,i.filters=Tt.prototype=i.pseudos,i.setFilters=new Tt,c(),st.attr=b.attr,b.find=st,b.expr=st.selectors,b.expr[":"]=b.expr.pseudos,b.unique=st.uniqueSort,b.text=st.getText,b.isXMLDoc=st.isXML,b.contains=st.contains}(e);var at=/Until$/,st=/^(?:parents|prev(?:Until|All))/,ut=/^.[^:#\[\.,]*$/,lt=b.expr.match.needsContext,ct={children:!0,contents:!0,next:!0,prev:!0};b.fn.extend({find:function(e){var t,n,r,i=this.length;if("string"!=typeof e)return r=this,this.pushStack(b(e).filter(function(){for(t=0;i>t;t++)if(b.contains(r[t],this))return!0}));for(n=[],t=0;i>t;t++)b.find(e,this[t],n);return n=this.pushStack(i>1?b.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=b(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(b.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ft(this,e,!1))},filter:function(e){return this.pushStack(ft(this,e,!0))},is:function(e){return!!e&&("string"==typeof e?lt.test(e)?b(e,this.context).index(this[0])>=0:b.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){for(var n,r=0,i=this.length,o=[],a=lt.test(e)||"string"!=typeof e?b(e,t||this.context):0;i>r;r++)for(n=this[r];n&&n.ownerDocument&&n!==t&&11!==n.nodeType;){if(a?a.index(n)>-1:b.find.matchesSelector(n,e)){o.push(n);break}n=n.parentNode}return this.pushStack(o.length>1?b.unique(o):o)},index:function(e){return e?"string"==typeof e?b.inArray(this[0],b(e)):b.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?b(e,t):b.makeArray(e&&e.nodeType?[e]:e),r=b.merge(this.get(),n);return this.pushStack(b.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),b.fn.andSelf=b.fn.addBack,b.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return b.dir(e,"parentNode")},parentsUntil:function(e,t,n){return b.dir(e,"parentNode",n)},next:function(e){return pt(e,"nextSibling")},prev:function(e){return pt(e,"previousSibling")},nextAll:function(e){return b.dir(e,"nextSibling")},prevAll:function(e){return b.dir(e,"previousSibling")},nextUntil:function(e,t,n){return b.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return b.dir(e,"previousSibling",n)
},siblings:function(e){return b.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return b.sibling(e.firstChild)},contents:function(e){return b.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:b.merge([],e.childNodes)}},function(e,t){b.fn[e]=function(n,r){var i=b.map(this,t,n);return at.test(e)||(r=n),r&&"string"==typeof r&&(i=b.filter(r,i)),i=this.length>1&&!ct[e]?b.unique(i):i,this.length>1&&st.test(e)&&(i=i.reverse()),this.pushStack(i)}}),b.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?b.find.matchesSelector(t[0],e)?[t[0]]:[]:b.find.matches(e,t)},dir:function(e,n,r){for(var i=[],o=e[n];o&&9!==o.nodeType&&(r===t||1!==o.nodeType||!b(o).is(r));)1===o.nodeType&&i.push(o),o=o[n];return i},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});var ht="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",gt=/ jQuery\d+="(?:null|\d+)"/g,mt=RegExp("<(?:"+ht+")[\\s/>]","i"),yt=/^\s+/,vt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,xt=/<tbody/i,wt=/<|&#?\w+;/,Tt=/<(?:script|style|link)/i,Nt=/^(?:checkbox|radio)$/i,Ct=/checked\s*(?:[^=]|=\s*.checked.)/i,kt=/^$|\/(?:java|ecma)script/i,Et=/^true\/(.*)/,St=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,At={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:b.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},jt=dt(o),Dt=jt.appendChild(o.createElement("div"));At.optgroup=At.option,At.tbody=At.tfoot=At.colgroup=At.caption=At.thead,At.th=At.td,b.fn.extend({text:function(e){return b.access(this,function(e){return e===t?b.text(this):this.empty().append((this[0]&&this[0].ownerDocument||o).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(b.isFunction(e))return this.each(function(t){b(this).wrapAll(e.call(this,t))});if(this[0]){var t=b(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return this.each(b.isFunction(e)?function(t){b(this).wrapInner(e.call(this,t))}:function(){var t=b(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=b.isFunction(e);return this.each(function(n){b(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){b.nodeName(this,"body")||b(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,r=0;null!=(n=this[r]);r++)(!e||b.filter(e,[n]).length>0)&&(t||1!==n.nodeType||b.cleanData(Ot(n)),n.parentNode&&(t&&b.contains(n.ownerDocument,n)&&Mt(Ot(n,"script")),n.parentNode.removeChild(n)));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&b.cleanData(Ot(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&b.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return b.clone(this,e,t)})},html:function(e){return b.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(gt,""):t;if(!("string"!=typeof e||Tt.test(e)||!b.support.htmlSerialize&&mt.test(e)||!b.support.leadingWhitespace&&yt.test(e)||At[(bt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(vt,"<$1></$2>");try{for(;i>r;r++)n=this[r]||{},1===n.nodeType&&(b.cleanData(Ot(n,!1)),n.innerHTML=e);n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=b.isFunction(e);return t||"string"==typeof e||(e=b(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(b(this).remove(),n.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=f.apply([],e);var i,o,a,s,u,l,c=0,p=this.length,d=this,h=p-1,g=e[0],m=b.isFunction(g);if(m||!(1>=p||"string"!=typeof g||b.support.checkClone)&&Ct.test(g))return this.each(function(i){var o=d.eq(i);m&&(e[0]=g.call(this,i,n?o.html():t)),o.domManip(e,n,r)});if(p&&(l=b.buildFragment(e,this[0].ownerDocument,!1,this),i=l.firstChild,1===l.childNodes.length&&(l=i),i)){for(n=n&&b.nodeName(i,"tr"),s=b.map(Ot(l,"script"),Ht),a=s.length;p>c;c++)o=l,c!==h&&(o=b.clone(o,!0,!0),a&&b.merge(s,Ot(o,"script"))),r.call(n&&b.nodeName(this[c],"table")?Lt(this[c],"tbody"):this[c],o,c);if(a)for(u=s[s.length-1].ownerDocument,b.map(s,qt),c=0;a>c;c++)o=s[c],kt.test(o.type||"")&&!b._data(o,"globalEval")&&b.contains(u,o)&&(o.src?b.ajax({url:o.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):b.globalEval((o.text||o.textContent||o.innerHTML||"").replace(St,"")));l=i=null}return this}}),b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){b.fn[e]=function(e){for(var n,r=0,i=[],o=b(e),a=o.length-1;a>=r;r++)n=r===a?this:this.clone(!0),b(o[r])[t](n),d.apply(i,n.get());return this.pushStack(i)}}),b.extend({clone:function(e,t,n){var r,i,o,a,s,u=b.contains(e.ownerDocument,e);if(b.support.html5Clone||b.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(Dt.innerHTML=e.outerHTML,Dt.removeChild(o=Dt.firstChild)),!(b.support.noCloneEvent&&b.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||b.isXMLDoc(e)))for(r=Ot(o),s=Ot(e),a=0;null!=(i=s[a]);++a)r[a]&&Ft(i,r[a]);if(t)if(n)for(s=s||Ot(e),r=r||Ot(o),a=0;null!=(i=s[a]);a++)_t(i,r[a]);else _t(e,o);return r=Ot(o,"script"),r.length>0&&Mt(r,!u&&Ot(e,"script")),r=s=i=null,o},buildFragment:function(e,t,n,r){for(var i,o,a,s,u,l,c,p=e.length,f=dt(t),d=[],h=0;p>h;h++)if(o=e[h],o||0===o)if("object"===b.type(o))b.merge(d,o.nodeType?[o]:o);else if(wt.test(o)){for(s=s||f.appendChild(t.createElement("div")),u=(bt.exec(o)||["",""])[1].toLowerCase(),c=At[u]||At._default,s.innerHTML=c[1]+o.replace(vt,"<$1></$2>")+c[2],i=c[0];i--;)s=s.lastChild;if(!b.support.leadingWhitespace&&yt.test(o)&&d.push(t.createTextNode(yt.exec(o)[0])),!b.support.tbody)for(o="table"!==u||xt.test(o)?"<table>"!==c[1]||xt.test(o)?0:s:s.firstChild,i=o&&o.childNodes.length;i--;)b.nodeName(l=o.childNodes[i],"tbody")&&!l.childNodes.length&&o.removeChild(l);for(b.merge(d,s.childNodes),s.textContent="";s.firstChild;)s.removeChild(s.firstChild);s=f.lastChild}else d.push(t.createTextNode(o));for(s&&f.removeChild(s),b.support.appendChecked||b.grep(Ot(d,"input"),Bt),h=0;o=d[h++];)if((!r||-1===b.inArray(o,r))&&(a=b.contains(o.ownerDocument,o),s=Ot(f.appendChild(o),"script"),a&&Mt(s),n))for(i=0;o=s[i++];)kt.test(o.type||"")&&n.push(o);return s=null,f},cleanData:function(e,t){for(var n,r,o,a,s=0,u=b.expando,l=b.cache,p=b.support.deleteExpando,f=b.event.special;null!=(n=e[s]);s++)if((t||b.acceptData(n))&&(o=n[u],a=o&&l[o])){if(a.events)for(r in a.events)f[r]?b.event.remove(n,r):b.removeEvent(n,r,a.handle);l[o]&&(delete l[o],p?delete n[u]:typeof n.removeAttribute!==i?n.removeAttribute(u):n[u]=null,c.push(o))}}});var Pt,Rt,Wt,$t=/alpha\([^)]*\)/i,It=/opacity\s*=\s*([^)]*)/,zt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Ut=/^margin/,Vt=RegExp("^("+x+")(.*)$","i"),Yt=RegExp("^("+x+")(?!px)[a-z%]+$","i"),Jt=RegExp("^([+-])=("+x+")","i"),Gt={BODY:"block"},Qt={position:"absolute",visibility:"hidden",display:"block"},Kt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];b.fn.extend({css:function(e,n){return b.access(this,function(e,n,r){var i,o,a={},s=0;if(b.isArray(n)){for(o=Rt(e),i=n.length;i>s;s++)a[n[s]]=b.css(e,n[s],!1,o);return a}return r!==t?b.style(e,n,r):b.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:nn(this))?b(this).show():b(this).hide()})}}),b.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Wt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":b.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,a,s,u=b.camelCase(n),l=e.style;if(n=b.cssProps[u]||(b.cssProps[u]=tn(l,u)),s=b.cssHooks[n]||b.cssHooks[u],r===t)return s&&"get"in s&&(o=s.get(e,!1,i))!==t?o:l[n];if(a=typeof r,"string"===a&&(o=Jt.exec(r))&&(r=(o[1]+1)*o[2]+parseFloat(b.css(e,n)),a="number"),!(null==r||"number"===a&&isNaN(r)||("number"!==a||b.cssNumber[u]||(r+="px"),b.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(l[n]="inherit"),s&&"set"in s&&(r=s.set(e,r,i))===t)))try{l[n]=r}catch(c){}}},css:function(e,n,r,i){var o,a,s,u=b.camelCase(n);return n=b.cssProps[u]||(b.cssProps[u]=tn(e.style,u)),s=b.cssHooks[n]||b.cssHooks[u],s&&"get"in s&&(a=s.get(e,!0,r)),a===t&&(a=Wt(e,n,i)),"normal"===a&&n in Kt&&(a=Kt[n]),""===r||r?(o=parseFloat(a),r===!0||b.isNumeric(o)?o||0:a):a},swap:function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=a[o];return i}}),e.getComputedStyle?(Rt=function(t){return e.getComputedStyle(t,null)},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),u=s?s.getPropertyValue(n)||s[n]:t,l=e.style;return s&&(""!==u||b.contains(e.ownerDocument,e)||(u=b.style(e,n)),Yt.test(u)&&Ut.test(n)&&(i=l.width,o=l.minWidth,a=l.maxWidth,l.minWidth=l.maxWidth=l.width=u,u=s.width,l.width=i,l.minWidth=o,l.maxWidth=a)),u}):o.documentElement.currentStyle&&(Rt=function(e){return e.currentStyle},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),u=s?s[n]:t,l=e.style;return null==u&&l&&l[n]&&(u=l[n]),Yt.test(u)&&!zt.test(n)&&(i=l.left,o=e.runtimeStyle,a=o&&o.left,a&&(o.left=e.currentStyle.left),l.left="fontSize"===n?"1em":u,u=l.pixelLeft+"px",l.left=i,a&&(o.left=a)),""===u?"auto":u}),b.each(["height","width"],function(e,n){b.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&Xt.test(b.css(e,"display"))?b.swap(e,Qt,function(){return sn(e,n,i)}):sn(e,n,i):t},set:function(e,t,r){var i=r&&Rt(e);return on(e,t,r?an(e,n,r,b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,i),i):0)}}}),b.support.opacity||(b.cssHooks.opacity={get:function(e,t){return It.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=b.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===b.trim(o.replace($t,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=$t.test(o)?o.replace($t,i):o+" "+i)}}),b(function(){b.support.reliableMarginRight||(b.cssHooks.marginRight={get:function(e,n){return n?b.swap(e,{display:"inline-block"},Wt,[e,"marginRight"]):t}}),!b.support.pixelPosition&&b.fn.position&&b.each(["top","left"],function(e,n){b.cssHooks[n]={get:function(e,r){return r?(r=Wt(e,n),Yt.test(r)?b(e).position()[n]+"px":r):t}}})}),b.expr&&b.expr.filters&&(b.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!b.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||b.css(e,"display"))},b.expr.filters.visible=function(e){return!b.expr.filters.hidden(e)}),b.each({margin:"",padding:"",border:"Width"},function(e,t){b.cssHooks[e+t]={expand:function(n){for(var r=0,i={},o="string"==typeof n?n.split(" "):[n];4>r;r++)i[e+Zt[r]+t]=o[r]||o[r-2]||o[0];return i}},Ut.test(e)||(b.cssHooks[e+t].set=on)});var cn=/%20/g,pn=/\[\]$/,fn=/\r?\n/g,dn=/^(?:submit|button|image|reset|file)$/i,hn=/^(?:input|select|textarea|keygen)/i;b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=b.prop(this,"elements");return e?b.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!b(this).is(":disabled")&&hn.test(this.nodeName)&&!dn.test(e)&&(this.checked||!Nt.test(e))}).map(function(e,t){var n=b(this).val();return null==n?null:b.isArray(n)?b.map(n,function(e){return{name:t.name,value:e.replace(fn,"\r\n")}}):{name:t.name,value:n.replace(fn,"\r\n")}}).get()}}),b.param=function(e,n){var r,i=[],o=function(e,t){t=b.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=b.ajaxSettings&&b.ajaxSettings.traditional),b.isArray(e)||e.jquery&&!b.isPlainObject(e))b.each(e,function(){o(this.name,this.value)});else for(r in e)gn(r,e[r],n,o);return i.join("&").replace(cn,"+")},b.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){b.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),b.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var mn,yn,vn=b.now(),bn=/\?/,xn=/#.*$/,wn=/([?&])_=[^&]*/,Tn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Nn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Cn=/^(?:GET|HEAD)$/,kn=/^\/\//,En=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Sn=b.fn.load,An={},jn={},Dn="*/".concat("*");try{yn=a.href}catch(Ln){yn=o.createElement("a"),yn.href="",yn=yn.href}mn=En.exec(yn.toLowerCase())||[],b.fn.load=function(e,n,r){if("string"!=typeof e&&Sn)return Sn.apply(this,arguments);var i,o,a,s=this,u=e.indexOf(" ");return u>=0&&(i=e.slice(u,e.length),e=e.slice(0,u)),b.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(a="POST"),s.length>0&&b.ajax({url:e,type:a,dataType:"html",data:n}).done(function(e){o=arguments,s.html(i?b("<div>").append(b.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){s.each(r,o||[e.responseText,t,e])}),this},b.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){b.fn[t]=function(e){return this.on(t,e)}}),b.each(["get","post"],function(e,n){b[n]=function(e,r,i,o){return b.isFunction(r)&&(o=o||i,i=r,r=t),b.ajax({url:e,type:n,dataType:o,data:r,success:i})}}),b.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:yn,type:"GET",isLocal:Nn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Dn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":b.parseJSON,"text xml":b.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Mn(Mn(e,b.ajaxSettings),t):Mn(b.ajaxSettings,e)},ajaxPrefilter:Hn(An),ajaxTransport:Hn(jn),ajax:function(e,n){function k(e,n,r,i){var c,y,v,w,T,C=n;2!==x&&(x=2,s&&clearTimeout(s),l=t,a=i||"",N.readyState=e>0?4:0,r&&(w=_n(p,N,r)),e>=200&&300>e||304===e?(p.ifModified&&(T=N.getResponseHeader("Last-Modified"),T&&(b.lastModified[o]=T),T=N.getResponseHeader("etag"),T&&(b.etag[o]=T)),204===e?(c=!0,C="nocontent"):304===e?(c=!0,C="notmodified"):(c=Fn(p,w),C=c.state,y=c.data,v=c.error,c=!v)):(v=C,(e||!C)&&(C="error",0>e&&(e=0))),N.status=e,N.statusText=(n||C)+"",c?h.resolveWith(f,[y,C,N]):h.rejectWith(f,[N,C,v]),N.statusCode(m),m=t,u&&d.trigger(c?"ajaxSuccess":"ajaxError",[N,p,c?y:v]),g.fireWith(f,[N,C]),u&&(d.trigger("ajaxComplete",[N,p]),--b.active||b.event.trigger("ajaxStop")))}"object"==typeof e&&(n=e,e=t),n=n||{};var r,i,o,a,s,u,l,c,p=b.ajaxSetup({},n),f=p.context||p,d=p.context&&(f.nodeType||f.jquery)?b(f):b.event,h=b.Deferred(),g=b.Callbacks("once memory"),m=p.statusCode||{},y={},v={},x=0,T="canceled",N={readyState:0,getResponseHeader:function(e){var t;if(2===x){if(!c)for(c={};t=Tn.exec(a);)c[t[1].toLowerCase()]=t[2];t=c[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===x?a:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return x||(e=v[n]=v[n]||e,y[e]=t),this},overrideMimeType:function(e){return x||(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>x)for(t in e)m[t]=[m[t],e[t]];else N.always(e[N.status]);return this},abort:function(e){var t=e||T;return l&&l.abort(t),k(0,t),this}};if(h.promise(N).complete=g.add,N.success=N.done,N.error=N.fail,p.url=((e||p.url||yn)+"").replace(xn,"").replace(kn,mn[1]+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=b.trim(p.dataType||"*").toLowerCase().match(w)||[""],null==p.crossDomain&&(r=En.exec(p.url.toLowerCase()),p.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||("http:"===r[1]?80:443))==(mn[3]||("http:"===mn[1]?80:443)))),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=b.param(p.data,p.traditional)),qn(An,p,n,N),2===x)return N;u=p.global,u&&0===b.active++&&b.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Cn.test(p.type),o=p.url,p.hasContent||(p.data&&(o=p.url+=(bn.test(o)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=wn.test(o)?o.replace(wn,"$1_="+vn++):o+(bn.test(o)?"&":"?")+"_="+vn++)),p.ifModified&&(b.lastModified[o]&&N.setRequestHeader("If-Modified-Since",b.lastModified[o]),b.etag[o]&&N.setRequestHeader("If-None-Match",b.etag[o])),(p.data&&p.hasContent&&p.contentType!==!1||n.contentType)&&N.setRequestHeader("Content-Type",p.contentType),N.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Dn+"; q=0.01":""):p.accepts["*"]);for(i in p.headers)N.setRequestHeader(i,p.headers[i]);if(p.beforeSend&&(p.beforeSend.call(f,N,p)===!1||2===x))return N.abort();T="abort";for(i in{success:1,error:1,complete:1})N[i](p[i]);if(l=qn(jn,p,n,N)){N.readyState=1,u&&d.trigger("ajaxSend",[N,p]),p.async&&p.timeout>0&&(s=setTimeout(function(){N.abort("timeout")},p.timeout));try{x=1,l.send(y,k)}catch(C){if(!(2>x))throw C;k(-1,C)}}else k(-1,"No Transport");return N},getScript:function(e,n){return b.get(e,t,n,"script")},getJSON:function(e,t,n){return b.get(e,t,n,"json")}}),b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),b.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=o.head||b("head")[0]||o.documentElement;return{send:function(t,i){n=o.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var On=[],Bn=/(=)\?(?=&|$)|\?\?/;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=On.pop()||b.expando+"_"+vn++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",function(n,r,i){var o,a,s,u=n.jsonp!==!1&&(Bn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bn.test(n.data)&&"data");return u||"jsonp"===n.dataTypes[0]?(o=n.jsonpCallback=b.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,u?n[u]=n[u].replace(Bn,"$1"+o):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+o),n.converters["script json"]=function(){return s||b.error(o+" was not called"),s[0]},n.dataTypes[0]="json",a=e[o],e[o]=function(){s=arguments},i.always(function(){e[o]=a,n[o]&&(n.jsonpCallback=r.jsonpCallback,On.push(o)),s&&b.isFunction(a)&&a(s[0]),s=a=t}),"script"):t});var Pn,Rn,Wn=0,$n=e.ActiveXObject&&function(){var e;for(e in Pn)Pn[e](t,!0)};b.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&In()||zn()}:In,Rn=b.ajaxSettings.xhr(),b.support.cors=!!Rn&&"withCredentials"in Rn,Rn=b.support.ajax=!!Rn,Rn&&b.ajaxTransport(function(n){if(!n.crossDomain||b.support.cors){var r;return{send:function(i,o){var a,s,u=n.xhr();if(n.username?u.open(n.type,n.url,n.async,n.username,n.password):u.open(n.type,n.url,n.async),n.xhrFields)for(s in n.xhrFields)u[s]=n.xhrFields[s];n.mimeType&&u.overrideMimeType&&u.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(s in i)u.setRequestHeader(s,i[s])}catch(l){}u.send(n.hasContent&&n.data||null),r=function(e,i){var s,l,c,p;try{if(r&&(i||4===u.readyState))if(r=t,a&&(u.onreadystatechange=b.noop,$n&&delete Pn[a]),i)4!==u.readyState&&u.abort();else{p={},s=u.status,l=u.getAllResponseHeaders(),"string"==typeof u.responseText&&(p.text=u.responseText);try{c=u.statusText}catch(f){c=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=p.text?200:404}}catch(d){i||o(-1,d)}p&&o(s,c,p,l)},n.async?4===u.readyState?setTimeout(r):(a=++Wn,$n&&(Pn||(Pn={},b(e).unload($n)),Pn[a]=r),u.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Un,Vn=/^(?:toggle|show|hide)$/,Yn=RegExp("^(?:([+-])=|)("+x+")([a-z%]*)$","i"),Jn=/queueHooks$/,Gn=[nr],Qn={"*":[function(e,t){var n,r,i=this.createTween(e,t),o=Yn.exec(t),a=i.cur(),s=+a||0,u=1,l=20;if(o){if(n=+o[2],r=o[3]||(b.cssNumber[e]?"":"px"),"px"!==r&&s){s=b.css(i.elem,e,!0)||n||1;do u=u||".5",s/=u,b.style(i.elem,e,s+r);while(u!==(u=i.cur()/a)&&1!==u&&--l)}i.unit=r,i.start=s,i.end=o[1]?s+(o[1]+1)*n:n}return i}]};b.Animation=b.extend(er,{tweener:function(e,t){b.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,r=0,i=e.length;i>r;r++)n=e[r],Qn[n]=Qn[n]||[],Qn[n].unshift(t)},prefilter:function(e,t){t?Gn.unshift(e):Gn.push(e)}}),b.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(b.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.pos=t=this.options.duration?b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=b.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[b.cssProps[e.prop]]||b.cssHooks[e.prop])?b.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.each(["toggle","show","hide"],function(e,t){var n=b.fn[t];b.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),b.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=b.isEmptyObject(e),o=b.speed(t,n,r),a=function(){var t=er(this,b.extend({},e),o);a.finish=function(){t.stop(!0)},(i||b._data(this,"finish"))&&t.stop(!0)};return a.finish=a,i||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=b.timers,a=b._data(this);if(n)a[n]&&a[n].stop&&i(a[n]);else for(n in a)a[n]&&a[n].stop&&Jn.test(n)&&i(a[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(r),t=!1,o.splice(n,1));(t||!r)&&b.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=b._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=b.timers,a=r?r.length:0;for(n.finish=!0,b.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;a>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),b.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){b.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),b.speed=function(e,t,n){var r=e&&"object"==typeof e?b.extend({},e):{complete:n||!n&&t||b.isFunction(e)&&e,duration:e,easing:n&&t||t&&!b.isFunction(t)&&t};return r.duration=b.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in b.fx.speeds?b.fx.speeds[r.duration]:b.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){b.isFunction(r.old)&&r.old.call(this),r.queue&&b.dequeue(this,r.queue)},r},b.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},b.timers=[],b.fx=rr.prototype.init,b.fx.tick=function(){var e,n=b.timers,r=0;for(Xn=b.now();n.length>r;r++)e=n[r],e()||n[r]!==e||n.splice(r--,1);n.length||b.fx.stop(),Xn=t},b.fx.timer=function(e){e()&&b.timers.push(e)&&b.fx.start()},b.fx.interval=13,b.fx.start=function(){Un||(Un=setInterval(b.fx.tick,b.fx.interval))},b.fx.stop=function(){clearInterval(Un),Un=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fx.step={},b.expr&&b.expr.filters&&(b.expr.filters.animated=function(e){return b.grep(b.timers,function(t){return e===t.elem}).length}),b.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){b.offset.setOffset(this,e,t)});var n,r,o={top:0,left:0},a=this[0],s=a&&a.ownerDocument;return s?(n=s.documentElement,b.contains(n,a)?(typeof a.getBoundingClientRect!==i&&(o=a.getBoundingClientRect()),r=or(s),{top:o.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:o.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):o):void 0},b.offset={setOffset:function(e,t,n){var r=b.css(e,"position");"static"===r&&(e.style.position="relative");var p,f,i=b(e),o=i.offset(),a=b.css(e,"top"),s=b.css(e,"left"),u=("absolute"===r||"fixed"===r)&&b.inArray("auto",[a,s])>-1,l={},c={};u?(c=i.position(),p=c.top,f=c.left):(p=parseFloat(a)||0,f=parseFloat(s)||0),b.isFunction(t)&&(t=t.call(e,n,o)),null!=t.top&&(l.top=t.top-o.top+p),null!=t.left&&(l.left=t.left-o.left+f),"using"in t?t.using.call(e,l):i.css(l)}},b.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===b.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),b.nodeName(e[0],"html")||(n=e.offset()),n.top+=b.css(e[0],"borderTopWidth",!0),n.left+=b.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-b.css(r,"marginTop",!0),left:t.left-n.left-b.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||o.documentElement;e&&!b.nodeName(e,"html")&&"static"===b.css(e,"position");)e=e.offsetParent;return e||o.documentElement})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);b.fn[e]=function(i){return b.access(this,function(e,i,o){var a=or(e);return o===t?a?n in a?a[n]:a.document.documentElement[i]:e[i]:(a?a.scrollTo(r?b(a).scrollLeft():o,r?o:b(a).scrollTop()):e[i]=o,t)},e,i,arguments.length,null)}}),b.each({Height:"height",Width:"width"},function(e,n){b.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){b.fn[i]=function(i,o){var a=arguments.length&&(r||"boolean"!=typeof i),s=r||(i===!0||o===!0?"margin":"border");return b.access(this,function(n,r,i){var o;return b.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(o=n.documentElement,Math.max(n.body["scroll"+e],o["scroll"+e],n.body["offset"+e],o["offset"+e],o["client"+e])):i===t?b.css(n,r,s):b.style(n,r,i,s)},n,a?i:t,a,null)}})}),e.jQuery=e.$=b,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return b})}(window),function(){var root=this,previousUnderscore=root._,ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,_=function(obj){return obj instanceof _?obj:this instanceof _?void(this._wrapped=obj):new _(obj)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION="1.7.0";var createCallback=function(func,context,argCount){if(void 0===context)return func;switch(null==argCount?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}};_.iteratee=function(value,context,argCount){return null==value?_.identity:_.isFunction(value)?createCallback(value,context,argCount):_.isObject(value)?_.matches(value):_.property(value)},_.each=_.forEach=function(obj,iteratee,context){if(null==obj)return obj;iteratee=createCallback(iteratee,context);var i,length=obj.length;if(length===+length)for(i=0;length>i;i++)iteratee(obj[i],i,obj);else{var keys=_.keys(obj);for(i=0,length=keys.length;length>i;i++)iteratee(obj[keys[i]],keys[i],obj)}return obj},_.map=_.collect=function(obj,iteratee,context){if(null==obj)return[];iteratee=_.iteratee(iteratee,context);for(var currentKey,keys=obj.length!==+obj.length&&_.keys(obj),length=(keys||obj).length,results=Array(length),index=0;length>index;index++)currentKey=keys?keys[index]:index,results[index]=iteratee(obj[currentKey],currentKey,obj);return results};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iteratee,memo,context){null==obj&&(obj=[]),iteratee=createCallback(iteratee,context,4);var currentKey,keys=obj.length!==+obj.length&&_.keys(obj),length=(keys||obj).length,index=0;if(arguments.length<3){if(!length)throw new TypeError(reduceError);memo=obj[keys?keys[index++]:index++]}for(;length>index;index++)currentKey=keys?keys[index]:index,memo=iteratee(memo,obj[currentKey],currentKey,obj);return memo},_.reduceRight=_.foldr=function(obj,iteratee,memo,context){null==obj&&(obj=[]),iteratee=createCallback(iteratee,context,4);var currentKey,keys=obj.length!==+obj.length&&_.keys(obj),index=(keys||obj).length;if(arguments.length<3){if(!index)throw new TypeError(reduceError);memo=obj[keys?keys[--index]:--index]}for(;index--;)currentKey=keys?keys[index]:index,memo=iteratee(memo,obj[currentKey],currentKey,obj);return memo},_.find=_.detect=function(obj,predicate,context){var result;return predicate=_.iteratee(predicate,context),_.some(obj,function(value,index,list){return predicate(value,index,list)?(result=value,!0):void 0}),result},_.filter=_.select=function(obj,predicate,context){var results=[];return null==obj?results:(predicate=_.iteratee(predicate,context),_.each(obj,function(value,index,list){predicate(value,index,list)&&results.push(value)
}),results)},_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(_.iteratee(predicate)),context)},_.every=_.all=function(obj,predicate,context){if(null==obj)return!0;predicate=_.iteratee(predicate,context);var index,currentKey,keys=obj.length!==+obj.length&&_.keys(obj),length=(keys||obj).length;for(index=0;length>index;index++)if(currentKey=keys?keys[index]:index,!predicate(obj[currentKey],currentKey,obj))return!1;return!0},_.some=_.any=function(obj,predicate,context){if(null==obj)return!1;predicate=_.iteratee(predicate,context);var index,currentKey,keys=obj.length!==+obj.length&&_.keys(obj),length=(keys||obj).length;for(index=0;length>index;index++)if(currentKey=keys?keys[index]:index,predicate(obj[currentKey],currentKey,obj))return!0;return!1},_.contains=_.include=function(obj,target){return null==obj?!1:(obj.length!==+obj.length&&(obj=_.values(obj)),_.indexOf(obj,target)>=0)},_.invoke=function(obj,method){var args=slice.call(arguments,2),isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,_.property(key))},_.where=function(obj,attrs){return _.filter(obj,_.matches(attrs))},_.findWhere=function(obj,attrs){return _.find(obj,_.matches(attrs))},_.max=function(obj,iteratee,context){var value,computed,result=-1/0,lastComputed=-1/0;if(null==iteratee&&null!=obj){obj=obj.length===+obj.length?obj:_.values(obj);for(var i=0,length=obj.length;length>i;i++)value=obj[i],value>result&&(result=value)}else iteratee=_.iteratee(iteratee,context),_.each(obj,function(value,index,list){computed=iteratee(value,index,list),(computed>lastComputed||computed===-1/0&&result===-1/0)&&(result=value,lastComputed=computed)});return result},_.min=function(obj,iteratee,context){var value,computed,result=1/0,lastComputed=1/0;if(null==iteratee&&null!=obj){obj=obj.length===+obj.length?obj:_.values(obj);for(var i=0,length=obj.length;length>i;i++)value=obj[i],result>value&&(result=value)}else iteratee=_.iteratee(iteratee,context),_.each(obj,function(value,index,list){computed=iteratee(value,index,list),(lastComputed>computed||1/0===computed&&1/0===result)&&(result=value,lastComputed=computed)});return result},_.shuffle=function(obj){for(var rand,set=obj&&obj.length===+obj.length?obj:_.values(obj),length=set.length,shuffled=Array(length),index=0;length>index;index++)rand=_.random(0,index),rand!==index&&(shuffled[index]=shuffled[rand]),shuffled[rand]=set[index];return shuffled},_.sample=function(obj,n,guard){return null==n||guard?(obj.length!==+obj.length&&(obj=_.values(obj)),obj[_.random(obj.length-1)]):_.shuffle(obj).slice(0,Math.max(0,n))},_.sortBy=function(obj,iteratee,context){return iteratee=_.iteratee(iteratee,context),_.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(a>b||void 0===a)return 1;if(b>a||void 0===b)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};return iteratee=_.iteratee(iteratee,context),_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)}),result}};_.groupBy=group(function(result,value,key){_.has(result,key)?result[key].push(value):result[key]=[value]}),_.indexBy=group(function(result,value,key){result[key]=value}),_.countBy=group(function(result,value,key){_.has(result,key)?result[key]++:result[key]=1}),_.sortedIndex=function(array,obj,iteratee,context){iteratee=_.iteratee(iteratee,context,1);for(var value=iteratee(obj),low=0,high=array.length;high>low;){var mid=low+high>>>1;iteratee(array[mid])<value?low=mid+1:high=mid}return low},_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):obj.length===+obj.length?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return null==obj?0:obj.length===+obj.length?obj.length:_.keys(obj).length},_.partition=function(obj,predicate,context){predicate=_.iteratee(predicate,context);var pass=[],fail=[];return _.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)}),[pass,fail]},_.first=_.head=_.take=function(array,n,guard){return null==array?void 0:null==n||guard?array[0]:0>n?[]:slice.call(array,0,n)},_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(null==n||guard?1:n)))},_.last=function(array,n,guard){return null==array?void 0:null==n||guard?array[array.length-1]:slice.call(array,Math.max(array.length-n,0))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,null==n||guard?1:n)},_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,output){if(shallow&&_.every(input,_.isArray))return concat.apply(output,input);for(var i=0,length=input.length;length>i;i++){var value=input[i];_.isArray(value)||_.isArguments(value)?shallow?push.apply(output,value):flatten(value,shallow,strict,output):strict||output.push(value)}return output};_.flatten=function(array,shallow){return flatten(array,shallow,!1,[])},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.uniq=_.unique=function(array,isSorted,iteratee,context){if(null==array)return[];_.isBoolean(isSorted)||(context=iteratee,iteratee=isSorted,isSorted=!1),null!=iteratee&&(iteratee=_.iteratee(iteratee,context));for(var result=[],seen=[],i=0,length=array.length;length>i;i++){var value=array[i];if(isSorted)i&&seen===value||result.push(value),seen=value;else if(iteratee){var computed=iteratee(value,i,array);_.indexOf(seen,computed)<0&&(seen.push(computed),result.push(value))}else _.indexOf(result,value)<0&&result.push(value)}return result},_.union=function(){return _.uniq(flatten(arguments,!0,!0,[]))},_.intersection=function(array){if(null==array)return[];for(var result=[],argsLength=arguments.length,i=0,length=array.length;length>i;i++){var item=array[i];if(!_.contains(result,item)){for(var j=1;argsLength>j&&_.contains(arguments[j],item);j++);j===argsLength&&result.push(item)}}return result},_.difference=function(array){var rest=flatten(slice.call(arguments,1),!0,!0,[]);return _.filter(array,function(value){return!_.contains(rest,value)})},_.zip=function(array){if(null==array)return[];for(var length=_.max(arguments,"length").length,results=Array(length),i=0;length>i;i++)results[i]=_.pluck(arguments,i);return results},_.object=function(list,values){if(null==list)return{};for(var result={},i=0,length=list.length;length>i;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result},_.indexOf=function(array,item,isSorted){if(null==array)return-1;var i=0,length=array.length;if(isSorted){if("number"!=typeof isSorted)return i=_.sortedIndex(array,item),array[i]===item?i:-1;i=0>isSorted?Math.max(0,length+isSorted):isSorted}for(;length>i;i++)if(array[i]===item)return i;return-1},_.lastIndexOf=function(array,item,from){if(null==array)return-1;var idx=array.length;for("number"==typeof from&&(idx=0>from?idx+from+1:Math.min(idx,from+1));--idx>=0;)if(array[idx]===item)return idx;return-1},_.range=function(start,stop,step){arguments.length<=1&&(stop=start||0,start=0),step=step||1;for(var length=Math.max(Math.ceil((stop-start)/step),0),range=Array(length),idx=0;length>idx;idx++,start+=step)range[idx]=start;return range};var Ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");return args=slice.call(arguments,2),bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));Ctor.prototype=func.prototype;var self=new Ctor;Ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));return _.isObject(result)?result:self}},_.partial=function(func){var boundArgs=slice.call(arguments,1);return function(){for(var position=0,args=boundArgs.slice(),i=0,length=args.length;length>i;i++)args[i]===_&&(args[i]=arguments[position++]);for(;position<arguments.length;)args.push(arguments[position++]);return func.apply(this,args)}},_.bindAll=function(obj){var i,key,length=arguments.length;if(1>=length)throw new Error("bindAll must be passed function names");for(i=1;length>i;i++)key=arguments[i],obj[key]=_.bind(obj[key],obj);return obj},_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache,address=hasher?hasher.apply(this,arguments):key;return _.has(cache,address)||(cache[address]=func.apply(this,arguments)),cache[address]};return memoize.cache={},memoize},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))},_.throttle=function(func,wait,options){var context,args,result,timeout=null,previous=0;options||(options={});var later=function(){previous=options.leading===!1?0:_.now(),timeout=null,result=func.apply(context,args),timeout||(context=args=null)};return function(){var now=_.now();previous||options.leading!==!1||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,0>=remaining||remaining>wait?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args),timeout||(context=args=null)):timeout||options.trailing===!1||(timeout=setTimeout(later,remaining)),result}},_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result,later=function(){var last=_.now()-timestamp;wait>last&&last>0?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args),timeout||(context=args=null)))};return function(){context=this,args=arguments,timestamp=_.now();var callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=func.apply(context,args),context=args=null),result}},_.wrap=function(func,wrapper){return _.partial(wrapper,func)},_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}},_.compose=function(){var args=arguments,start=args.length-1;return function(){for(var i=start,result=args[start].apply(this,arguments);i--;)result=args[i].call(this,result);return result}},_.after=function(times,func){return function(){return--times<1?func.apply(this,arguments):void 0}},_.before=function(times,func){var memo;return function(){return--times>0?memo=func.apply(this,arguments):func=null,memo}},_.once=_.partial(_.before,2),_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)_.has(obj,key)&&keys.push(key);return keys},_.values=function(obj){for(var keys=_.keys(obj),length=keys.length,values=Array(length),i=0;length>i;i++)values[i]=obj[keys[i]];return values},_.pairs=function(obj){for(var keys=_.keys(obj),length=keys.length,pairs=Array(length),i=0;length>i;i++)pairs[i]=[keys[i],obj[keys[i]]];return pairs},_.invert=function(obj){for(var result={},keys=_.keys(obj),i=0,length=keys.length;length>i;i++)result[obj[keys[i]]]=keys[i];return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=function(obj){if(!_.isObject(obj))return obj;for(var source,prop,i=1,length=arguments.length;length>i;i++){source=arguments[i];for(prop in source)hasOwnProperty.call(source,prop)&&(obj[prop]=source[prop])}return obj},_.pick=function(obj,iteratee,context){var key,result={};if(null==obj)return result;if(_.isFunction(iteratee)){iteratee=createCallback(iteratee,context);for(key in obj){var value=obj[key];iteratee(value,key,obj)&&(result[key]=value)}}else{var keys=concat.apply([],slice.call(arguments,1));obj=new Object(obj);for(var i=0,length=keys.length;length>i;i++)key=keys[i],key in obj&&(result[key]=obj[key])}return result},_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee))iteratee=_.negate(iteratee);else{var keys=_.map(concat.apply([],slice.call(arguments,1)),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)},_.defaults=function(obj){if(!_.isObject(obj))return obj;for(var i=1,length=arguments.length;length>i;i++){var source=arguments[i];for(var prop in source)void 0===obj[prop]&&(obj[prop]=source[prop])}return obj},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj};var eq=function(a,b,aStack,bStack){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!==toString.call(b))return!1;switch(className){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}if("object"!=typeof a||"object"!=typeof b)return!1;for(var length=aStack.length;length--;)if(aStack[length]===a)return bStack[length]===b;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&"constructor"in a&&"constructor"in b&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor))return!1;aStack.push(a),bStack.push(b);var size,result;if("[object Array]"===className){if(size=a.length,result=size===b.length)for(;size--&&(result=eq(a[size],b[size],aStack,bStack)););}else{var key,keys=_.keys(a);if(size=keys.length,result=_.keys(b).length===size)for(;size--&&(key=keys[size],result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)););}return aStack.pop(),bStack.pop(),result};_.isEqual=function(a,b){return eq(a,b,[],[])},_.isEmpty=function(obj){if(null==obj)return!0;if(_.isArray(obj)||_.isString(obj)||_.isArguments(obj))return 0===obj.length;for(var key in obj)if(_.has(obj,key))return!1;return!0},_.isElement=function(obj){return!(!obj||1!==obj.nodeType)},_.isArray=nativeIsArray||function(obj){return"[object Array]"===toString.call(obj)},_.isObject=function(obj){var type=typeof obj;return"function"===type||"object"===type&&!!obj},_.each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return _.has(obj,"callee")}),"function"!=typeof/./&&(_.isFunction=function(obj){return"function"==typeof obj||!1}),_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj},_.isBoolean=function(obj){return obj===!0||obj===!1||"[object Boolean]"===toString.call(obj)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.has=function(obj,key){return null!=obj&&hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.constant=function(value){return function(){return value}},_.noop=function(){},_.property=function(key){return function(obj){return obj[key]}},_.matches=function(attrs){var pairs=_.pairs(attrs),length=pairs.length;return function(obj){if(null==obj)return!length;obj=new Object(obj);for(var i=0;length>i;i++){var pair=pairs[i],key=pair[0];if(pair[1]!==obj[key]||!(key in obj))return!1}return!0}},_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=createCallback(iteratee,context,1);for(var i=0;n>i;i++)accum[i]=iteratee(i);return accum},_.random=function(min,max){return null==max&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))},_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},unescapeMap=_.invert(escapeMap),createEscaper=function(map){var escaper=function(match){return map[match]},source="(?:"+_.keys(map).join("|")+")",testRegexp=RegExp(source),replaceRegexp=RegExp(source,"g");return function(string){return string=null==string?"":""+string,testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap),_.unescape=createEscaper(unescapeMap),_.result=function(object,property){if(null==object)return void 0;var value=object[property];return _.isFunction(value)?object[property]():value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\u2028|\u2029/g,escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){!settings&&oldSettings&&(settings=oldSettings),settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escaper,escapeChar),index=offset+match.length,escape?source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'":interpolate?source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'":evaluate&&(source+="';\n"+evaluate+"\n__p+='"),match}),source+="';\n",settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}var template=function(data){return render.call(this,data,_)},argument=settings.variable||"obj";return template.source="function("+argument+"){\n"+source+"}",template},_.chain=function(obj){var instance=_(obj);return instance._chain=!0,instance};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),result.call(this,func.apply(_,args))}})},_.mixin(_),_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),"shift"!==name&&"splice"!==name||0!==obj.length||delete obj[0],result.call(this,obj)}}),_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}}),_.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}.call(this),function(){var magic=this.magic={},canvas=null,rawCanvasCtx=null,encoder=new GIFEncoder;encoder.setRepeat(0),encoder.setDelay(1e3/30);var startRecordingTime=null,lastDrawTime=null;magic.loadCanvas=function(canvasId){rawCanvasCtx=document.getElementById(canvasId).getContext("2d"),canvas=new fabric.Canvas(canvasId)},magic.loadBg=function(){fabric.Image.fromURL("/public/images/magic/sample_doodle1.png",function(img){canvas.add(img)})},magic.loadImageFile=function(evt){var tgt=evt.target||window.event.srcElement,files=tgt.files,image=new Image;if(FileReader&&files&&files.length){var fr=new FileReader;fr.onload=function(){image.src=fr.result;var imgInstance=new fabric.Image(image,{left:0,top:0});canvas.add(imgInstance)},fr.readAsDataURL(files[0])}},magic.addAnimation=function(){var img=new Image;img.src="/public/images/magic/train.png",encoder.start(),img.onload=function(){var imgInstance=new fabric.Image(this,{left:0,top:0});imgInstance.animate("left",600,{onChange:canvas.renderAll.bind(canvas),duration:1e3}),canvas.add(imgInstance)},requestAnimationFrame(magic.recordFrame)},magic.startStopRecord=function(){requestAnimationFrame(magic.recordFrame)},magic.recordFrame=function(timestamp){if(console.log("abc ----------------"),null===startRecordingTime&&(startRecordingTime=timestamp),timestamp-startRecordingTime>5e3){lastDrawTime=null,startRecordingTime=null,encoder.finish();var binary_gif=encoder.stream().getData(),data_url="data:image/gif;base64,"+encode64(binary_gif);return localStorage.setItem("data_url",data_url),void console.log(data_url.length)}(null===lastDrawTime||timestamp-lastDrawTime>33)&&(encoder.addFrame(canvas.contextContainer),lastDrawTime=timestamp),window.requestAnimationFrame(magic.recordFrame)},magic.preview=function(){window.location.href="preview.html"},magic.canvas=function(){return canvas}}.call(this),jQuery(document).ready(function($){$("#magicpage").height=String(window.innerHeight)+"px",$("#magicpage").width=String(window.innerWidth)+"px",magic.loadCanvas("playground"),magic.loadBg(),$("#image4doodle").change(magic.loadImageFile),$("#addAnimation").click(magic.addAnimation),$("#startRecord").click(magic.startStopRecord),$("#preview").click(magic.preview)}),GIFEncoder=function(){function ByteArray(){this.bin=[]}for(var i=0,chr={};256>i;i++)chr[i]=String.fromCharCode(i);ByteArray.prototype.getData=function(){for(var v="",l=this.bin.length,i=0;l>i;i++)v+=chr[this.bin[i]];return v},ByteArray.prototype.writeByte=function(val){this.bin.push(val)},ByteArray.prototype.writeUTFBytes=function(string){for(var l=string.length,i=0;l>i;i++)this.writeByte(string.charCodeAt(i))},ByteArray.prototype.writeBytes=function(array,offset,length){for(var l=length||array.length,i=offset||0;l>i;i++)this.writeByte(array[i])};{var width,height,transIndex,out,image,pixels,indexedPixels,colorDepth,colorTab,exports={},transparent=null,repeat=-1,delay=0,started=!1,usedEntry=[],palSize=7,dispose=-1,closeStream=!1,firstFrame=!0,sizeSet=!1,sample=10,comment="Generated by jsgif (https://github.com/antimatter15/jsgif/)",reset=(exports.setDelay=function(ms){delay=Math.round(ms/10)},exports.setDispose=function(code){code>=0&&(dispose=code)},exports.setRepeat=function(iter){iter>=0&&(repeat=iter)},exports.setTransparent=function(c){transparent=c},exports.setComment=function(c){comment=c},exports.addFrame=function(im,is_imageData){if(null===im||!started||null===out)throw new Error("Please call start method before calling addFrame");var ok=!0;try{is_imageData?image=im:(image=im.getImageData(0,0,im.canvas.width,im.canvas.height).data,sizeSet||setSize(im.canvas.width,im.canvas.height)),getImagePixels(),analyzePixels(),firstFrame&&(writeLSD(),writePalette(),repeat>=0&&writeNetscapeExt()),writeGraphicCtrlExt(),""!==comment&&writeCommentExt(),writeImageDesc(),firstFrame||writePalette(),writePixels(),firstFrame=!1}catch(e){ok=!1}return ok},exports.finish=function(){if(!started)return!1;var ok=!0;started=!1;try{out.writeByte(59)}catch(e){ok=!1}return ok},function(){transIndex=0,image=null,pixels=null,indexedPixels=null,colorTab=null,closeStream=!1,firstFrame=!0}),setSize=(exports.setFrameRate=function(fps){15!=fps&&(delay=Math.round(100/fps))},exports.setQuality=function(quality){1>quality&&(quality=1),sample=quality},exports.setSize=function(w,h){(!started||firstFrame)&&(width=w,height=h,1>width&&(width=320),1>height&&(height=240),sizeSet=!0)}),analyzePixels=(exports.start=function(){reset();var ok=!0;closeStream=!1,out=new ByteArray;try{out.writeUTFBytes("GIF89a")}catch(e){ok=!1}return started=ok},exports.cont=function(){reset();var ok=!0;return closeStream=!1,out=new ByteArray,started=ok},function(){var len=pixels.length,nPix=len/3;indexedPixels=[];var nq=new NeuQuant(pixels,len,sample);colorTab=nq.process();for(var k=0,j=0;nPix>j;j++){var index=nq.map(255&pixels[k++],255&pixels[k++],255&pixels[k++]);usedEntry[index]=!0,indexedPixels[j]=index}pixels=null,colorDepth=8,palSize=7,null!==transparent&&(transIndex=findClosest(transparent))}),findClosest=function(c){if(null===colorTab)return-1;for(var r=(16711680&c)>>16,g=(65280&c)>>8,b=255&c,minpos=0,dmin=16777216,len=colorTab.length,i=0;len>i;){var dr=r-(255&colorTab[i++]),dg=g-(255&colorTab[i++]),db=b-(255&colorTab[i]),d=dr*dr+dg*dg+db*db,index=i/3;usedEntry[index]&&dmin>d&&(dmin=d,minpos=index),i++}return minpos},getImagePixels=function(){var w=width,h=height;pixels=[];for(var data=image,count=0,i=0;h>i;i++)for(var j=0;w>j;j++){var b=i*w*4+4*j;pixels[count++]=data[b],pixels[count++]=data[b+1],pixels[count++]=data[b+2]}},writeGraphicCtrlExt=function(){out.writeByte(33),out.writeByte(249),out.writeByte(4);var transp,disp;null===transparent?(transp=0,disp=0):(transp=1,disp=2),dispose>=0&&(disp=7&dispose),disp<<=2,out.writeByte(0|disp|0|transp),WriteShort(delay),out.writeByte(transIndex),out.writeByte(0)},writeCommentExt=function(){out.writeByte(33),out.writeByte(254),out.writeByte(comment.length),out.writeUTFBytes(comment),out.writeByte(0)},writeImageDesc=function(){out.writeByte(44),WriteShort(0),WriteShort(0),WriteShort(width),WriteShort(height),out.writeByte(firstFrame?0:128|palSize)},writeLSD=function(){WriteShort(width),WriteShort(height),out.writeByte(240|palSize),out.writeByte(0),out.writeByte(0)},writeNetscapeExt=function(){out.writeByte(33),out.writeByte(255),out.writeByte(11),out.writeUTFBytes("NETSCAPE2.0"),out.writeByte(3),out.writeByte(1),WriteShort(repeat),out.writeByte(0)},writePalette=function(){out.writeBytes(colorTab);for(var n=768-colorTab.length,i=0;n>i;i++)out.writeByte(0)},WriteShort=function(pValue){out.writeByte(255&pValue),out.writeByte(pValue>>8&255)},writePixels=function(){var myencoder=new LZWEncoder(width,height,indexedPixels,colorDepth);myencoder.encode(out)};exports.stream=function(){return out},exports.setProperties=function(has_start,is_first){started=has_start,firstFrame=is_first}}return exports},LZWEncoder=function(){var imgW,imgH,pixAry,initCodeSize,remaining,curPixel,n_bits,maxcode,g_init_bits,ClearCode,EOFCode,a_count,exports={},EOF=-1,BITS=12,HSIZE=5003,maxbits=BITS,maxmaxcode=1<<BITS,htab=[],codetab=[],hsize=HSIZE,free_ent=0,clear_flg=!1,cur_accum=0,cur_bits=0,masks=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],accum=[],LZWEncoder=exports.LZWEncoder=function(width,height,pixels,color_depth){imgW=width,imgH=height,pixAry=pixels,initCodeSize=Math.max(2,color_depth)},char_out=function(c,outs){accum[a_count++]=c,a_count>=254&&flush_char(outs)},cl_block=function(outs){cl_hash(hsize),free_ent=ClearCode+2,clear_flg=!0,output(ClearCode,outs)},cl_hash=function(hsize){for(var i=0;hsize>i;++i)htab[i]=-1},compress=exports.compress=function(init_bits,outs){var fcode,i,c,ent,disp,hsize_reg,hshift;for(g_init_bits=init_bits,clear_flg=!1,n_bits=g_init_bits,maxcode=MAXCODE(n_bits),ClearCode=1<<init_bits-1,EOFCode=ClearCode+1,free_ent=ClearCode+2,a_count=0,ent=nextPixel(),hshift=0,fcode=hsize;65536>fcode;fcode*=2)++hshift;hshift=8-hshift,hsize_reg=hsize,cl_hash(hsize_reg),output(ClearCode,outs);outer_loop:for(;(c=nextPixel())!=EOF;)if(fcode=(c<<maxbits)+ent,i=c<<hshift^ent,htab[i]!=fcode){if(htab[i]>=0){disp=hsize_reg-i,0===i&&(disp=1);do if((i-=disp)<0&&(i+=hsize_reg),htab[i]==fcode){ent=codetab[i];continue outer_loop}while(htab[i]>=0)}output(ent,outs),ent=c,maxmaxcode>free_ent?(codetab[i]=free_ent++,htab[i]=fcode):cl_block(outs)}else ent=codetab[i];output(ent,outs),output(EOFCode,outs)},flush_char=(exports.encode=function(os){os.writeByte(initCodeSize),remaining=imgW*imgH,curPixel=0,compress(initCodeSize+1,os),os.writeByte(0)},function(outs){a_count>0&&(outs.writeByte(a_count),outs.writeBytes(accum,0,a_count),a_count=0)}),MAXCODE=function(n_bits){return(1<<n_bits)-1},nextPixel=function(){if(0===remaining)return EOF;--remaining;var pix=pixAry[curPixel++];return 255&pix},output=function(code,outs){for(cur_accum&=masks[cur_bits],cur_bits>0?cur_accum|=code<<cur_bits:cur_accum=code,cur_bits+=n_bits;cur_bits>=8;)char_out(255&cur_accum,outs),cur_accum>>=8,cur_bits-=8;if((free_ent>maxcode||clear_flg)&&(clear_flg?(maxcode=MAXCODE(n_bits=g_init_bits),clear_flg=!1):(++n_bits,maxcode=n_bits==maxbits?maxmaxcode:MAXCODE(n_bits))),code==EOFCode){for(;cur_bits>0;)char_out(255&cur_accum,outs),cur_accum>>=8,cur_bits-=8;flush_char(outs)}};return LZWEncoder.apply(this,arguments),exports},NeuQuant=function(){var alphadec,thepicture,lengthcount,samplefac,network,exports={},netsize=256,prime1=499,prime2=491,prime3=487,prime4=503,minpicturebytes=3*prime4,maxnetpos=netsize-1,netbiasshift=4,ncycles=100,intbiasshift=16,intbias=1<<intbiasshift,gammashift=10,betashift=10,beta=intbias>>betashift,betagamma=intbias<<gammashift-betashift,initrad=netsize>>3,radiusbiasshift=6,radiusbias=1<<radiusbiasshift,initradius=initrad*radiusbias,radiusdec=30,alphabiasshift=10,initalpha=1<<alphabiasshift,radbiasshift=8,radbias=1<<radbiasshift,alpharadbshift=alphabiasshift+radbiasshift,alpharadbias=1<<alpharadbshift,netindex=[],bias=[],freq=[],radpower=[],NeuQuant=exports.NeuQuant=function(thepic,len,sample){var i,p;for(thepicture=thepic,lengthcount=len,samplefac=sample,network=new Array(netsize),i=0;netsize>i;i++)network[i]=new Array(4),p=network[i],p[0]=p[1]=p[2]=(i<<netbiasshift+8)/netsize,freq[i]=intbias/netsize,bias[i]=0},colorMap=function(){for(var map=[],index=new Array(netsize),i=0;netsize>i;i++)index[network[i][3]]=i;for(var k=0,l=0;netsize>l;l++){var j=index[l];map[k++]=network[j][0],map[k++]=network[j][1],map[k++]=network[j][2]}return map},inxbuild=function(){var i,j,smallpos,smallval,p,q,previouscol,startpos;for(previouscol=0,startpos=0,i=0;netsize>i;i++){for(p=network[i],smallpos=i,smallval=p[1],j=i+1;netsize>j;j++)q=network[j],q[1]<smallval&&(smallpos=j,smallval=q[1]);if(q=network[smallpos],i!=smallpos&&(j=q[0],q[0]=p[0],p[0]=j,j=q[1],q[1]=p[1],p[1]=j,j=q[2],q[2]=p[2],p[2]=j,j=q[3],q[3]=p[3],p[3]=j),smallval!=previouscol){for(netindex[previouscol]=startpos+i>>1,j=previouscol+1;smallval>j;j++)netindex[j]=i;previouscol=smallval,startpos=i}}for(netindex[previouscol]=startpos+maxnetpos>>1,j=previouscol+1;256>j;j++)netindex[j]=maxnetpos},learn=function(){var i,j,b,g,r,radius,rad,alpha,step,delta,samplepixels,p,pix,lim;for(minpicturebytes>lengthcount&&(samplefac=1),alphadec=30+(samplefac-1)/3,p=thepicture,pix=0,lim=lengthcount,samplepixels=lengthcount/(3*samplefac),delta=samplepixels/ncycles|0,alpha=initalpha,radius=initradius,rad=radius>>radiusbiasshift,1>=rad&&(rad=0),i=0;rad>i;i++)radpower[i]=alpha*((rad*rad-i*i)*radbias/(rad*rad));for(step=minpicturebytes>lengthcount?3:lengthcount%prime1!==0?3*prime1:lengthcount%prime2!==0?3*prime2:lengthcount%prime3!==0?3*prime3:3*prime4,i=0;samplepixels>i;)if(b=(255&p[pix+0])<<netbiasshift,g=(255&p[pix+1])<<netbiasshift,r=(255&p[pix+2])<<netbiasshift,j=contest(b,g,r),altersingle(alpha,j,b,g,r),0!==rad&&alterneigh(rad,j,b,g,r),pix+=step,pix>=lim&&(pix-=lengthcount),i++,0===delta&&(delta=1),i%delta===0)for(alpha-=alpha/alphadec,radius-=radius/radiusdec,rad=radius>>radiusbiasshift,1>=rad&&(rad=0),j=0;rad>j;j++)radpower[j]=alpha*((rad*rad-j*j)*radbias/(rad*rad))},unbiasnet=(exports.map=function(b,g,r){var i,j,dist,a,bestd,p,best;for(bestd=1e3,best=-1,i=netindex[g],j=i-1;netsize>i||j>=0;)netsize>i&&(p=network[i],dist=p[1]-g,dist>=bestd?i=netsize:(i++,0>dist&&(dist=-dist),a=p[0]-b,0>a&&(a=-a),dist+=a,bestd>dist&&(a=p[2]-r,0>a&&(a=-a),dist+=a,bestd>dist&&(bestd=dist,best=p[3])))),j>=0&&(p=network[j],dist=g-p[1],dist>=bestd?j=-1:(j--,0>dist&&(dist=-dist),a=p[0]-b,0>a&&(a=-a),dist+=a,bestd>dist&&(a=p[2]-r,0>a&&(a=-a),dist+=a,bestd>dist&&(bestd=dist,best=p[3]))));return best},exports.process=function(){return learn(),unbiasnet(),inxbuild(),colorMap()},function(){var i;for(i=0;netsize>i;i++)network[i][0]>>=netbiasshift,network[i][1]>>=netbiasshift,network[i][2]>>=netbiasshift,network[i][3]=i}),alterneigh=function(rad,i,b,g,r){var j,k,lo,hi,a,m,p;for(lo=i-rad,-1>lo&&(lo=-1),hi=i+rad,hi>netsize&&(hi=netsize),j=i+1,k=i-1,m=1;hi>j||k>lo;){if(a=radpower[m++],hi>j){p=network[j++];try{p[0]-=a*(p[0]-b)/alpharadbias,p[1]-=a*(p[1]-g)/alpharadbias,p[2]-=a*(p[2]-r)/alpharadbias}catch(e){}}if(k>lo){p=network[k--];try{p[0]-=a*(p[0]-b)/alpharadbias,p[1]-=a*(p[1]-g)/alpharadbias,p[2]-=a*(p[2]-r)/alpharadbias
}catch(e){}}}},altersingle=function(alpha,i,b,g,r){var n=network[i];n[0]-=alpha*(n[0]-b)/initalpha,n[1]-=alpha*(n[1]-g)/initalpha,n[2]-=alpha*(n[2]-r)/initalpha},contest=function(b,g,r){var i,dist,a,biasdist,betafreq,bestpos,bestbiaspos,bestd,bestbiasd,n;for(bestd=~(1<<31),bestbiasd=bestd,bestpos=-1,bestbiaspos=bestpos,i=0;netsize>i;i++)n=network[i],dist=n[0]-b,0>dist&&(dist=-dist),a=n[1]-g,0>a&&(a=-a),dist+=a,a=n[2]-r,0>a&&(a=-a),dist+=a,bestd>dist&&(bestd=dist,bestpos=i),biasdist=dist-(bias[i]>>intbiasshift-netbiasshift),bestbiasd>biasdist&&(bestbiasd=biasdist,bestbiaspos=i),betafreq=freq[i]>>betashift,freq[i]-=betafreq,bias[i]+=betafreq<<gammashift;return freq[bestpos]+=beta,bias[bestpos]-=betagamma,bestbiaspos};return NeuQuant.apply(this,arguments),exports};var fabric=fabric||{version:"1.3.12"};"undefined"!=typeof exports&&(exports.fabric=fabric),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.window=fabric.document.createWindow()),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"],function(){function _removeEventListener(eventName,handler){this.__eventListeners[eventName]&&(handler?fabric.util.removeFromArray(this.__eventListeners[eventName],handler):this.__eventListeners[eventName].length=0)}function observe(eventName,handler){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var prop in eventName)this.on(prop,eventName[prop]);else this.__eventListeners[eventName]||(this.__eventListeners[eventName]=[]),this.__eventListeners[eventName].push(handler);return this}function stopObserving(eventName,handler){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"==typeof arguments[0])for(var prop in eventName)_removeEventListener.call(this,prop,eventName[prop]);else _removeEventListener.call(this,eventName,handler);return this}}function fire(eventName,options){if(this.__eventListeners){var listenersForEvent=this.__eventListeners[eventName];if(listenersForEvent){for(var i=0,len=listenersForEvent.length;len>i;i++)listenersForEvent[i].call(this,options||{});return this}}}fabric.Observable={observe:observe,stopObserving:stopObserving,fire:fire,on:observe,off:stopObserving,trigger:fire}}(),fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var i=arguments.length;i--;)this._onObjectAdded(arguments[i]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(object,index,nonSplicing){var objects=this.getObjects();return nonSplicing?objects[index]=object:objects.splice(index,0,object),this._onObjectAdded(object),this.renderOnAddRemove&&this.renderAll(),this},remove:function(object){var objects=this.getObjects(),index=objects.indexOf(object);return-1!==index&&(objects.splice(index,1),this._onObjectRemoved(object)),this.renderOnAddRemove&&this.renderAll(),object},forEachObject:function(callback,context){for(var objects=this.getObjects(),i=objects.length;i--;)callback.call(context,objects[i],i,objects);return this},getObjects:function(type){return"undefined"==typeof type?this._objects:this._objects.filter(function(o){return o.type===type})},item:function(index){return this.getObjects()[index]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(object){return this.getObjects().indexOf(object)>-1},complexity:function(){return this.getObjects().reduce(function(memo,current){return memo+=current.complexity?current.complexity():0},0)}},function(global){var sqrt=Math.sqrt,atan2=Math.atan2,PiBy180=Math.PI/180;fabric.util={removeFromArray:function(array,value){var idx=array.indexOf(value);return-1!==idx&&array.splice(idx,1),array},getRandomInt:function(min,max){return Math.floor(Math.random()*(max-min+1))+min},degreesToRadians:function(degrees){return degrees*PiBy180},radiansToDegrees:function(radians){return radians/PiBy180},rotatePoint:function(point,origin,radians){var sin=Math.sin(radians),cos=Math.cos(radians);point.subtractEquals(origin);var rx=point.x*cos-point.y*sin,ry=point.x*sin+point.y*cos;return new fabric.Point(rx,ry).addEquals(origin)},toFixed:function(number,fractionDigits){return parseFloat(Number(number).toFixed(fractionDigits))},falseFunction:function(){return!1},getKlass:function(type,namespace){return type=fabric.util.string.camelize(type.charAt(0).toUpperCase()+type.slice(1)),fabric.util.resolveNamespace(namespace)[type]},resolveNamespace:function(namespace){if(!namespace)return fabric;for(var parts=namespace.split("."),len=parts.length,obj=global||fabric.window,i=0;len>i;++i)obj=obj[parts[i]];return obj},loadImage:function(url,callback,context,crossOrigin){if(!url)return void(callback&&callback.call(context,url));var img=fabric.util.createImage();img.onload=function(){callback&&callback.call(context,img),img=img.onload=img.onerror=null},img.onerror=function(){fabric.log("Error loading "+img.src),callback&&callback.call(context,null,!0),img=img.onload=img.onerror=null},0!==url.indexOf("data")&&(img.crossOrigin=crossOrigin||""),img.src=url},enlivenObjects:function(objects,callback,namespace,reviver){function onLoaded(){++numLoadedObjects===numTotalObjects&&callback&&callback(enlivenedObjects)}objects=objects||[];var enlivenedObjects=[],numLoadedObjects=0,numTotalObjects=objects.length;return numTotalObjects?void objects.forEach(function(o,index){if(!o||!o.type)return void onLoaded();var klass=fabric.util.getKlass(o.type,namespace);klass.async?klass.fromObject(o,function(obj,error){error||(enlivenedObjects[index]=obj,reviver&&reviver(o,enlivenedObjects[index])),onLoaded()}):(enlivenedObjects[index]=klass.fromObject(o),reviver&&reviver(o,enlivenedObjects[index]),onLoaded())}):void(callback&&callback(enlivenedObjects))},groupSVGElements:function(elements,options,path){var object;return object=elements.length>1?new fabric.PathGroup(elements,options):elements[0],"undefined"!=typeof path&&object.setSourcePath(path),object},populateWithProperties:function(source,destination,properties){if(properties&&"[object Array]"===Object.prototype.toString.call(properties))for(var i=0,len=properties.length;len>i;i++)properties[i]in source&&(destination[properties[i]]=source[properties[i]])},drawDashedLine:function(ctx,x,y,x2,y2,da){var dx=x2-x,dy=y2-y,len=sqrt(dx*dx+dy*dy),rot=atan2(dy,dx),dc=da.length,di=0,draw=!0;for(ctx.save(),ctx.translate(x,y),ctx.moveTo(0,0),ctx.rotate(rot),x=0;len>x;)x+=da[di++%dc],x>len&&(x=len),ctx[draw?"lineTo":"moveTo"](x,0),draw=!draw;ctx.restore()},createCanvasElement:function(canvasEl){return canvasEl||(canvasEl=fabric.document.createElement("canvas")),canvasEl.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(canvasEl),canvasEl},createImage:function(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(klass){for(var proto=klass.prototype,i=proto.stateProperties.length;i--;){var propName=proto.stateProperties[i],capitalizedPropName=propName.charAt(0).toUpperCase()+propName.slice(1),setterName="set"+capitalizedPropName,getterName="get"+capitalizedPropName;proto[getterName]||(proto[getterName]=function(property){return new Function('return this.get("'+property+'")')}(propName)),proto[setterName]||(proto[setterName]=function(property){return new Function("value",'return this.set("'+property+'", value)')}(propName))}},clipContext:function(receiver,ctx){ctx.save(),ctx.beginPath(),receiver.clipTo(ctx),ctx.clip()},multiplyTransformMatrices:function(matrixA,matrixB){for(var a=[[matrixA[0],matrixA[2],matrixA[4]],[matrixA[1],matrixA[3],matrixA[5]],[0,0,1]],b=[[matrixB[0],matrixB[2],matrixB[4]],[matrixB[1],matrixB[3],matrixB[5]],[0,0,1]],result=[],r=0;3>r;r++){result[r]=[];for(var c=0;3>c;c++){for(var sum=0,k=0;3>k;k++)sum+=a[r][k]*b[k][c];result[r][c]=sum}}return[result[0][0],result[1][0],result[0][1],result[1][1],result[0][2],result[1][2]]},getFunctionBody:function(fn){return(String(fn).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},normalizePoints:function(points,options){var minX=fabric.util.array.min(points,"x"),minY=fabric.util.array.min(points,"y");minX=0>minX?minX:0,minY=0>minX?minY:0;for(var i=0,len=points.length;len>i;i++)points[i].x-=options.width/2+minX||0,points[i].y-=options.height/2+minY||0},isTransparent:function(ctx,x,y,tolerance){tolerance>0&&(x>tolerance?x-=tolerance:x=0,y>tolerance?y-=tolerance:y=0);for(var _isTransparent=!0,imageData=ctx.getImageData(x,y,2*tolerance||1,2*tolerance||1),i=3,l=imageData.data.length;l>i;i+=4){var temp=imageData.data[i];if(_isTransparent=0>=temp,_isTransparent===!1)break}return imageData=null,_isTransparent}}}("undefined"!=typeof exports?exports:this),function(){function arcToSegments(x,y,rx,ry,large,sweep,rotateX,ox,oy){if(argsString=_join.call(arguments),arcToSegmentsCache[argsString])return arcToSegmentsCache[argsString];var coords=getXYCoords(rotateX,rx,ry,ox,oy,x,y),d=(coords.x1-coords.x0)*(coords.x1-coords.x0)+(coords.y1-coords.y0)*(coords.y1-coords.y0),sfactor_sq=1/d-.25;0>sfactor_sq&&(sfactor_sq=0);var sfactor=Math.sqrt(sfactor_sq);sweep===large&&(sfactor=-sfactor);var xc=.5*(coords.x0+coords.x1)-sfactor*(coords.y1-coords.y0),yc=.5*(coords.y0+coords.y1)+sfactor*(coords.x1-coords.x0),th0=Math.atan2(coords.y0-yc,coords.x0-xc),th1=Math.atan2(coords.y1-yc,coords.x1-xc),th_arc=th1-th0;0>th_arc&&1===sweep?th_arc+=2*Math.PI:th_arc>0&&0===sweep&&(th_arc-=2*Math.PI);for(var segments=Math.ceil(Math.abs(th_arc/(.5*Math.PI+.001))),result=[],i=0;segments>i;i++){var th2=th0+i*th_arc/segments,th3=th0+(i+1)*th_arc/segments;result[i]=[xc,yc,th2,th3,rx,ry,coords.sin_th,coords.cos_th]}return arcToSegmentsCache[argsString]=result,result}function getXYCoords(rotateX,rx,ry,ox,oy,x,y){var th=rotateX*(Math.PI/180),sin_th=Math.sin(th),cos_th=Math.cos(th);rx=Math.abs(rx),ry=Math.abs(ry);var px=cos_th*(ox-x)*.5+sin_th*(oy-y)*.5,py=cos_th*(oy-y)*.5-sin_th*(ox-x)*.5,pl=px*px/(rx*rx)+py*py/(ry*ry);pl>1&&(pl=Math.sqrt(pl),rx*=pl,ry*=pl);var a00=cos_th/rx,a01=sin_th/rx,a10=-sin_th/ry,a11=cos_th/ry;return{x0:a00*ox+a01*oy,y0:a10*ox+a11*oy,x1:a00*x+a01*y,y1:a10*x+a11*y,sin_th:sin_th,cos_th:cos_th}}function segmentToBezier(cx,cy,th0,th1,rx,ry,sin_th,cos_th){if(argsString=_join.call(arguments),segmentToBezierCache[argsString])return segmentToBezierCache[argsString];var a00=cos_th*rx,a01=-sin_th*ry,a10=sin_th*rx,a11=cos_th*ry,th_half=.5*(th1-th0),t=8/3*Math.sin(.5*th_half)*Math.sin(.5*th_half)/Math.sin(th_half),x1=cx+Math.cos(th0)-t*Math.sin(th0),y1=cy+Math.sin(th0)+t*Math.cos(th0),x3=cx+Math.cos(th1),y3=cy+Math.sin(th1),x2=x3+t*Math.sin(th1),y2=y3-t*Math.cos(th1);return segmentToBezierCache[argsString]=[a00*x1+a01*y1,a10*x1+a11*y1,a00*x2+a01*y2,a10*x2+a11*y2,a00*x3+a01*y3,a10*x3+a11*y3],segmentToBezierCache[argsString]}var argsString,arcToSegmentsCache={},segmentToBezierCache={},_join=Array.prototype.join;fabric.util.drawArc=function(ctx,x,y,coords){for(var rx=coords[0],ry=coords[1],rot=coords[2],large=coords[3],sweep=coords[4],ex=coords[5],ey=coords[6],segs=arcToSegments(ex,ey,rx,ry,large,sweep,rot,x,y),i=0;i<segs.length;i++){var bez=segmentToBezier.apply(this,segs[i]);ctx.bezierCurveTo.apply(ctx,bez)}}}(),function(){function invoke(array,method){for(var args=slice.call(arguments,2),result=[],i=0,len=array.length;len>i;i++)result[i]=args.length?array[i][method].apply(array[i],args):array[i][method].call(array[i]);return result}function max(array,byProperty){return find(array,byProperty,function(value1,value2){return value1>=value2})}function min(array,byProperty){return find(array,byProperty,function(value1,value2){return value2>value1})}function find(array,byProperty,condition){if(!array||0===array.length)return void 0;var i=array.length-1,result=byProperty?array[i][byProperty]:array[i];if(byProperty)for(;i--;)condition(array[i][byProperty],result)&&(result=array[i][byProperty]);else for(;i--;)condition(array[i],result)&&(result=array[i]);return result}var slice=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement){if(void 0===this||null===this)throw new TypeError;var t=Object(this),len=t.length>>>0;if(0===len)return-1;var n=0;if(arguments.length>0&&(n=Number(arguments[1]),n!==n?n=0:0!==n&&n!==Number.POSITIVE_INFINITY&&n!==Number.NEGATIVE_INFINITY&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=len)return-1;for(var k=n>=0?n:Math.max(len-Math.abs(n),0);len>k;k++)if(k in t&&t[k]===searchElement)return k;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(fn,context){for(var i=0,len=this.length>>>0;len>i;i++)i in this&&fn.call(context,this[i],i,this)}),Array.prototype.map||(Array.prototype.map=function(fn,context){for(var result=[],i=0,len=this.length>>>0;len>i;i++)i in this&&(result[i]=fn.call(context,this[i],i,this));return result}),Array.prototype.every||(Array.prototype.every=function(fn,context){for(var i=0,len=this.length>>>0;len>i;i++)if(i in this&&!fn.call(context,this[i],i,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(fn,context){for(var i=0,len=this.length>>>0;len>i;i++)if(i in this&&fn.call(context,this[i],i,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(fn,context){for(var val,result=[],i=0,len=this.length>>>0;len>i;i++)i in this&&(val=this[i],fn.call(context,val,i,this)&&result.push(val));return result}),Array.prototype.reduce||(Array.prototype.reduce=function(fn){var rv,len=this.length>>>0,i=0;if(arguments.length>1)rv=arguments[1];else for(;;){if(i in this){rv=this[i++];break}if(++i>=len)throw new TypeError}for(;len>i;i++)i in this&&(rv=fn.call(null,rv,this[i],i,this));return rv}),fabric.util.array={invoke:invoke,min:min,max:max}}(),function(){function extend(destination,source){for(var property in source)destination[property]=source[property];return destination}function clone(object){return extend({},object)}fabric.util.object={extend:extend,clone:clone}}(),function(){function camelize(string){return string.replace(/-+(.)?/g,function(match,character){return character?character.toUpperCase():""})}function capitalize(string,firstLetterOnly){return string.charAt(0).toUpperCase()+(firstLetterOnly?string.slice(1):string.slice(1).toLowerCase())}function escapeXml(string){return string.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:camelize,capitalize:capitalize,escapeXml:escapeXml}}(),function(){var slice=Array.prototype.slice,apply=Function.prototype.apply,Dummy=function(){};Function.prototype.bind||(Function.prototype.bind=function(thisArg){var bound,fn=this,args=slice.call(arguments,1);return bound=args.length?function(){return apply.call(fn,this instanceof Dummy?this:thisArg,args.concat(slice.call(arguments)))}:function(){return apply.call(fn,this instanceof Dummy?this:thisArg,arguments)},Dummy.prototype=this.prototype,bound.prototype=new Dummy,bound})}(),function(){function Subclass(){}function callSuper(methodName){var fn=this.constructor.superclass.prototype[methodName];return arguments.length>1?fn.apply(this,slice.call(arguments,1)):fn.call(this)}function createClass(){function klass(){this.initialize.apply(this,arguments)}var parent=null,properties=slice.call(arguments,0);"function"==typeof properties[0]&&(parent=properties.shift()),klass.superclass=parent,klass.subclasses=[],parent&&(Subclass.prototype=parent.prototype,klass.prototype=new Subclass,parent.subclasses.push(klass));for(var i=0,length=properties.length;length>i;i++)addMethods(klass,properties[i],parent);return klass.prototype.initialize||(klass.prototype.initialize=emptyFunction),klass.prototype.constructor=klass,klass.prototype.callSuper=callSuper,klass}var slice=Array.prototype.slice,emptyFunction=function(){},IS_DONTENUM_BUGGY=function(){for(var p in{toString:1})if("toString"===p)return!1;return!0}(),addMethods=function(klass,source,parent){for(var property in source)klass.prototype[property]=property in klass.prototype&&"function"==typeof klass.prototype[property]&&(source[property]+"").indexOf("callSuper")>-1?function(property){return function(){var superclass=this.constructor.superclass;this.constructor.superclass=parent;var returnValue=source[property].apply(this,arguments);return this.constructor.superclass=superclass,"initialize"!==property?returnValue:void 0}}(property):source[property],IS_DONTENUM_BUGGY&&(source.toString!==Object.prototype.toString&&(klass.prototype.toString=source.toString),source.valueOf!==Object.prototype.valueOf&&(klass.prototype.valueOf=source.valueOf))};fabric.util.createClass=createClass}(),function(){function areHostMethods(object){var t,i,methodNames=Array.prototype.slice.call(arguments,1),len=methodNames.length;for(i=0;len>i;i++)if(t=typeof object[methodNames[i]],!/^(?:function|object|unknown)$/.test(t))return!1;return!0}function createListener(uid,handler){return{handler:handler,wrappedHandler:createWrappedHandler(uid,handler)}}function createWrappedHandler(uid,handler){return function(e){handler.call(getElement(uid),e||fabric.window.event)}}function createDispatcher(uid,eventName){return function(e){if(handlers[uid]&&handlers[uid][eventName])for(var handlersForEvent=handlers[uid][eventName],i=0,len=handlersForEvent.length;len>i;i++)handlersForEvent[i].call(this,e||fabric.window.event)}}function getPointer(event,upperCanvasEl){event||(event=fabric.window.event);var element=event.target||(typeof event.srcElement!==unknown?event.srcElement:null),scroll=fabric.util.getScrollLeftTop(element,upperCanvasEl);return{x:pointerX(event)+scroll.left,y:pointerY(event)+scroll.top}}function _getPointer(event,pageProp,clientProp){var touchProp="touchend"===event.type?"changedTouches":"touches";return event[touchProp]&&event[touchProp][0]?event[touchProp][0][pageProp]-(event[touchProp][0][pageProp]-event[touchProp][0][clientProp])||event[clientProp]:event[clientProp]}var getElement,setElement,unknown="unknown",getUniqueId=function(){var uid=0;return function(element){return element.__uniqueID||(element.__uniqueID="uniqueID__"+uid++)}}();!function(){var elements={};getElement=function(uid){return elements[uid]},setElement=function(uid,element){elements[uid]=element}}();var addListener,removeListener,shouldUseAddListenerRemoveListener=areHostMethods(fabric.document.documentElement,"addEventListener","removeEventListener")&&areHostMethods(fabric.window,"addEventListener","removeEventListener"),shouldUseAttachEventDetachEvent=areHostMethods(fabric.document.documentElement,"attachEvent","detachEvent")&&areHostMethods(fabric.window,"attachEvent","detachEvent"),listeners={},handlers={};shouldUseAddListenerRemoveListener?(addListener=function(element,eventName,handler){element.addEventListener(eventName,handler,!1)},removeListener=function(element,eventName,handler){element.removeEventListener(eventName,handler,!1)}):shouldUseAttachEventDetachEvent?(addListener=function(element,eventName,handler){var uid=getUniqueId(element);setElement(uid,element),listeners[uid]||(listeners[uid]={}),listeners[uid][eventName]||(listeners[uid][eventName]=[]);var listener=createListener(uid,handler);listeners[uid][eventName].push(listener),element.attachEvent("on"+eventName,listener.wrappedHandler)},removeListener=function(element,eventName,handler){var listener,uid=getUniqueId(element);if(listeners[uid]&&listeners[uid][eventName])for(var i=0,len=listeners[uid][eventName].length;len>i;i++)listener=listeners[uid][eventName][i],listener&&listener.handler===handler&&(element.detachEvent("on"+eventName,listener.wrappedHandler),listeners[uid][eventName][i]=null)}):(addListener=function(element,eventName,handler){var uid=getUniqueId(element);if(handlers[uid]||(handlers[uid]={}),!handlers[uid][eventName]){handlers[uid][eventName]=[];var existingHandler=element["on"+eventName];existingHandler&&handlers[uid][eventName].push(existingHandler),element["on"+eventName]=createDispatcher(uid,eventName)}handlers[uid][eventName].push(handler)},removeListener=function(element,eventName,handler){var uid=getUniqueId(element);if(handlers[uid]&&handlers[uid][eventName])for(var handlersForEvent=handlers[uid][eventName],i=0,len=handlersForEvent.length;len>i;i++)handlersForEvent[i]===handler&&handlersForEvent.splice(i,1)}),fabric.util.addListener=addListener,fabric.util.removeListener=removeListener;var pointerX=function(event){return typeof event.clientX!==unknown?event.clientX:0},pointerY=function(event){return typeof event.clientY!==unknown?event.clientY:0};fabric.isTouchSupported&&(pointerX=function(event){return _getPointer(event,"pageX","clientX")},pointerY=function(event){return _getPointer(event,"pageY","clientY")}),fabric.util.getPointer=getPointer,fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function setStyle(element,styles){var elementStyle=element.style;if(!elementStyle)return element;if("string"==typeof styles)return element.style.cssText+=";"+styles,styles.indexOf("opacity")>-1?setOpacity(element,styles.match(/opacity:\s*(\d?\.?\d*)/)[1]):element;for(var property in styles)if("opacity"===property)setOpacity(element,styles[property]);else{var normalizedProperty="float"===property||"cssFloat"===property?"undefined"==typeof elementStyle.styleFloat?"cssFloat":"styleFloat":property;elementStyle[normalizedProperty]=styles[property]}return element}var parseEl=fabric.document.createElement("div"),supportsOpacity="string"==typeof parseEl.style.opacity,supportsFilters="string"==typeof parseEl.style.filter,reOpacity=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,setOpacity=function(element){return element};supportsOpacity?setOpacity=function(element,value){return element.style.opacity=value,element}:supportsFilters&&(setOpacity=function(element,value){var es=element.style;return element.currentStyle&&!element.currentStyle.hasLayout&&(es.zoom=1),reOpacity.test(es.filter)?(value=value>=.9999?"":"alpha(opacity="+100*value+")",es.filter=es.filter.replace(reOpacity,value)):es.filter+=" alpha(opacity="+100*value+")",element}),fabric.util.setStyle=setStyle}(),function(){function getById(id){return"string"==typeof id?fabric.document.getElementById(id):id}function makeElement(tagName,attributes){var el=fabric.document.createElement(tagName);for(var prop in attributes)"class"===prop?el.className=attributes[prop]:"for"===prop?el.htmlFor=attributes[prop]:el.setAttribute(prop,attributes[prop]);return el}function addClass(element,className){-1===(" "+element.className+" ").indexOf(" "+className+" ")&&(element.className+=(element.className?" ":"")+className)}function wrapElement(element,wrapper,attributes){return"string"==typeof wrapper&&(wrapper=makeElement(wrapper,attributes)),element.parentNode&&element.parentNode.replaceChild(wrapper,element),wrapper.appendChild(element),wrapper}function getScrollLeftTop(element,upperCanvasEl){var firstFixedAncestor,origElement,left=0,top=0,docElement=fabric.document.documentElement,body=fabric.document.body||{scrollLeft:0,scrollTop:0};for(origElement=element;element&&element.parentNode&&!firstFixedAncestor;)element=element.parentNode,element!==fabric.document&&"fixed"===fabric.util.getElementStyle(element,"position")&&(firstFixedAncestor=element),element!==fabric.document&&origElement!==upperCanvasEl&&"absolute"===fabric.util.getElementStyle(element,"position")?(left=0,top=0):element===fabric.document?(left=body.scrollLeft||docElement.scrollLeft||0,top=body.scrollTop||docElement.scrollTop||0):(left+=element.scrollLeft||0,top+=element.scrollTop||0);return{left:left,top:top}}function getElementOffset(element){var docElem,scrollLeftTop,box={left:0,top:0},doc=element&&element.ownerDocument,offset={left:0,top:0},offsetAttributes={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!doc)return{left:0,top:0};for(var attr in offsetAttributes)offset[offsetAttributes[attr]]+=parseInt(getElementStyle(element,attr),10)||0;return docElem=doc.documentElement,"undefined"!=typeof element.getBoundingClientRect&&(box=element.getBoundingClientRect()),scrollLeftTop=fabric.util.getScrollLeftTop(element,null),{left:box.left+scrollLeftTop.left-(docElem.clientLeft||0)+offset.left,top:box.top+scrollLeftTop.top-(docElem.clientTop||0)+offset.top}}function getElementStyle(element,attr){if(element.style||(element.style={}),fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle)return fabric.document.defaultView.getComputedStyle(element,null)[attr];var value=element.style[attr];return!value&&element.currentStyle&&(value=element.currentStyle[attr]),value}var sliceCanConvertNodelists,_slice=Array.prototype.slice,toArray=function(arrayLike){return _slice.call(arrayLike,0)};try{sliceCanConvertNodelists=toArray(fabric.document.childNodes)instanceof Array}catch(err){}sliceCanConvertNodelists||(toArray=function(arrayLike){for(var arr=new Array(arrayLike.length),i=arrayLike.length;i--;)arr[i]=arrayLike[i];return arr}),function(){function makeElementUnselectable(element){return"undefined"!=typeof element.onselectstart&&(element.onselectstart=fabric.util.falseFunction),selectProp?element.style[selectProp]="none":"string"==typeof element.unselectable&&(element.unselectable="on"),element}function makeElementSelectable(element){return"undefined"!=typeof element.onselectstart&&(element.onselectstart=null),selectProp?element.style[selectProp]="":"string"==typeof element.unselectable&&(element.unselectable=""),element}var style=fabric.document.documentElement.style,selectProp="userSelect"in style?"userSelect":"MozUserSelect"in style?"MozUserSelect":"WebkitUserSelect"in style?"WebkitUserSelect":"KhtmlUserSelect"in style?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=makeElementUnselectable,fabric.util.makeElementSelectable=makeElementSelectable}(),function(){function getScript(url,callback){var headEl=fabric.document.getElementsByTagName("head")[0],scriptEl=fabric.document.createElement("script"),loading=!0;scriptEl.onload=scriptEl.onreadystatechange=function(e){if(loading){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;loading=!1,callback(e||fabric.window.event),scriptEl=scriptEl.onload=scriptEl.onreadystatechange=null}},scriptEl.src=url,headEl.appendChild(scriptEl)}fabric.util.getScript=getScript}(),fabric.util.getById=getById,fabric.util.toArray=toArray,fabric.util.makeElement=makeElement,fabric.util.addClass=addClass,fabric.util.wrapElement=wrapElement,fabric.util.getScrollLeftTop=getScrollLeftTop,fabric.util.getElementOffset=getElementOffset,fabric.util.getElementStyle=getElementStyle}(),function(){function addParamToUrl(url,param){return url+(/\?/.test(url)?"&":"?")+param}function emptyFn(){}function request(url,options){options||(options={});var body,method=options.method?options.method.toUpperCase():"GET",onComplete=options.onComplete||function(){},xhr=makeXHR();return xhr.onreadystatechange=function(){4===xhr.readyState&&(onComplete(xhr),xhr.onreadystatechange=emptyFn)},"GET"===method&&(body=null,"string"==typeof options.parameters&&(url=addParamToUrl(url,options.parameters))),xhr.open(method,url,!0),("POST"===method||"PUT"===method)&&xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(body),xhr}var makeXHR=function(){for(var factories=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],i=factories.length;i--;)try{var req=factories[i]();if(req)return factories[i]}catch(err){}}();fabric.util.request=request}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(methodName){"undefined"!=typeof console[methodName]&&console[methodName].apply&&(fabric[methodName]=function(){return console[methodName].apply(console,arguments)})}),function(){function animate(options){requestAnimFrame(function(timestamp){options||(options={});var time,start=timestamp||+new Date,duration=options.duration||500,finish=start+duration,onChange=options.onChange||function(){},abort=options.abort||function(){return!1},easing=options.easing||function(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b},startValue="startValue"in options?options.startValue:0,endValue="endValue"in options?options.endValue:100,byValue=options.byValue||endValue-startValue;options.onStart&&options.onStart(),function tick(ticktime){time=ticktime||+new Date;var currentTime=time>finish?duration:time-start;return abort()?void(options.onComplete&&options.onComplete()):(onChange(easing(currentTime,startValue,byValue,duration)),time>finish?void(options.onComplete&&options.onComplete()):void requestAnimFrame(tick))}(start)})}var _requestAnimFrame=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(callback){fabric.window.setTimeout(callback,1e3/60)},requestAnimFrame=function(){return _requestAnimFrame.apply(fabric.window,arguments)};fabric.util.animate=animate,fabric.util.requestAnimFrame=requestAnimFrame}(),function(){function normalize(a,c,p,s){return a<Math.abs(c)?(a=c,s=p/4):s=p/(2*Math.PI)*Math.asin(c/a),{a:a,c:c,p:p,s:s}}function elastic(opts,t,d){return opts.a*Math.pow(2,10*(t-=1))*Math.sin(2*(t*d-opts.s)*Math.PI/opts.p)}function easeOutCubic(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b}function easeInOutCubic(t,b,c,d){return t/=d/2,1>t?c/2*t*t*t+b:c/2*((t-=2)*t*t+2)+b}function easeInQuart(t,b,c,d){return c*(t/=d)*t*t*t+b}function easeOutQuart(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b}function easeInOutQuart(t,b,c,d){return t/=d/2,1>t?c/2*t*t*t*t+b:-c/2*((t-=2)*t*t*t-2)+b}function easeInQuint(t,b,c,d){return c*(t/=d)*t*t*t*t+b}function easeOutQuint(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b}function easeInOutQuint(t,b,c,d){return t/=d/2,1>t?c/2*t*t*t*t*t+b:c/2*((t-=2)*t*t*t*t+2)+b}function easeInSine(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b}function easeOutSine(t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b}function easeInOutSine(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b}function easeInExpo(t,b,c,d){return 0===t?b:c*Math.pow(2,10*(t/d-1))+b}function easeOutExpo(t,b,c,d){return t===d?b+c:c*(-Math.pow(2,-10*t/d)+1)+b}function easeInOutExpo(t,b,c,d){return 0===t?b:t===d?b+c:(t/=d/2,1>t?c/2*Math.pow(2,10*(t-1))+b:c/2*(-Math.pow(2,-10*--t)+2)+b)}function easeInCirc(t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b}function easeOutCirc(t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b}function easeInOutCirc(t,b,c,d){return t/=d/2,1>t?-c/2*(Math.sqrt(1-t*t)-1)+b:c/2*(Math.sqrt(1-(t-=2)*t)+1)+b}function easeInElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(0===t)return b;if(t/=d,1===t)return b+c;p||(p=.3*d);var opts=normalize(a,c,p,s);return-elastic(opts,t,d)+b}function easeOutElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(0===t)return b;if(t/=d,1===t)return b+c;p||(p=.3*d);var opts=normalize(a,c,p,s);return opts.a*Math.pow(2,-10*t)*Math.sin(2*(t*d-opts.s)*Math.PI/opts.p)+opts.c+b}function easeInOutElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(0===t)return b;if(t/=d/2,2===t)return b+c;p||(p=.3*d*1.5);var opts=normalize(a,c,p,s);return 1>t?-.5*elastic(opts,t,d)+b:opts.a*Math.pow(2,-10*(t-=1))*Math.sin(2*(t*d-opts.s)*Math.PI/opts.p)*.5+opts.c+b}function easeInBack(t,b,c,d,s){return void 0===s&&(s=1.70158),c*(t/=d)*t*((s+1)*t-s)+b}function easeOutBack(t,b,c,d,s){return void 0===s&&(s=1.70158),c*((t=t/d-1)*t*((s+1)*t+s)+1)+b
}function easeInOutBack(t,b,c,d,s){return void 0===s&&(s=1.70158),t/=d/2,1>t?c/2*t*t*(((s*=1.525)+1)*t-s)+b:c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b}function easeInBounce(t,b,c,d){return c-easeOutBounce(d-t,0,c,d)+b}function easeOutBounce(t,b,c,d){return(t/=d)<1/2.75?7.5625*c*t*t+b:2/2.75>t?c*(7.5625*(t-=1.5/2.75)*t+.75)+b:2.5/2.75>t?c*(7.5625*(t-=2.25/2.75)*t+.9375)+b:c*(7.5625*(t-=2.625/2.75)*t+.984375)+b}function easeInOutBounce(t,b,c,d){return d/2>t?.5*easeInBounce(2*t,0,c,d)+b:.5*easeOutBounce(2*t-d,0,c,d)+.5*c+b}fabric.util.ease={easeInQuad:function(t,b,c,d){return c*(t/=d)*t+b},easeOutQuad:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},easeInOutQuad:function(t,b,c,d){return t/=d/2,1>t?c/2*t*t+b:-c/2*(--t*(t-2)-1)+b},easeInCubic:function(t,b,c,d){return c*(t/=d)*t*t+b},easeOutCubic:easeOutCubic,easeInOutCubic:easeInOutCubic,easeInQuart:easeInQuart,easeOutQuart:easeOutQuart,easeInOutQuart:easeInOutQuart,easeInQuint:easeInQuint,easeOutQuint:easeOutQuint,easeInOutQuint:easeInOutQuint,easeInSine:easeInSine,easeOutSine:easeOutSine,easeInOutSine:easeInOutSine,easeInExpo:easeInExpo,easeOutExpo:easeOutExpo,easeInOutExpo:easeInOutExpo,easeInCirc:easeInCirc,easeOutCirc:easeOutCirc,easeInOutCirc:easeInOutCirc,easeInElastic:easeInElastic,easeOutElastic:easeOutElastic,easeInOutElastic:easeInOutElastic,easeInBack:easeInBack,easeOutBack:easeOutBack,easeInOutBack:easeInOutBack,easeInBounce:easeInBounce,easeOutBounce:easeOutBounce,easeInOutBounce:easeInOutBounce}}(),function(global){"use strict";function normalizeAttr(attr){return attr in attributesMap?attributesMap[attr]:attr}function normalizeValue(attr,value,parentAttributes){var isArray;"fill"!==attr&&"stroke"!==attr||"none"!==value?"fillRule"===attr?value="evenodd"===value?"destination-over":value:"strokeDashArray"===attr?value=value.replace(/,/g," ").split(/\s+/):"transformMatrix"===attr&&(value=parentAttributes&&parentAttributes.transformMatrix?multiplyTransformMatrices(parentAttributes.transformMatrix,fabric.parseTransformAttribute(value)):fabric.parseTransformAttribute(value)):value="",isArray="[object Array]"===Object.prototype.toString.call(value);var parsed=isArray?value.map(parseFloat):parseFloat(value);return!isArray&&isNaN(parsed)?value:parsed}function _setStrokeFillOpacity(attributes){for(var attr in colorAttributes)if(attributes[attr]&&"undefined"!=typeof attributes[colorAttributes[attr]]&&0!==attributes[attr].indexOf("url(")){var color=new fabric.Color(attributes[attr]);attributes[attr]=color.setAlpha(toFixed(color.getAlpha()*attributes[colorAttributes[attr]],2)).toRgba(),delete attributes[colorAttributes[attr]]}return attributes}function parseFontDeclaration(value,oStyle){var match=value.match(/(normal|italic)?\s*(normal|small-caps)?\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\s*(\d+)px(?:\/(normal|[\d\.]+))?\s+(.*)/);if(match){var fontStyle=match[1],fontWeight=match[3],fontSize=match[4],lineHeight=match[5],fontFamily=match[6];fontStyle&&(oStyle.fontStyle=fontStyle),fontWeight&&(oStyle.fontSize=isNaN(parseFloat(fontWeight))?fontWeight:parseFloat(fontWeight)),fontSize&&(oStyle.fontSize=parseFloat(fontSize)),fontFamily&&(oStyle.fontFamily=fontFamily),lineHeight&&(oStyle.lineHeight="normal"===lineHeight?1:lineHeight)}}function parseStyleString(style,oStyle){var attr,value;style.replace(/;$/,"").split(";").forEach(function(chunk){var pair=chunk.split(":");attr=normalizeAttr(pair[0].trim().toLowerCase()),value=normalizeValue(attr,pair[1].trim()),"font"===attr?parseFontDeclaration(value,oStyle):oStyle[attr]=value})}function parseStyleObject(style,oStyle){var attr,value;for(var prop in style)"undefined"!=typeof style[prop]&&(attr=normalizeAttr(prop.toLowerCase()),value=normalizeValue(attr,style[prop]),"font"===attr?parseFontDeclaration(value,oStyle):oStyle[attr]=value)}function getGlobalStylesForElement(element){var nodeName=element.nodeName,className=element.getAttribute("class"),id=element.getAttribute("id"),styles={};for(var rule in fabric.cssRules){var ruleMatchesElement=className&&new RegExp("^\\."+className).test(rule)||id&&new RegExp("^#"+id).test(rule)||new RegExp("^"+nodeName).test(rule);if(ruleMatchesElement)for(var property in fabric.cssRules[rule])styles[property]=fabric.cssRules[rule][property]}return styles}function _enlivenCachedObject(cachedObject){var objects=cachedObject.objects,options=cachedObject.options;return objects=objects.map(function(o){return fabric[capitalize(o.type)].fromObject(o)}),{objects:objects,options:options}}function _createSVGPattern(markup,canvas,property){canvas[property]&&canvas[property].toSVG&&markup.push('<pattern x="0" y="0" id="',property,'Pattern" ','width="',canvas[property].source.width,'" height="',canvas[property].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',canvas[property].source.width,'" height="',canvas[property].source.height,'" xlink:href="',canvas[property].source.src,'"></image></pattern>')}var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,capitalize=fabric.util.string.capitalize,clone=fabric.util.object.clone,toFixed=fabric.util.toFixed,multiplyTransformMatrices=fabric.util.multiplyTransformMatrices,attributesMap={"fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight",cx:"left",x:"left",r:"radius","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration",cy:"top",y:"top",transform:"transformMatrix"},colorAttributes={stroke:"strokeOpacity",fill:"fillOpacity"};fabric.parseTransformAttribute=function(){function rotateMatrix(matrix,args){var angle=args[0];matrix[0]=Math.cos(angle),matrix[1]=Math.sin(angle),matrix[2]=-Math.sin(angle),matrix[3]=Math.cos(angle)}function scaleMatrix(matrix,args){var multiplierX=args[0],multiplierY=2===args.length?args[1]:args[0];matrix[0]=multiplierX,matrix[3]=multiplierY}function skewXMatrix(matrix,args){matrix[2]=args[0]}function skewYMatrix(matrix,args){matrix[1]=args[0]}function translateMatrix(matrix,args){matrix[4]=args[0],2===args.length&&(matrix[5]=args[1])}var iMatrix=[1,0,0,1,0,0],number="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",comma_wsp="(?:\\s+,?\\s*|,\\s*)",skewX="(?:(skewX)\\s*\\(\\s*("+number+")\\s*\\))",skewY="(?:(skewY)\\s*\\(\\s*("+number+")\\s*\\))",rotate="(?:(rotate)\\s*\\(\\s*("+number+")(?:"+comma_wsp+"("+number+")"+comma_wsp+"("+number+"))?\\s*\\))",scale="(?:(scale)\\s*\\(\\s*("+number+")(?:"+comma_wsp+"("+number+"))?\\s*\\))",translate="(?:(translate)\\s*\\(\\s*("+number+")(?:"+comma_wsp+"("+number+"))?\\s*\\))",matrix="(?:(matrix)\\s*\\(\\s*("+number+")"+comma_wsp+"("+number+")"+comma_wsp+"("+number+")"+comma_wsp+"("+number+")"+comma_wsp+"("+number+")"+comma_wsp+"("+number+")\\s*\\))",transform="(?:"+matrix+"|"+translate+"|"+scale+"|"+rotate+"|"+skewX+"|"+skewY+")",transforms="(?:"+transform+"(?:"+comma_wsp+transform+")*)",transform_list="^\\s*(?:"+transforms+"?)\\s*$",reTransformList=new RegExp(transform_list),reTransform=new RegExp(transform,"g");return function(attributeValue){var matrix=iMatrix.concat(),matrices=[];if(!attributeValue||attributeValue&&!reTransformList.test(attributeValue))return matrix;attributeValue.replace(reTransform,function(match){var m=new RegExp(transform).exec(match).filter(function(match){return""!==match&&null!=match}),operation=m[1],args=m.slice(2).map(parseFloat);switch(operation){case"translate":translateMatrix(matrix,args);break;case"rotate":rotateMatrix(matrix,args);break;case"scale":scaleMatrix(matrix,args);break;case"skewX":skewXMatrix(matrix,args);break;case"skewY":skewYMatrix(matrix,args);break;case"matrix":matrix=args}matrices.push(matrix.concat()),matrix=iMatrix.concat()});for(var combinedMatrix=matrices[0];matrices.length>1;)matrices.shift(),combinedMatrix=fabric.util.multiplyTransformMatrices(combinedMatrix,matrices[0]);return combinedMatrix}}(),fabric.parseSVGDocument=function(){function hasAncestorWithNodeName(element,nodeName){for(;element&&(element=element.parentNode);)if(nodeName.test(element.nodeName))return!0;return!1}var reAllowedSVGTagNames=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,reNum="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",reViewBoxAttrValue=new RegExp("^\\s*("+reNum+"+)\\s*,?\\s*("+reNum+"+)\\s*,?\\s*("+reNum+"+)\\s*,?\\s*("+reNum+"+)\\s*$");return function(doc,callback,reviver){if(doc){var startTime=new Date,descendants=fabric.util.toArray(doc.getElementsByTagName("*"));if(0===descendants.length){descendants=doc.selectNodes("//*[name(.)!='svg']");for(var arr=[],i=0,len=descendants.length;len>i;i++)arr[i]=descendants[i];descendants=arr}var elements=descendants.filter(function(el){return reAllowedSVGTagNames.test(el.tagName)&&!hasAncestorWithNodeName(el,/^(?:pattern|defs)$/)});if(elements&&(!elements||elements.length)){var minX,minY,viewBoxAttr=doc.getAttribute("viewBox"),widthAttr=doc.getAttribute("width"),heightAttr=doc.getAttribute("height"),width=null,height=null;viewBoxAttr&&(viewBoxAttr=viewBoxAttr.match(reViewBoxAttrValue))&&(minX=parseInt(viewBoxAttr[1],10),minY=parseInt(viewBoxAttr[2],10),width=parseInt(viewBoxAttr[3],10),height=parseInt(viewBoxAttr[4],10)),width=widthAttr?parseFloat(widthAttr):width,height=heightAttr?parseFloat(heightAttr):height;var options={width:width,height:height};fabric.gradientDefs=fabric.getGradientDefs(doc),fabric.cssRules=fabric.getCSSRules(doc),fabric.parseElements(elements,function(instances){fabric.documentParsingTime=new Date-startTime,callback&&callback(instances,options)},clone(options),reviver)}}}}();var svgCache={has:function(name,callback){callback(!1)},get:function(){},set:function(){}};extend(fabric,{resolveGradients:function(instances){for(var i=instances.length;i--;){var instanceFillValue=instances[i].get("fill");if(/^url\(/.test(instanceFillValue)){var gradientId=instanceFillValue.slice(5,instanceFillValue.length-1);fabric.gradientDefs[gradientId]&&instances[i].set("fill",fabric.Gradient.fromElement(fabric.gradientDefs[gradientId],instances[i]))}}},getGradientDefs:function(doc){var el,i,linearGradientEls=doc.getElementsByTagName("linearGradient"),radialGradientEls=doc.getElementsByTagName("radialGradient"),gradientDefs={};for(i=linearGradientEls.length;i--;)el=linearGradientEls[i],gradientDefs[el.getAttribute("id")]=el;for(i=radialGradientEls.length;i--;)el=radialGradientEls[i],gradientDefs[el.getAttribute("id")]=el;return gradientDefs},parseAttributes:function(element,attributes){if(element){var value,parentAttributes={};element.parentNode&&/^g$/i.test(element.parentNode.nodeName)&&(parentAttributes=fabric.parseAttributes(element.parentNode,attributes));var ownAttributes=attributes.reduce(function(memo,attr){return value=element.getAttribute(attr),value&&(attr=normalizeAttr(attr),value=normalizeValue(attr,value,parentAttributes),memo[attr]=value),memo},{});return ownAttributes=extend(ownAttributes,extend(getGlobalStylesForElement(element),fabric.parseStyleAttribute(element))),_setStrokeFillOpacity(extend(parentAttributes,ownAttributes))}},parseElements:function(elements,callback,options,reviver){fabric.ElementsParser.parse(elements,callback,options,reviver)},parseStyleAttribute:function(element){var oStyle={},style=element.getAttribute("style");return style?("string"==typeof style?parseStyleString(style,oStyle):parseStyleObject(style,oStyle),oStyle):oStyle},parsePointsAttribute:function(points){if(!points)return null;points=points.trim();var asPairs=points.indexOf(",")>-1;points=points.split(/\s+/);var i,len,parsedPoints=[];if(asPairs)for(i=0,len=points.length;len>i;i++){var pair=points[i].split(",");parsedPoints.push({x:parseFloat(pair[0]),y:parseFloat(pair[1])})}else for(i=0,len=points.length;len>i;i+=2)parsedPoints.push({x:parseFloat(points[i]),y:parseFloat(points[i+1])});return parsedPoints.length%2!==0,parsedPoints},getCSSRules:function(doc){for(var rules,styles=doc.getElementsByTagName("style"),allRules={},i=0,len=styles.length;len>i;i++){var styleContents=styles[0].textContent;styleContents=styleContents.replace(/\/\*[\s\S]*?\*\//g,""),rules=styleContents.match(/[^{]*\{[\s\S]*?\}/g),rules=rules.map(function(rule){return rule.trim()}),rules.forEach(function(rule){var match=rule.match(/([\s\S]*?)\s*\{([^}]*)\}/);rule=match[1];var declaration=match[2].trim(),propertyValuePairs=declaration.replace(/;$/,"").split(/\s*;\s*/);allRules[rule]||(allRules[rule]={});for(var i=0,len=propertyValuePairs.length;len>i;i++){var pair=propertyValuePairs[i].split(/\s*:\s*/),property=pair[0],value=pair[1];allRules[rule][property]=value}})}return allRules},loadSVGFromURL:function(url,callback,reviver){function onComplete(r){var xml=r.responseXML;!xml.documentElement&&fabric.window.ActiveXObject&&r.responseText&&(xml=new ActiveXObject("Microsoft.XMLDOM"),xml.async="false",xml.loadXML(r.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),xml.documentElement&&fabric.parseSVGDocument(xml.documentElement,function(results,options){svgCache.set(url,{objects:fabric.util.array.invoke(results,"toObject"),options:options}),callback(results,options)},reviver)}url=url.replace(/^\n\s*/,"").trim(),svgCache.has(url,function(hasUrl){hasUrl?svgCache.get(url,function(value){var enlivedRecord=_enlivenCachedObject(value);callback(enlivedRecord.objects,enlivedRecord.options)}):new fabric.util.request(url,{method:"get",onComplete:onComplete})})},loadSVGFromString:function(string,callback,reviver){string=string.trim();var doc;if("undefined"!=typeof DOMParser){var parser=new DOMParser;parser&&parser.parseFromString&&(doc=parser.parseFromString(string,"text/xml"))}else fabric.window.ActiveXObject&&(doc=new ActiveXObject("Microsoft.XMLDOM"),doc.async="false",doc.loadXML(string.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));fabric.parseSVGDocument(doc.documentElement,function(results,options){callback(results,options)},reviver)},createSVGFontFacesMarkup:function(objects){for(var markup="",i=0,len=objects.length;len>i;i++)"text"===objects[i].type&&objects[i].path&&(markup+=["@font-face {","font-family: ",objects[i].fontFamily,"; ","src: url('",objects[i].path,"')","}"].join(""));return markup&&(markup=['<style type="text/css">',"<![CDATA[",markup,"]]>","</style>"].join("")),markup},createSVGRefElementsMarkup:function(canvas){var markup=[];return _createSVGPattern(markup,canvas,"backgroundColor"),_createSVGPattern(markup,canvas,"overlayColor"),markup.join("")}})}("undefined"!=typeof exports?exports:this),fabric.ElementsParser={parse:function(elements,callback,options,reviver){this.elements=elements,this.callback=callback,this.options=options,this.reviver=reviver,this.instances=new Array(elements.length),this.numElements=elements.length,this.createObjects()},createObjects:function(){for(var i=0,len=this.elements.length;len>i;i++)this.createObject(this.elements[i],i)},createObject:function(el,index){var klass=fabric[fabric.util.string.capitalize(el.tagName)];if(klass&&klass.fromElement)try{this._createObject(klass,el,index)}catch(err){fabric.log(err)}else this.checkIfDone()},_createObject:function(klass,el,index){if(klass.async)klass.fromElement(el,this.createCallback(index,el),this.options);else{var obj=klass.fromElement(el,this.options);this.reviver&&this.reviver(el,obj),this.instances.splice(index,0,obj),this.checkIfDone()}},createCallback:function(index,el){var _this=this;return function(obj){_this.reviver&&_this.reviver(el,obj),_this.instances.splice(index,0,obj),_this.checkIfDone()}},checkIfDone:function(){0===--this.numElements&&(this.instances=this.instances.filter(function(el){return null!=el}),fabric.resolveGradients(this.instances),this.callback(this.instances))}},function(global){"use strict";function Point(x,y){this.x=x,this.y=y}var fabric=global.fabric||(global.fabric={});return fabric.Point?void fabric.warn("fabric.Point is already defined"):(fabric.Point=Point,void(Point.prototype={constructor:Point,add:function(that){return new Point(this.x+that.x,this.y+that.y)},addEquals:function(that){return this.x+=that.x,this.y+=that.y,this},scalarAdd:function(scalar){return new Point(this.x+scalar,this.y+scalar)},scalarAddEquals:function(scalar){return this.x+=scalar,this.y+=scalar,this},subtract:function(that){return new Point(this.x-that.x,this.y-that.y)},subtractEquals:function(that){return this.x-=that.x,this.y-=that.y,this},scalarSubtract:function(scalar){return new Point(this.x-scalar,this.y-scalar)},scalarSubtractEquals:function(scalar){return this.x-=scalar,this.y-=scalar,this},multiply:function(scalar){return new Point(this.x*scalar,this.y*scalar)},multiplyEquals:function(scalar){return this.x*=scalar,this.y*=scalar,this},divide:function(scalar){return new Point(this.x/scalar,this.y/scalar)},divideEquals:function(scalar){return this.x/=scalar,this.y/=scalar,this},eq:function(that){return this.x===that.x&&this.y===that.y},lt:function(that){return this.x<that.x&&this.y<that.y},lte:function(that){return this.x<=that.x&&this.y<=that.y},gt:function(that){return this.x>that.x&&this.y>that.y},gte:function(that){return this.x>=that.x&&this.y>=that.y},lerp:function(that,t){return new Point(this.x+(that.x-this.x)*t,this.y+(that.y-this.y)*t)},distanceFrom:function(that){var dx=this.x-that.x,dy=this.y-that.y;return Math.sqrt(dx*dx+dy*dy)},midPointFrom:function(that){return new Point(this.x+(that.x-this.x)/2,this.y+(that.y-this.y)/2)},min:function(that){return new Point(Math.min(this.x,that.x),Math.min(this.y,that.y))},max:function(that){return new Point(Math.max(this.x,that.x),Math.max(this.y,that.y))},toString:function(){return this.x+","+this.y},setXY:function(x,y){this.x=x,this.y=y},setFromPoint:function(that){this.x=that.x,this.y=that.y},swap:function(that){var x=this.x,y=this.y;this.x=that.x,this.y=that.y,that.x=x,that.y=y}}))}("undefined"!=typeof exports?exports:this),function(global){"use strict";function Intersection(status){this.status=status,this.points=[]}var fabric=global.fabric||(global.fabric={});return fabric.Intersection?void fabric.warn("fabric.Intersection is already defined"):(fabric.Intersection=Intersection,fabric.Intersection.prototype={appendPoint:function(point){this.points.push(point)},appendPoints:function(points){this.points=this.points.concat(points)}},fabric.Intersection.intersectLineLine=function(a1,a2,b1,b2){var result,ua_t=(b2.x-b1.x)*(a1.y-b1.y)-(b2.y-b1.y)*(a1.x-b1.x),ub_t=(a2.x-a1.x)*(a1.y-b1.y)-(a2.y-a1.y)*(a1.x-b1.x),u_b=(b2.y-b1.y)*(a2.x-a1.x)-(b2.x-b1.x)*(a2.y-a1.y);if(0!==u_b){var ua=ua_t/u_b,ub=ub_t/u_b;ua>=0&&1>=ua&&ub>=0&&1>=ub?(result=new Intersection("Intersection"),result.points.push(new fabric.Point(a1.x+ua*(a2.x-a1.x),a1.y+ua*(a2.y-a1.y)))):result=new Intersection}else result=new Intersection(0===ua_t||0===ub_t?"Coincident":"Parallel");return result},fabric.Intersection.intersectLinePolygon=function(a1,a2,points){for(var result=new Intersection,length=points.length,i=0;length>i;i++){var b1=points[i],b2=points[(i+1)%length],inter=Intersection.intersectLineLine(a1,a2,b1,b2);result.appendPoints(inter.points)}return result.points.length>0&&(result.status="Intersection"),result},fabric.Intersection.intersectPolygonPolygon=function(points1,points2){for(var result=new Intersection,length=points1.length,i=0;length>i;i++){var a1=points1[i],a2=points1[(i+1)%length],inter=Intersection.intersectLinePolygon(a1,a2,points2);result.appendPoints(inter.points)}return result.points.length>0&&(result.status="Intersection"),result},void(fabric.Intersection.intersectPolygonRectangle=function(points,r1,r2){var min=r1.min(r2),max=r1.max(r2),topRight=new fabric.Point(max.x,min.y),bottomLeft=new fabric.Point(min.x,max.y),inter1=Intersection.intersectLinePolygon(min,topRight,points),inter2=Intersection.intersectLinePolygon(topRight,max,points),inter3=Intersection.intersectLinePolygon(max,bottomLeft,points),inter4=Intersection.intersectLinePolygon(bottomLeft,min,points),result=new Intersection;return result.appendPoints(inter1.points),result.appendPoints(inter2.points),result.appendPoints(inter3.points),result.appendPoints(inter4.points),result.points.length>0&&(result.status="Intersection"),result}))}("undefined"!=typeof exports?exports:this),function(global){"use strict";function Color(color){color?this._tryParsingColor(color):this.setSource([0,0,0,1])}function hue2rgb(p,q,t){return 0>t&&(t+=1),t>1&&(t-=1),1/6>t?p+6*(q-p)*t:.5>t?q:2/3>t?p+(q-p)*(2/3-t)*6:p}var fabric=global.fabric||(global.fabric={});return fabric.Color?void fabric.warn("fabric.Color is already defined."):(fabric.Color=Color,fabric.Color.prototype={_tryParsingColor:function(color){var source;color in Color.colorNameMap&&(color=Color.colorNameMap[color]),source=Color.sourceFromHex(color),source||(source=Color.sourceFromRgb(color)),source||(source=Color.sourceFromHsl(color)),source&&this.setSource(source)},_rgbToHsl:function(r,g,b){r/=255,g/=255,b/=255;var h,s,l,max=fabric.util.array.max([r,g,b]),min=fabric.util.array.min([r,g,b]);if(l=(max+min)/2,max===min)h=s=0;else{var d=max-min;switch(s=l>.5?d/(2-max-min):d/(max+min),max){case r:h=(g-b)/d+(b>g?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return[Math.round(360*h),Math.round(100*s),Math.round(100*l)]},getSource:function(){return this._source},setSource:function(source){this._source=source},toRgb:function(){var source=this.getSource();return"rgb("+source[0]+","+source[1]+","+source[2]+")"},toRgba:function(){var source=this.getSource();return"rgba("+source[0]+","+source[1]+","+source[2]+","+source[3]+")"},toHsl:function(){var source=this.getSource(),hsl=this._rgbToHsl(source[0],source[1],source[2]);return"hsl("+hsl[0]+","+hsl[1]+"%,"+hsl[2]+"%)"},toHsla:function(){var source=this.getSource(),hsl=this._rgbToHsl(source[0],source[1],source[2]);return"hsla("+hsl[0]+","+hsl[1]+"%,"+hsl[2]+"%,"+source[3]+")"},toHex:function(){var source=this.getSource(),r=source[0].toString(16);r=1===r.length?"0"+r:r;var g=source[1].toString(16);g=1===g.length?"0"+g:g;var b=source[2].toString(16);return b=1===b.length?"0"+b:b,r.toUpperCase()+g.toUpperCase()+b.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(alpha){var source=this.getSource();return source[3]=alpha,this.setSource(source),this},toGrayscale:function(){var source=this.getSource(),average=parseInt((.3*source[0]+.59*source[1]+.11*source[2]).toFixed(0),10),currentAlpha=source[3];return this.setSource([average,average,average,currentAlpha]),this},toBlackWhite:function(threshold){var source=this.getSource(),average=(.3*source[0]+.59*source[1]+.11*source[2]).toFixed(0),currentAlpha=source[3];return threshold=threshold||127,average=Number(average)<Number(threshold)?0:255,this.setSource([average,average,average,currentAlpha]),this},overlayWith:function(otherColor){otherColor instanceof Color||(otherColor=new Color(otherColor));for(var result=[],alpha=this.getAlpha(),otherAlpha=.5,source=this.getSource(),otherSource=otherColor.getSource(),i=0;3>i;i++)result.push(Math.round(source[i]*(1-otherAlpha)+otherSource[i]*otherAlpha));return result[3]=alpha,this.setSource(result),this}},fabric.Color.reRGBa=/^rgba?\(\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,fabric.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,fabric.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,fabric.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},fabric.Color.fromRgb=function(color){return Color.fromSource(Color.sourceFromRgb(color))},fabric.Color.sourceFromRgb=function(color){var match=color.match(Color.reRGBa);if(match){var r=parseInt(match[1],10)/(/%$/.test(match[1])?100:1)*(/%$/.test(match[1])?255:1),g=parseInt(match[2],10)/(/%$/.test(match[2])?100:1)*(/%$/.test(match[2])?255:1),b=parseInt(match[3],10)/(/%$/.test(match[3])?100:1)*(/%$/.test(match[3])?255:1);return[parseInt(r,10),parseInt(g,10),parseInt(b,10),match[4]?parseFloat(match[4]):1]}},fabric.Color.fromRgba=Color.fromRgb,fabric.Color.fromHsl=function(color){return Color.fromSource(Color.sourceFromHsl(color))},fabric.Color.sourceFromHsl=function(color){var match=color.match(Color.reHSLa);if(match){var r,g,b,h=(parseFloat(match[1])%360+360)%360/360,s=parseFloat(match[2])/(/%$/.test(match[2])?100:1),l=parseFloat(match[3])/(/%$/.test(match[3])?100:1);if(0===s)r=g=b=l;else{var q=.5>=l?l*(s+1):l+s-l*s,p=2*l-q;r=hue2rgb(p,q,h+1/3),g=hue2rgb(p,q,h),b=hue2rgb(p,q,h-1/3)}return[Math.round(255*r),Math.round(255*g),Math.round(255*b),match[4]?parseFloat(match[4]):1]}},fabric.Color.fromHsla=Color.fromHsl,fabric.Color.fromHex=function(color){return Color.fromSource(Color.sourceFromHex(color))},fabric.Color.sourceFromHex=function(color){if(color.match(Color.reHex)){var value=color.slice(color.indexOf("#")+1),isShortNotation=3===value.length,r=isShortNotation?value.charAt(0)+value.charAt(0):value.substring(0,2),g=isShortNotation?value.charAt(1)+value.charAt(1):value.substring(2,4),b=isShortNotation?value.charAt(2)+value.charAt(2):value.substring(4,6);return[parseInt(r,16),parseInt(g,16),parseInt(b,16),1]}},void(fabric.Color.fromSource=function(source){var oColor=new Color;return oColor.setSource(source),oColor}))}("undefined"!=typeof exports?exports:this),function(){function getColorStop(el){var color,opacity,style=el.getAttribute("style"),offset=el.getAttribute("offset");if(offset=parseFloat(offset)/(/%$/.test(offset)?100:1),style){var keyValuePairs=style.split(/\s*;\s*/);""===keyValuePairs[keyValuePairs.length-1]&&keyValuePairs.pop();for(var i=keyValuePairs.length;i--;){var split=keyValuePairs[i].split(/\s*:\s*/),key=split[0].trim(),value=split[1].trim();"stop-color"===key?color=value:"stop-opacity"===key&&(opacity=value)}}return color||(color=el.getAttribute("stop-color")||"rgb(0,0,0)"),opacity||(opacity=el.getAttribute("stop-opacity")),color=new fabric.Color(color).toRgb(),{offset:offset,color:color,opacity:isNaN(parseFloat(opacity))?1:parseFloat(opacity)}}function getLinearCoords(el){return{x1:el.getAttribute("x1")||0,y1:el.getAttribute("y1")||0,x2:el.getAttribute("x2")||"100%",y2:el.getAttribute("y2")||0}}function getRadialCoords(el){return{x1:el.getAttribute("fx")||el.getAttribute("cx")||"50%",y1:el.getAttribute("fy")||el.getAttribute("cy")||"50%",r1:0,x2:el.getAttribute("cx")||"50%",y2:el.getAttribute("cy")||"50%",r2:el.getAttribute("r")||"50%"}}function _convertPercentUnitsToValues(object,options){for(var prop in options){if("string"==typeof options[prop]&&/^\d+%$/.test(options[prop])){var percents=parseFloat(options[prop],10);"x1"===prop||"x2"===prop||"r2"===prop?options[prop]=fabric.util.toFixed(object.width*percents/100,2):("y1"===prop||"y2"===prop)&&(options[prop]=fabric.util.toFixed(object.height*percents/100,2))}normalize(options,prop,object)}}function normalize(options,prop,object){"x1"===prop||"x2"===prop?options[prop]-=fabric.util.toFixed(object.width/2,2):("y1"===prop||"y2"===prop)&&(options[prop]-=fabric.util.toFixed(object.height/2,2))}function _convertValuesToPercentUnits(object,options){for(var prop in options)normalize(options,prop,object),"x1"===prop||"x2"===prop||"r2"===prop?options[prop]=fabric.util.toFixed(options[prop]/object.width*100,2)+"%":("y1"===prop||"y2"===prop)&&(options[prop]=fabric.util.toFixed(options[prop]/object.height*100,2)+"%")}fabric.Gradient=fabric.util.createClass({initialize:function(options){options||(options={});var coords={};this.id=fabric.Object.__uid++,this.type=options.type||"linear",coords={x1:options.coords.x1||0,y1:options.coords.y1||0,x2:options.coords.x2||0,y2:options.coords.y2||0},"radial"===this.type&&(coords.r1=options.coords.r1||0,coords.r2=options.coords.r2||0),this.coords=coords,this.gradientUnits=options.gradientUnits||"objectBoundingBox",this.colorStops=options.colorStops.slice()},addColorStop:function(colorStop){for(var position in colorStop){var color=new fabric.Color(colorStop[position]);this.colorStops.push({offset:position,color:color.toRgb(),opacity:color.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toSVG:function(object,normalize){var markup,coords=fabric.util.object.clone(this.coords);this.colorStops.sort(function(a,b){return a.offset-b.offset}),normalize&&"userSpaceOnUse"===this.gradientUnits?(coords.x1+=object.width/2,coords.y1+=object.height/2,coords.x2+=object.width/2,coords.y2+=object.height/2):"objectBoundingBox"===this.gradientUnits&&_convertValuesToPercentUnits(object,coords),"linear"===this.type?markup=["<linearGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" x1="',coords.x1,'" y1="',coords.y1,'" x2="',coords.x2,'" y2="',coords.y2,'">']:"radial"===this.type&&(markup=["<radialGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" cx="',coords.x2,'" cy="',coords.y2,'" r="',coords.r2,'" fx="',coords.x1,'" fy="',coords.y1,'">']);for(var i=0;i<this.colorStops.length;i++)markup.push("<stop ",'offset="',100*this.colorStops[i].offset+"%",'" style="stop-color:',this.colorStops[i].color,this.colorStops[i].opacity?";stop-opacity: "+this.colorStops[i].opacity:";",'"/>');return markup.push("linear"===this.type?"</linearGradient>":"</radialGradient>"),markup.join("")},toLive:function(ctx){var gradient;if(this.type){"linear"===this.type?gradient=ctx.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2,this.coords.y2):"radial"===this.type&&(gradient=ctx.createRadialGradient(this.coords.x1,this.coords.y1,this.coords.r1,this.coords.x2,this.coords.y2,this.coords.r2));for(var i=0,len=this.colorStops.length;len>i;i++){var color=this.colorStops[i].color,opacity=this.colorStops[i].opacity,offset=this.colorStops[i].offset;"undefined"!=typeof opacity&&(color=new fabric.Color(color).setAlpha(opacity).toRgba()),gradient.addColorStop(parseFloat(offset),color)}return gradient}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(el,instance){var colorStopEls=el.getElementsByTagName("stop"),type="linearGradient"===el.nodeName?"linear":"radial",gradientUnits=el.getAttribute("gradientUnits")||"objectBoundingBox",colorStops=[],coords={};"linear"===type?coords=getLinearCoords(el):"radial"===type&&(coords=getRadialCoords(el));for(var i=colorStopEls.length;i--;)colorStops.push(getColorStop(colorStopEls[i]));return _convertPercentUnitsToValues(instance,coords),new fabric.Gradient({type:type,coords:coords,gradientUnits:gradientUnits,colorStops:colorStops})},forObject:function(obj,options){return options||(options={}),_convertPercentUnitsToValues(obj,options),new fabric.Gradient(options)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(options){if(options||(options={}),this.id=fabric.Object.__uid++,options.source)if("string"==typeof options.source)if("undefined"!=typeof fabric.util.getFunctionBody(options.source))this.source=new Function(fabric.util.getFunctionBody(options.source));else{var _this=this;this.source=fabric.util.createImage(),fabric.util.loadImage(options.source,function(img){_this.source=img})}else this.source=options.source;options.repeat&&(this.repeat=options.repeat),options.offsetX&&(this.offsetX=options.offsetX),options.offsetY&&(this.offsetY=options.offsetY)},toObject:function(){var source;return"function"==typeof this.source?source=String(this.source):"string"==typeof this.source.src&&(source=this.source.src),{source:source,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(object){var patternSource="function"==typeof this.source?this.source():this.source,patternWidth=patternSource.width/object.getWidth(),patternHeight=patternSource.height/object.getHeight(),patternImgSrc="";return patternSource.src?patternImgSrc=patternSource.src:patternSource.toDataURL&&(patternImgSrc=patternSource.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+this.offsetX+'" y="'+this.offsetY+'" width="'+patternWidth+'" height="'+patternHeight+'"><image x="0" y="0" width="'+patternSource.width+'" height="'+patternSource.height+'" xlink:href="'+patternImgSrc+'"></image></pattern>'
},toLive:function(ctx){var source="function"==typeof this.source?this.source():this.source;if("undefined"!=typeof source.src){if(!source.complete)return"";if(0===source.naturalWidth||0===source.naturalHeight)return""}return ctx.createPattern(source,this.repeat)}}),function(global){"use strict";var fabric=global.fabric||(global.fabric={});return fabric.Shadow?void fabric.warn("fabric.Shadow is already defined."):(fabric.Shadow=fabric.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(options){"string"==typeof options&&(options=this._parseShadow(options));for(var prop in options)this[prop]=options[prop];this.id=fabric.Object.__uid++},_parseShadow:function(shadow){var shadowStr=shadow.trim(),offsetsAndBlur=fabric.Shadow.reOffsetsAndBlur.exec(shadowStr)||[],color=shadowStr.replace(fabric.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:color.trim(),offsetX:parseInt(offsetsAndBlur[1],10)||0,offsetY:parseInt(offsetsAndBlur[2],10)||0,blur:parseInt(offsetsAndBlur[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(object){var mode="SourceAlpha";return!object||object.fill!==this.color&&object.stroke!==this.color||(mode="SourceGraphic"),'<filter id="SVGID_'+this.id+'" y="-40%" height="180%"><feGaussianBlur in="'+mode+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"></feGaussianBlur><feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset><feMerge><feMergeNode></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter>'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var obj={},proto=fabric.Shadow.prototype;return this.color!==proto.color&&(obj.color=this.color),this.blur!==proto.blur&&(obj.blur=this.blur),this.offsetX!==proto.offsetX&&(obj.offsetX=this.offsetX),this.offsetY!==proto.offsetY&&(obj.offsetY=this.offsetY),obj}}),void(fabric.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/))}("undefined"!=typeof exports?exports:this),function(){"use strict";if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var extend=fabric.util.object.extend,getElementOffset=fabric.util.getElementOffset,removeFromArray=fabric.util.removeFromArray,CANVAS_INIT_ERROR=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(el,options){options||(options={}),this._initStatic(el,options),fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,onBeforeScaleRotate:function(){},_initStatic:function(el,options){this._objects=[],this._createLowerCanvas(el),this._initOptions(options),options.overlayImage&&this.setOverlayImage(options.overlayImage,this.renderAll.bind(this)),options.backgroundImage&&this.setBackgroundImage(options.backgroundImage,this.renderAll.bind(this)),options.backgroundColor&&this.setBackgroundColor(options.backgroundColor,this.renderAll.bind(this)),options.overlayColor&&this.setOverlayColor(options.overlayColor,this.renderAll.bind(this)),this.calcOffset()},calcOffset:function(){return this._offset=getElementOffset(this.lowerCanvasEl),this},setOverlayImage:function(image,callback,options){return this.__setBgOverlayImage("overlayImage",image,callback,options)},setBackgroundImage:function(image,callback,options){return this.__setBgOverlayImage("backgroundImage",image,callback,options)},setOverlayColor:function(overlayColor,callback){return this.__setBgOverlayColor("overlayColor",overlayColor,callback)},setBackgroundColor:function(backgroundColor,callback){return this.__setBgOverlayColor("backgroundColor",backgroundColor,callback)},__setBgOverlayImage:function(property,image,callback,options){return"string"==typeof image?fabric.util.loadImage(image,function(img){this[property]=new fabric.Image(img,options),callback&&callback()},this):(this[property]=image,callback&&callback()),this},__setBgOverlayColor:function(property,color,callback){if(color.source){var _this=this;fabric.util.loadImage(color.source,function(img){_this[property]=new fabric.Pattern({source:img,repeat:color.repeat,offsetX:color.offsetX,offsetY:color.offsetY}),callback&&callback()})}else this[property]=color,callback&&callback();return this},_createCanvasElement:function(){var element=fabric.document.createElement("canvas");if(element.style||(element.style={}),!element)throw CANVAS_INIT_ERROR;return this._initCanvasElement(element),element},_initCanvasElement:function(element){if(fabric.util.createCanvasElement(element),"undefined"==typeof element.getContext)throw CANVAS_INIT_ERROR},_initOptions:function(options){for(var prop in options)this[prop]=options[prop];this.width=parseInt(this.lowerCanvasEl.width,10)||0,this.height=parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px")},_createLowerCanvas:function(canvasEl){this.lowerCanvasEl=fabric.util.getById(canvasEl)||this._createCanvasElement(),this._initCanvasElement(this.lowerCanvasEl),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(value){return this._setDimension("width",value)},setHeight:function(value){return this._setDimension("height",value)},setDimensions:function(dimensions){for(var prop in dimensions)this._setDimension(prop,dimensions[prop]);return this},_setDimension:function(prop,value){return this.lowerCanvasEl[prop]=value,this.lowerCanvasEl.style[prop]=value+"px",this.upperCanvasEl&&(this.upperCanvasEl[prop]=value,this.upperCanvasEl.style[prop]=value+"px"),this.cacheCanvasEl&&(this.cacheCanvasEl[prop]=value),this.wrapperEl&&(this.wrapperEl.style[prop]=value+"px"),this[prop]=value,this.calcOffset(),this.renderAll(),this},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(ctx,object){if(object)if(this.controlsAboveOverlay){var hasBorders=object.hasBorders,hasControls=object.hasControls;object.hasBorders=object.hasControls=!1,object.render(ctx),object.hasBorders=hasBorders,object.hasControls=hasControls}else object.render(ctx)},_onObjectAdded:function(obj){this.stateful&&obj.setupState(),obj.setCoords(),obj.canvas=this,this.fire("object:added",{target:obj}),obj.fire("added")},_onObjectRemoved:function(obj){this.getActiveObject()===obj&&(this.fire("before:selection:cleared",{target:obj}),this._discardActiveObject(),this.fire("selection:cleared")),this.fire("object:removed",{target:obj}),obj.fire("removed")},clearContext:function(ctx){return ctx.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(allOnTop){var canvasToDrawOn=this[allOnTop===!0&&this.interactive?"contextTop":"contextContainer"],activeGroup=this.getActiveGroup();return this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),allOnTop||this.clearContext(canvasToDrawOn),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,canvasToDrawOn),this._renderBackground(canvasToDrawOn),this._renderObjects(canvasToDrawOn,activeGroup),this._renderActiveGroup(canvasToDrawOn,activeGroup),this.clipTo&&canvasToDrawOn.restore(),this._renderOverlay(canvasToDrawOn),this.controlsAboveOverlay&&this.interactive&&this.drawControls(canvasToDrawOn),this.fire("after:render"),this},_renderObjects:function(ctx,activeGroup){for(var i=0,length=this._objects.length;length>i;++i)(!activeGroup||activeGroup&&this._objects[i]&&!activeGroup.contains(this._objects[i]))&&this._draw(ctx,this._objects[i])},_renderActiveGroup:function(ctx,activeGroup){if(activeGroup){var sortedObjects=[];this.forEachObject(function(object){activeGroup.contains(object)&&sortedObjects.push(object)}),activeGroup._set("objects",sortedObjects),this._draw(ctx,activeGroup)}},_renderBackground:function(ctx){this.backgroundColor&&(ctx.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(ctx):this.backgroundColor,ctx.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height)),this.backgroundImage&&this.backgroundImage.render(ctx)},_renderOverlay:function(ctx){this.overlayColor&&(ctx.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(ctx):this.overlayColor,ctx.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height)),this.overlayImage&&this.overlayImage.render(ctx)},renderTop:function(){var ctx=this.contextTop||this.contextContainer;this.clearContext(ctx),this.selection&&this._groupSelector&&this._drawSelection();var activeGroup=this.getActiveGroup();return activeGroup&&activeGroup.render(ctx),this.overlayImage&&ctx.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(object){return this._centerObject(object,new fabric.Point(this.getCenter().left,object.getCenterPoint().y)),this.renderAll(),this},centerObjectV:function(object){return this._centerObject(object,new fabric.Point(object.getCenterPoint().x,this.getCenter().top)),this.renderAll(),this},centerObject:function(object){var center=this.getCenter();return this._centerObject(object,new fabric.Point(center.left,center.top)),this.renderAll(),this},_centerObject:function(object,center){return object.setPositionByOrigin(center,"center","center"),this},toDatalessJSON:function(propertiesToInclude){return this.toDatalessObject(propertiesToInclude)},toObject:function(propertiesToInclude){return this._toObjectMethod("toObject",propertiesToInclude)},toDatalessObject:function(propertiesToInclude){return this._toObjectMethod("toDatalessObject",propertiesToInclude)},_toObjectMethod:function(methodName,propertiesToInclude){var activeGroup=this.getActiveGroup();activeGroup&&this.discardActiveGroup();var data={objects:this._toObjects(methodName,propertiesToInclude)};return extend(data,this.__serializeBgOverlay()),fabric.util.populateWithProperties(this,data,propertiesToInclude),activeGroup&&(this.setActiveGroup(new fabric.Group(activeGroup.getObjects())),activeGroup.forEachObject(function(o){o.set("active",!0)})),data},_toObjects:function(methodName,propertiesToInclude){return this.getObjects().map(function(instance){return this._toObject(instance,methodName,propertiesToInclude)},this)},_toObject:function(instance,methodName,propertiesToInclude){var originalValue;this.includeDefaultValues||(originalValue=instance.includeDefaultValues,instance.includeDefaultValues=!1);var object=instance[methodName](propertiesToInclude);return this.includeDefaultValues||(instance.includeDefaultValues=originalValue),object},__serializeBgOverlay:function(){var data={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.overlayColor&&(data.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor),this.backgroundImage&&(data.backgroundImage=this.backgroundImage.toObject()),this.overlayImage&&(data.overlayImage=this.overlayImage.toObject()),data},toSVG:function(options,reviver){options||(options={});var markup=[];return this._setSVGPreamble(markup,options),this._setSVGHeader(markup,options),this._setSVGBgOverlayColor(markup,"backgroundColor"),this._setSVGBgOverlayImage(markup,"backgroundImage"),this._setSVGObjects(markup,reviver),this._setSVGBgOverlayColor(markup,"overlayColor"),this._setSVGBgOverlayImage(markup,"overlayImage"),markup.push("</svg>"),markup.join("")},_setSVGPreamble:function(markup,options){options.suppressPreamble||markup.push('<?xml version="1.0" encoding="',options.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(markup,options){markup.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',options.viewBox?options.viewBox.width:this.width,'" ','height="',options.viewBox?options.viewBox.height:this.height,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,options.viewBox?'viewBox="'+options.viewBox.x+" "+options.viewBox.y+" "+options.viewBox.width+" "+options.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(markup,reviver){var activeGroup=this.getActiveGroup();activeGroup&&this.discardActiveGroup();for(var i=0,objects=this.getObjects(),len=objects.length;len>i;i++)markup.push(objects[i].toSVG(reviver));activeGroup&&(this.setActiveGroup(new fabric.Group(activeGroup.getObjects())),activeGroup.forEachObject(function(o){o.set("active",!0)}))},_setSVGBgOverlayImage:function(markup,property){this[property]&&this[property].toSVG&&markup.push(this[property].toSVG())},_setSVGBgOverlayColor:function(markup,property){this[property]&&this[property].source?markup.push('<rect x="',this[property].offsetX,'" y="',this[property].offsetY,'" ','width="',"repeat-y"===this[property].repeat||"no-repeat"===this[property].repeat?this[property].source.width:this.width,'" height="',"repeat-x"===this[property].repeat||"no-repeat"===this[property].repeat?this[property].source.height:this.height,'" fill="url(#'+property+'Pattern)"',"></rect>"):this[property]&&"overlayColor"===property&&markup.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[property],'"',"></rect>")},sendToBack:function(object){return removeFromArray(this._objects,object),this._objects.unshift(object),this.renderAll&&this.renderAll()},bringToFront:function(object){return removeFromArray(this._objects,object),this._objects.push(object),this.renderAll&&this.renderAll()},sendBackwards:function(object,intersecting){var idx=this._objects.indexOf(object);if(0!==idx){var newIdx=this._findNewLowerIndex(object,idx,intersecting);removeFromArray(this._objects,object),this._objects.splice(newIdx,0,object),this.renderAll&&this.renderAll()}return this},_findNewLowerIndex:function(object,idx,intersecting){var newIdx;if(intersecting){newIdx=idx;for(var i=idx-1;i>=0;--i){var isIntersecting=object.intersectsWithObject(this._objects[i])||object.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(object);if(isIntersecting){newIdx=i;break}}}else newIdx=idx-1;return newIdx},bringForward:function(object,intersecting){var idx=this._objects.indexOf(object);if(idx!==this._objects.length-1){var newIdx=this._findNewUpperIndex(object,idx,intersecting);removeFromArray(this._objects,object),this._objects.splice(newIdx,0,object),this.renderAll&&this.renderAll()}return this},_findNewUpperIndex:function(object,idx,intersecting){var newIdx;if(intersecting){newIdx=idx;for(var i=idx+1;i<this._objects.length;++i){var isIntersecting=object.intersectsWithObject(this._objects[i])||object.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(object);if(isIntersecting){newIdx=i;break}}}else newIdx=idx+1;return newIdx},moveTo:function(object,index){return removeFromArray(this._objects,object),this._objects.splice(index,0,object),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this.interactive&&this.removeListeners(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),extend(fabric.StaticCanvas.prototype,fabric.Observable),extend(fabric.StaticCanvas.prototype,fabric.Collection),extend(fabric.StaticCanvas.prototype,fabric.DataURLExporter),extend(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(methodName){var el=fabric.util.createCanvasElement();if(!el||!el.getContext)return null;var ctx=el.getContext("2d");if(!ctx)return null;switch(methodName){case"getImageData":return"undefined"!=typeof ctx.getImageData;case"setLineDash":return"undefined"!=typeof ctx.setLineDash;case"toDataURL":return"undefined"!=typeof el.toDataURL;case"toDataURLWithQuality":try{return el.toDataURL("image/jpeg",0),!0}catch(e){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(options){return this.shadow=new fabric.Shadow(options),this},_setBrushStyles:function(){var ctx=this.canvas.contextTop;ctx.strokeStyle=this.color,ctx.lineWidth=this.width,ctx.lineCap=this.strokeLineCap,ctx.lineJoin=this.strokeLineJoin},_setShadow:function(){if(this.shadow){var ctx=this.canvas.contextTop;ctx.shadowColor=this.shadow.color,ctx.shadowBlur=this.shadow.blur,ctx.shadowOffsetX=this.shadow.offsetX,ctx.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var ctx=this.canvas.contextTop;ctx.shadowColor="",ctx.shadowBlur=ctx.shadowOffsetX=ctx.shadowOffsetY=0}}),function(){var utilMin=fabric.util.array.min,utilMax=fabric.util.array.max;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(canvas){this.canvas=canvas,this._points=[]},onMouseDown:function(pointer){this._prepareForDrawing(pointer),this._captureDrawingPath(pointer),this._render()},onMouseMove:function(pointer){this._captureDrawingPath(pointer),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(pointer){var p=new fabric.Point(pointer.x,pointer.y);this._reset(),this._addPoint(p),this.canvas.contextTop.moveTo(p.x,p.y)},_addPoint:function(point){this._points.push(point)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(pointer){var pointerPoint=new fabric.Point(pointer.x,pointer.y);this._addPoint(pointerPoint)},_render:function(){var ctx=this.canvas.contextTop;ctx.beginPath();var p1=this._points[0],p2=this._points[1];2===this._points.length&&p1.x===p2.x&&p1.y===p2.y&&(p1.x-=.5,p2.x+=.5),ctx.moveTo(p1.x,p1.y);for(var i=1,len=this._points.length;len>i;i++){var midPoint=p1.midPointFrom(p2);ctx.quadraticCurveTo(p1.x,p1.y,midPoint.x,midPoint.y),p1=this._points[i],p2=this._points[i+1]}ctx.lineTo(p1.x,p1.y),ctx.stroke()},_getSVGPathData:function(){return this.box=this.getPathBoundingBox(this._points),this.convertPointsToSVGPath(this._points,this.box.minx,this.box.maxx,this.box.miny,this.box.maxy)},getPathBoundingBox:function(points){for(var xBounds=[],yBounds=[],p1=points[0],p2=points[1],startPoint=p1,i=1,len=points.length;len>i;i++){var midPoint=p1.midPointFrom(p2);xBounds.push(startPoint.x),xBounds.push(midPoint.x),yBounds.push(startPoint.y),yBounds.push(midPoint.y),p1=points[i],p2=points[i+1],startPoint=midPoint}return xBounds.push(p1.x),yBounds.push(p1.y),{minx:utilMin(xBounds),miny:utilMin(yBounds),maxx:utilMax(xBounds),maxy:utilMax(yBounds)}},convertPointsToSVGPath:function(points,minX,maxX,minY){var path=[],p1=new fabric.Point(points[0].x-minX,points[0].y-minY),p2=new fabric.Point(points[1].x-minX,points[1].y-minY);path.push("M ",points[0].x-minX," ",points[0].y-minY," ");for(var i=1,len=points.length;len>i;i++){var midPoint=p1.midPointFrom(p2);path.push("Q ",p1.x," ",p1.y," ",midPoint.x," ",midPoint.y," "),p1=new fabric.Point(points[i].x-minX,points[i].y-minY),i+1<points.length&&(p2=new fabric.Point(points[i+1].x-minX,points[i+1].y-minY))}return path.push("L ",p1.x," ",p1.y," "),path},createPath:function(pathData){var path=new fabric.Path(pathData);return path.fill=null,path.stroke=this.color,path.strokeWidth=this.width,path.strokeLineCap=this.strokeLineCap,path.strokeLineJoin=this.strokeLineJoin,this.shadow&&(this.shadow.affectStroke=!0,path.setShadow(this.shadow)),path},_finalizeAndAddPath:function(){var ctx=this.canvas.contextTop;ctx.closePath();var pathData=this._getSVGPathData().join("");if("M 0 0 Q 0 0 0 0 L 0 0"===pathData)return void this.canvas.renderAll();var originLeft=this.box.minx+(this.box.maxx-this.box.minx)/2,originTop=this.box.miny+(this.box.maxy-this.box.miny)/2;this.canvas.contextTop.arc(originLeft,originTop,3,0,2*Math.PI,!1);var path=this.createPath(pathData);path.set({left:originLeft,top:originTop,originX:"center",originY:"center"}),this.canvas.add(path),path.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:path})}})}(),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(canvas){this.canvas=canvas,this.points=[]},drawDot:function(pointer){var point=this.addPoint(pointer),ctx=this.canvas.contextTop;ctx.fillStyle=point.fill,ctx.beginPath(),ctx.arc(point.x,point.y,point.radius,0,2*Math.PI,!1),ctx.closePath(),ctx.fill()},onMouseDown:function(pointer){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(pointer)},onMouseMove:function(pointer){this.drawDot(pointer)},onMouseUp:function(){var originalRenderOnAddRemove=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var circles=[],i=0,len=this.points.length;len>i;i++){var point=this.points[i],circle=new fabric.Circle({radius:point.radius,left:point.x,top:point.y,originX:"center",originY:"center",fill:point.fill});this.shadow&&circle.setShadow(this.shadow),circles.push(circle)}var group=new fabric.Group(circles,{originX:"center",originY:"center"});this.canvas.add(group),this.canvas.fire("path:created",{path:group}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=originalRenderOnAddRemove,this.canvas.renderAll()},addPoint:function(pointer){var pointerPoint=new fabric.Point(pointer.x,pointer.y),circleRadius=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,circleColor=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return pointerPoint.radius=circleRadius,pointerPoint.fill=circleColor,this.points.push(pointerPoint),pointerPoint}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(canvas){this.canvas=canvas,this.sprayChunks=[]},onMouseDown:function(pointer){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(pointer),this.render()},onMouseMove:function(pointer){this.addSprayChunk(pointer),this.render()},onMouseUp:function(){var originalRenderOnAddRemove=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var rects=[],i=0,ilen=this.sprayChunks.length;ilen>i;i++)for(var sprayChunk=this.sprayChunks[i],j=0,jlen=sprayChunk.length;jlen>j;j++){var rect=new fabric.Rect({width:sprayChunk[j].width,height:sprayChunk[j].width,left:sprayChunk[j].x+1,top:sprayChunk[j].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&rect.setShadow(this.shadow),rects.push(rect)}this.optimizeOverlapping&&(rects=this._getOptimizedRects(rects));var group=new fabric.Group(rects,{originX:"center",originY:"center"});this.canvas.add(group),this.canvas.fire("path:created",{path:group}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=originalRenderOnAddRemove,this.canvas.renderAll()},_getOptimizedRects:function(rects){for(var key,uniqueRects={},i=0,len=rects.length;len>i;i++)key=rects[i].left+""+rects[i].top,uniqueRects[key]||(uniqueRects[key]=rects[i]);var uniqueRectsArray=[];for(key in uniqueRects)uniqueRectsArray.push(uniqueRects[key]);return uniqueRectsArray},render:function(){var ctx=this.canvas.contextTop;ctx.fillStyle=this.color,ctx.save();for(var i=0,len=this.sprayChunkPoints.length;len>i;i++){var point=this.sprayChunkPoints[i];"undefined"!=typeof point.opacity&&(ctx.globalAlpha=point.opacity),ctx.fillRect(point.x,point.y,point.width,point.width)}ctx.restore()},addSprayChunk:function(pointer){this.sprayChunkPoints=[];for(var x,y,width,radius=this.width/2,i=0;i<this.density;i++){x=fabric.util.getRandomInt(pointer.x-radius,pointer.x+radius),y=fabric.util.getRandomInt(pointer.y-radius,pointer.y+radius),width=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var point={x:x,y:y,width:width};this.randomOpacity&&(point.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(point)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var dotWidth=20,dotDistance=5,patternCanvas=fabric.document.createElement("canvas"),patternCtx=patternCanvas.getContext("2d");return patternCanvas.width=patternCanvas.height=dotWidth+dotDistance,patternCtx.fillStyle=this.color,patternCtx.beginPath(),patternCtx.arc(dotWidth/2,dotWidth/2,dotWidth/2,0,2*Math.PI,!1),patternCtx.closePath(),patternCtx.fill(),patternCanvas},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(pathData){var path=this.callSuper("createPath",pathData);return path.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),path}}),function(){var getPointer=fabric.util.getPointer,degreesToRadians=fabric.util.degreesToRadians,radiansToDegrees=fabric.util.radiansToDegrees,atan2=Math.atan2,abs=Math.abs,STROKE_OFFSET=.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(el,options){options||(options={}),this._initStatic(el,options),this._initInteractive(),this._createCacheCanvas(),fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_resetCurrentTransform:function(e){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,left:t.original.left,top:t.original.top}),this._shouldCenterTransform(e,t.target)?"rotate"===t.action?this._setOriginToCenter(t.target):("center"!==t.originX&&(t.mouseXSign="right"===t.originX?-1:1),"center"!==t.originY&&(t.mouseYSign="bottom"===t.originY?-1:1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(e,target){var pointer=this.getPointer(e),xy=this._normalizePointer(target,pointer);return target.containsPoint(xy)||target._findTargetCorner(e,this._offset)},_normalizePointer:function(object,pointer){var activeGroup=this.getActiveGroup(),x=pointer.x,y=pointer.y,isObjectInGroup=activeGroup&&"group"!==object.type&&activeGroup.contains(object);return isObjectInGroup&&(x-=activeGroup.left,y-=activeGroup.top),{x:x,y:y}},isTargetTransparent:function(target,x,y){var hasBorders=target.hasBorders,transparentCorners=target.transparentCorners;target.hasBorders=target.transparentCorners=!1,this._draw(this.contextCache,target),target.hasBorders=hasBorders,target.transparentCorners=transparentCorners;var isTransparent=fabric.util.isTransparent(this.contextCache,x,y,this.targetFindTolerance);return this.clearContext(this.contextCache),isTransparent},_shouldClearSelection:function(e,target){var activeGroup=this.getActiveGroup(),activeObject=this.getActiveObject();return!target||target&&activeGroup&&!activeGroup.contains(target)&&activeGroup!==target&&!e.shiftKey||target&&!target.evented||target&&!target.selectable&&activeObject&&activeObject!==target},_shouldCenterTransform:function(e,target){if(target){var centerTransform,t=this._currentTransform;return"scale"===t.action||"scaleX"===t.action||"scaleY"===t.action?centerTransform=this.centeredScaling||target.centeredScaling:"rotate"===t.action&&(centerTransform=this.centeredRotation||target.centeredRotation),centerTransform?!e.altKey:e.altKey}},_getOriginFromCorner:function(target,corner){var origin={x:target.originX,y:target.originY};return"ml"===corner||"tl"===corner||"bl"===corner?origin.x="right":("mr"===corner||"tr"===corner||"br"===corner)&&(origin.x="left"),"tl"===corner||"mt"===corner||"tr"===corner?origin.y="bottom":("bl"===corner||"mb"===corner||"br"===corner)&&(origin.y="top"),origin},_getActionFromCorner:function(target,corner){var action="drag";return corner&&(action="ml"===corner||"mr"===corner?"scaleX":"mt"===corner||"mb"===corner?"scaleY":"mtr"===corner?"rotate":"scale"),action},_setupCurrentTransform:function(e,target){if(target){var corner=target._findTargetCorner(e,this._offset),pointer=getPointer(e,target.canvas.upperCanvasEl),action=this._getActionFromCorner(target,corner),origin=this._getOriginFromCorner(target,corner);this._currentTransform={target:target,action:action,scaleX:target.scaleX,scaleY:target.scaleY,offsetX:pointer.x-target.left,offsetY:pointer.y-target.top,originX:origin.x,originY:origin.y,ex:pointer.x,ey:pointer.y,left:target.left,top:target.top,theta:degreesToRadians(target.angle),width:target.width*target.scaleX,mouseXSign:1,mouseYSign:1},this._currentTransform.original={left:target.left,top:target.top,scaleX:target.scaleX,scaleY:target.scaleY,originX:origin.x,originY:origin.y},this._resetCurrentTransform(e)}},_translateObject:function(x,y){var target=this._currentTransform.target;target.get("lockMovementX")||target.set("left",x-this._currentTransform.offsetX),target.get("lockMovementY")||target.set("top",y-this._currentTransform.offsetY)},_scaleObject:function(x,y,by){var t=this._currentTransform,offset=this._offset,target=t.target,lockScalingX=target.get("lockScalingX"),lockScalingY=target.get("lockScalingY");if(!lockScalingX||!lockScalingY){var constraintPosition=target.translateToOriginPoint(target.getCenterPoint(),t.originX,t.originY),localMouse=target.toLocalPoint(new fabric.Point(x-offset.left,y-offset.top),t.originX,t.originY);this._setLocalMouse(localMouse,t),this._setObjectScale(localMouse,t,lockScalingX,lockScalingY,by),target.setPositionByOrigin(constraintPosition,t.originX,t.originY)}},_setObjectScale:function(localMouse,transform,lockScalingX,lockScalingY,by){var target=transform.target;transform.newScaleX=target.scaleX,transform.newScaleY=target.scaleY,"equally"!==by||lockScalingX||lockScalingY?by?"x"!==by||target.get("lockUniScaling")?"y"!==by||target.get("lockUniScaling")||(transform.newScaleY=localMouse.y/(target.height+target.strokeWidth),lockScalingY||target.set("scaleY",transform.newScaleY)):(transform.newScaleX=localMouse.x/(target.width+target.strokeWidth),lockScalingX||target.set("scaleX",transform.newScaleX)):(transform.newScaleX=localMouse.x/(target.width+target.strokeWidth),transform.newScaleY=localMouse.y/(target.height+target.strokeWidth),lockScalingX||target.set("scaleX",transform.newScaleX),lockScalingY||target.set("scaleY",transform.newScaleY)):this._scaleObjectEqually(localMouse,target,transform),this._flipObject(transform)
},_scaleObjectEqually:function(localMouse,target,transform){var dist=localMouse.y+localMouse.x,lastDist=(target.height+target.strokeWidth)*transform.original.scaleY+(target.width+target.strokeWidth)*transform.original.scaleX;transform.newScaleX=transform.original.scaleX*dist/lastDist,transform.newScaleY=transform.original.scaleY*dist/lastDist,target.set("scaleX",transform.newScaleX),target.set("scaleY",transform.newScaleY)},_flipObject:function(transform){transform.newScaleX<0&&("left"===transform.originX?transform.originX="right":"right"===transform.originX&&(transform.originX="left")),transform.newScaleY<0&&("top"===transform.originY?transform.originY="bottom":"bottom"===transform.originY&&(transform.originY="top"))},_setLocalMouse:function(localMouse,t){var target=t.target;"right"===t.originX?localMouse.x*=-1:"center"===t.originX&&(localMouse.x*=2*t.mouseXSign,localMouse.x<0&&(t.mouseXSign=-t.mouseXSign)),"bottom"===t.originY?localMouse.y*=-1:"center"===t.originY&&(localMouse.y*=2*t.mouseYSign,localMouse.y<0&&(t.mouseYSign=-t.mouseYSign)),abs(localMouse.x)>target.padding?localMouse.x<0?localMouse.x+=target.padding:localMouse.x-=target.padding:localMouse.x=0,abs(localMouse.y)>target.padding?localMouse.y<0?localMouse.y+=target.padding:localMouse.y-=target.padding:localMouse.y=0},_rotateObject:function(x,y){var t=this._currentTransform,o=this._offset;if(!t.target.get("lockRotation")){var lastAngle=atan2(t.ey-t.top-o.top,t.ex-t.left-o.left),curAngle=atan2(y-t.top-o.top,x-t.left-o.left),angle=radiansToDegrees(curAngle-lastAngle+t.theta);0>angle&&(angle=360+angle),t.target.angle=angle}},_setCursor:function(value){this.upperCanvasEl.style.cursor=value},_resetObjectTransform:function(target){target.scaleX=1,target.scaleY=1,target.setAngle(0)},_drawSelection:function(){var ctx=this.contextTop,groupSelector=this._groupSelector,left=groupSelector.left,top=groupSelector.top,aleft=abs(left),atop=abs(top);if(ctx.fillStyle=this.selectionColor,ctx.fillRect(groupSelector.ex-(left>0?0:-left),groupSelector.ey-(top>0?0:-top),aleft,atop),ctx.lineWidth=this.selectionLineWidth,ctx.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1){var px=groupSelector.ex+STROKE_OFFSET-(left>0?0:aleft),py=groupSelector.ey+STROKE_OFFSET-(top>0?0:atop);ctx.beginPath(),fabric.util.drawDashedLine(ctx,px,py,px+aleft,py,this.selectionDashArray),fabric.util.drawDashedLine(ctx,px,py+atop-1,px+aleft,py+atop-1,this.selectionDashArray),fabric.util.drawDashedLine(ctx,px,py,px,py+atop,this.selectionDashArray),fabric.util.drawDashedLine(ctx,px+aleft-1,py,px+aleft-1,py+atop,this.selectionDashArray),ctx.closePath(),ctx.stroke()}else ctx.strokeRect(groupSelector.ex+STROKE_OFFSET-(left>0?0:aleft),groupSelector.ey+STROKE_OFFSET-(top>0?0:atop),aleft,atop)},_isLastRenderedObject:function(e){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(e,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(e,this._offset)},findTarget:function(e,skipGroup){if(!this.skipTargetFind){if(this._isLastRenderedObject(e))return this.lastRenderedObjectWithControlsAboveOverlay;var activeGroup=this.getActiveGroup();return activeGroup&&!skipGroup&&this.containsPoint(e,activeGroup)?activeGroup:this._searchPossibleTargets(e)}},_searchPossibleTargets:function(e){for(var target,possibleTargets=[],pointer=this.getPointer(e),i=this._objects.length;i--;)if(this._objects[i]&&this._objects[i].visible&&this._objects[i].evented&&this.containsPoint(e,this._objects[i])){if(!this.perPixelTargetFind&&!this._objects[i].perPixelTargetFind){target=this._objects[i],this.relatedTarget=target;break}possibleTargets[possibleTargets.length]=this._objects[i]}for(var j=0,len=possibleTargets.length;len>j;j++){pointer=this.getPointer(e);var isTransparent=this.isTargetTransparent(possibleTargets[j],pointer.x,pointer.y);if(!isTransparent){target=possibleTargets[j],this.relatedTarget=target;break}}return target},getPointer:function(e){var pointer=getPointer(e,this.upperCanvasEl);return{x:pointer.x-this._offset.left,y:pointer.y-this._offset.top}},_createUpperCanvas:function(){var lowerCanvasClass=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+lowerCanvasClass),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(element){var width=this.getWidth()||element.width,height=this.getHeight()||element.height;fabric.util.setStyle(element,{position:"absolute",width:width+"px",height:height+"px",left:0,top:0}),element.width=width,element.height=height,fabric.util.makeElementUnselectable(element)},_copyCanvasStyle:function(fromEl,toEl){toEl.style.cssText=fromEl.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(object){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=object,object.set("active",!0)},setActiveObject:function(object,e){return this._setActiveObject(object),this.renderAll(),this.fire("object:selected",{target:object,e:e}),object.fire("selected",{e:e}),this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null},discardActiveObject:function(e){return this._discardActiveObject(),this.renderAll(),this.fire("selection:cleared",{e:e}),this},_setActiveGroup:function(group){this._activeGroup=group,group&&(group.canvas=this,group.set("active",!0))},setActiveGroup:function(group,e){return this._setActiveGroup(group),group&&(this.fire("object:selected",{target:group,e:e}),group.fire("selected",{e:e})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var g=this.getActiveGroup();g&&g.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(e){return this._discardActiveGroup(),this.fire("selection:cleared",{e:e}),this},deactivateAll:function(){for(var allObjects=this.getObjects(),i=0,len=allObjects.length;len>i;i++)allObjects[i].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(e){var activeObject=this.getActiveGroup()||this.getActiveObject();return activeObject&&this.fire("before:selection:cleared",{target:activeObject,e:e}),this.deactivateAll(),activeObject&&this.fire("selection:cleared",{e:e}),this},drawControls:function(ctx){var activeGroup=this.getActiveGroup();activeGroup?this._drawGroupControls(ctx,activeGroup):this._drawObjectsControls(ctx)},_drawGroupControls:function(ctx,activeGroup){this._drawControls(ctx,activeGroup,"Group")},_drawObjectsControls:function(ctx){for(var i=0,len=this._objects.length;len>i;++i)this._objects[i]&&this._objects[i].active&&(this._drawControls(ctx,this._objects[i],"Object"),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[i])},_drawControls:function(ctx,object,klass){ctx.save(),fabric[klass].prototype.transform.call(object,ctx),object.drawBorders(ctx).drawControls(ctx),ctx.restore()}});for(var prop in fabric.StaticCanvas)"prototype"!==prop&&(fabric.Canvas[prop]=fabric.StaticCanvas[prop]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var cursorMap=["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],cursorOffset={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},addListener=fabric.util.addListener,removeListener=fabric.util.removeListener,getPointer=fabric.util.getPointer;fabric.util.object.extend(fabric.Canvas.prototype,{_initEventListeners:function(){this._bindEvents(),addListener(fabric.window,"resize",this._onResize),addListener(this.upperCanvasEl,"mousedown",this._onMouseDown),addListener(this.upperCanvasEl,"mousemove",this._onMouseMove),addListener(this.upperCanvasEl,"mousewheel",this._onMouseWheel),addListener(this.upperCanvasEl,"touchstart",this._onMouseDown),addListener(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof Event&&"add"in Event&&(Event.add(this.upperCanvasEl,"gesture",this._onGesture),Event.add(this.upperCanvasEl,"drag",this._onDrag),Event.add(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.add(this.upperCanvasEl,"shake",this._onShake))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){removeListener(fabric.window,"resize",this._onResize),removeListener(this.upperCanvasEl,"mousedown",this._onMouseDown),removeListener(this.upperCanvasEl,"mousemove",this._onMouseMove),removeListener(this.upperCanvasEl,"mousewheel",this._onMouseWheel),removeListener(this.upperCanvasEl,"touchstart",this._onMouseDown),removeListener(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof Event&&"remove"in Event&&(Event.remove(this.upperCanvasEl,"gesture",this._onGesture),Event.remove(this.upperCanvasEl,"drag",this._onDrag),Event.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.remove(this.upperCanvasEl,"shake",this._onShake))},_onGesture:function(e,s){this.__onTransformGesture&&this.__onTransformGesture(e,s)},_onDrag:function(e,s){this.__onDrag&&this.__onDrag(e,s)},_onMouseWheel:function(e,s){this.__onMouseWheel&&this.__onMouseWheel(e,s)},_onOrientationChange:function(e,s){this.__onOrientationChange&&this.__onOrientationChange(e,s)},_onShake:function(e,s){this.__onShake&&this.__onShake(e,s)},_onMouseDown:function(e){this.__onMouseDown(e),addListener(fabric.document,"mouseup",this._onMouseUp),addListener(fabric.document,"touchend",this._onMouseUp),addListener(fabric.document,"mousemove",this._onMouseMove),addListener(fabric.document,"touchmove",this._onMouseMove),removeListener(this.upperCanvasEl,"mousemove",this._onMouseMove),removeListener(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseUp:function(e){this.__onMouseUp(e),removeListener(fabric.document,"mouseup",this._onMouseUp),removeListener(fabric.document,"touchend",this._onMouseUp),removeListener(fabric.document,"mousemove",this._onMouseMove),removeListener(fabric.document,"touchmove",this._onMouseMove),addListener(this.upperCanvasEl,"mousemove",this._onMouseMove),addListener(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseMove:function(e){!this.allowTouchScrolling&&e.preventDefault&&e.preventDefault(),this.__onMouseMove(e)},_onResize:function(){this.calcOffset()},_shouldRender:function(target,pointer){var activeObject=this.getActiveGroup()||this.getActiveObject();return!!(target&&(target.isMoving||target!==activeObject)||!target&&activeObject||!target&&!activeObject&&!this._groupSelector||pointer&&this._previousPointer&&this.selection&&(pointer.x!==this._previousPointer.x||pointer.y!==this._previousPointer.y))},__onMouseUp:function(e){var target;if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(e);this._currentTransform?(this._finalizeCurrentTransform(),target=this._currentTransform.target):target=this.findTarget(e,!0);var shouldRender=this._shouldRender(target,this.getPointer(e));this._maybeGroupObjects(e),target&&(target.isMoving=!1),shouldRender&&this.renderAll(),this._handleCursorAndEvent(e,target)},_handleCursorAndEvent:function(e,target){this._setCursorFromEvent(e,target);var _this=this;setTimeout(function(){_this._setCursorFromEvent(e,target)},50),this.fire("mouse:up",{target:target,e:e}),target&&target.fire("mouseup",{e:e})},_finalizeCurrentTransform:function(){var transform=this._currentTransform,target=transform.target;target._scaling&&(target._scaling=!1),target.setCoords(),this.stateful&&target.hasStateChanged()&&(this.fire("object:modified",{target:target}),target.fire("modified")),this._restoreOriginXY(target)},_restoreOriginXY:function(target){if(this._previousOriginX&&this._previousOriginY){var originPoint=target.translateToOriginPoint(target.getCenterPoint(),this._previousOriginX,this._previousOriginY);target.originX=this._previousOriginX,target.originY=this._previousOriginY,target.left=originPoint.x,target.top=originPoint.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(e){this._isCurrentlyDrawing=!0,this.discardActiveObject(e).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop),this.freeDrawingBrush.onMouseDown(this.getPointer(e)),this.fire("mouse:down",{e:e})},_onMouseMoveInDrawingMode:function(e){if(this._isCurrentlyDrawing){var pointer=this.getPointer(e);this.freeDrawingBrush.onMouseMove(pointer)}this.upperCanvasEl.style.cursor=this.freeDrawingCursor,this.fire("mouse:move",{e:e})},_onMouseUpInDrawingMode:function(e){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this.fire("mouse:up",{e:e})},__onMouseDown:function(e){var isLeftClick="which"in e?1===e.which:1===e.button;if(isLeftClick||fabric.isTouchSupported){if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(e);if(!this._currentTransform){var target=this.findTarget(e),pointer=this.getPointer(e);this._previousPointer=pointer;var shouldRender=this._shouldRender(target,pointer),shouldGroup=this._shouldGroup(e,target);this._shouldClearSelection(e,target)?this._clearSelection(e,target,pointer):shouldGroup&&(this._handleGrouping(e,target),target=this.getActiveGroup()),target&&target.selectable&&!shouldGroup&&(this._beforeTransform(e,target),this._setupCurrentTransform(e,target)),shouldRender&&this.renderAll(),this.fire("mouse:down",{target:target,e:e}),target&&target.fire("mousedown",{e:e})}}},_beforeTransform:function(e,target){var corner;this.stateful&&target.saveState(),(corner=target._findTargetCorner(e,this._offset))&&this.onBeforeScaleRotate(target),target!==this.getActiveGroup()&&target!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(target,e))},_clearSelection:function(e,target,pointer){this.deactivateAllWithDispatch(e),target&&target.selectable?this.setActiveObject(target,e):this.selection&&(this._groupSelector={ex:pointer.x,ey:pointer.y,top:0,left:0})},_setOriginToCenter:function(target){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var center=target.getCenterPoint();target.originX="center",target.originY="center",target.left=center.x,target.top=center.y,this._currentTransform.left=target.left,this._currentTransform.top=target.top},_setCenterToOrigin:function(target){var originPoint=target.translateToOriginPoint(target.getCenterPoint(),this._previousOriginX,this._previousOriginY);target.originX=this._previousOriginX,target.originY=this._previousOriginY,target.left=originPoint.x,target.top=originPoint.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(e){var target,pointer;if(this.isDrawingMode)return void this._onMouseMoveInDrawingMode(e);var groupSelector=this._groupSelector;groupSelector?(pointer=getPointer(e,this.upperCanvasEl),groupSelector.left=pointer.x-this._offset.left-groupSelector.ex,groupSelector.top=pointer.y-this._offset.top-groupSelector.ey,this.renderTop()):this._currentTransform?this._transformObject(e):(target=this.findTarget(e),!target||target&&!target.selectable?this.upperCanvasEl.style.cursor=this.defaultCursor:this._setCursorFromEvent(e,target)),this.fire("mouse:move",{target:target,e:e}),target&&target.fire("mousemove",{e:e})},_transformObject:function(e){var pointer=getPointer(e,this.upperCanvasEl),transform=this._currentTransform;transform.reset=!1,transform.target.isMoving=!0,this._beforeScaleTransform(e,transform),this._performTransformAction(e,transform,pointer),this.renderAll()},_performTransformAction:function(e,transform,pointer){var x=pointer.x,y=pointer.y,target=transform.target,action=transform.action;"rotate"===action?(this._rotateObject(x,y),this._fire("rotating",target,e)):"scale"===action?(this._onScale(e,transform,x,y),this._fire("scaling",target,e)):"scaleX"===action?(this._scaleObject(x,y,"x"),this._fire("scaling",target,e)):"scaleY"===action?(this._scaleObject(x,y,"y"),this._fire("scaling",target,e)):(this._translateObject(x,y),this._fire("moving",target,e),this._setCursor(this.moveCursor))},_fire:function(eventName,target,e){this.fire("object:"+eventName,{target:target,e:e}),target.fire(eventName,{e:e})},_beforeScaleTransform:function(e,transform){if("scale"===transform.action||"scaleX"===transform.action||"scaleY"===transform.action){var centerTransform=this._shouldCenterTransform(e,transform.target);(centerTransform&&("center"!==transform.originX||"center"!==transform.originY)||!centerTransform&&"center"===transform.originX&&"center"===transform.originY)&&(this._resetCurrentTransform(e),transform.reset=!0)}},_onScale:function(e,transform,x,y){!e.shiftKey&&!this.uniScaleTransform||transform.target.get("lockUniScaling")?(transform.reset||"scale"!==transform.currentAction||this._resetCurrentTransform(e,transform.target),transform.currentAction="scaleEqually",this._scaleObject(x,y,"equally")):(transform.currentAction="scale",this._scaleObject(x,y))},_setCursorFromEvent:function(e,target){var style=this.upperCanvasEl.style;if(!target||!target.selectable)return style.cursor=this.defaultCursor,!1;var activeGroup=this.getActiveGroup(),corner=target._findTargetCorner&&(!activeGroup||!activeGroup.contains(target))&&target._findTargetCorner(e,this._offset);return corner?this._setCornerCursor(corner,target):style.cursor=target.hoverCursor||this.hoverCursor,!0},_setCornerCursor:function(corner,target){var style=this.upperCanvasEl.style;if(corner in cursorOffset)style.cursor=this._getRotatedCornerCursor(corner,target);else{if("mtr"!==corner||!target.hasRotatingPoint)return style.cursor=this.defaultCursor,!1;style.cursor=this.rotationCursor}},_getRotatedCornerCursor:function(corner,target){var n=Math.round(target.getAngle()%360/45);return 0>n&&(n+=8),n+=cursorOffset[corner],n%=8,cursorMap[n]}})}(),function(){var min=Math.min,max=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(e,target){var activeObject=this.getActiveObject();return e.shiftKey&&(this.getActiveGroup()||activeObject&&activeObject!==target)&&this.selection},_handleGrouping:function(e,target){(target!==this.getActiveGroup()||(target=this.findTarget(e,!0),target&&!target.isType("group")))&&(this.getActiveGroup()?this._updateActiveGroup(target,e):this._createActiveGroup(target,e),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(target,e){var activeGroup=this.getActiveGroup();if(activeGroup.contains(target)){if(activeGroup.removeWithUpdate(target),this._resetObjectTransform(activeGroup),target.set("active",!1),1===activeGroup.size())return this.discardActiveGroup(e),void this.setActiveObject(activeGroup.item(0))}else activeGroup.addWithUpdate(target),this._resetObjectTransform(activeGroup);this.fire("selection:created",{target:activeGroup,e:e}),activeGroup.set("active",!0)},_createActiveGroup:function(target,e){if(this._activeObject&&target!==this._activeObject){var group=this._createGroup(target);this.setActiveGroup(group),this._activeObject=null,this.fire("selection:created",{target:group,e:e})}target.set("active",!0)},_createGroup:function(target){var objects=this.getObjects(),isActiveLower=objects.indexOf(this._activeObject)<objects.indexOf(target),groupObjects=isActiveLower?[this._activeObject,target]:[target,this._activeObject];return new fabric.Group(groupObjects,{originX:"center",originY:"center"})},_groupSelectedObjects:function(e){var group=this._collectObjects();1===group.length?this.setActiveObject(group[0],e):group.length>1&&(group=new fabric.Group(group.reverse(),{originX:"center",originY:"center"}),this.setActiveGroup(group,e),group.saveCoords(),this.fire("selection:created",{target:group}),this.renderAll())},_collectObjects:function(){for(var currentObject,group=[],x1=this._groupSelector.ex,y1=this._groupSelector.ey,x2=x1+this._groupSelector.left,y2=y1+this._groupSelector.top,selectionX1Y1=new fabric.Point(min(x1,x2),min(y1,y2)),selectionX2Y2=new fabric.Point(max(x1,x2),max(y1,y2)),isClick=x1===x2&&y1===y2,i=this._objects.length;i--&&(currentObject=this._objects[i],!(currentObject&&currentObject.selectable&&currentObject.visible&&(currentObject.intersectsWithRect(selectionX1Y1,selectionX2Y2)||currentObject.isContainedWithinRect(selectionX1Y1,selectionX2Y2)||currentObject.containsPoint(selectionX1Y1)||currentObject.containsPoint(selectionX2Y2))&&(currentObject.set("active",!0),group.push(currentObject),isClick))););return group},_maybeGroupObjects:function(e){this.selection&&this._groupSelector&&this._groupSelectedObjects(e);var activeGroup=this.getActiveGroup();activeGroup&&(activeGroup.setObjectsCoords().setCoords(),activeGroup.isMoving=!1,this._setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(options){options||(options={});var format=options.format||"png",quality=options.quality||1,multiplier=options.multiplier||1,cropping={left:options.left,top:options.top,width:options.width,height:options.height};return 1!==multiplier?this.__toDataURLWithMultiplier(format,quality,cropping,multiplier):this.__toDataURL(format,quality,cropping)},__toDataURL:function(format,quality,cropping){this.renderAll(!0);var canvasEl=this.upperCanvasEl||this.lowerCanvasEl,croppedCanvasEl=this.__getCroppedCanvas(canvasEl,cropping);"jpg"===format&&(format="jpeg");var data=fabric.StaticCanvas.supports("toDataURLWithQuality")?(croppedCanvasEl||canvasEl).toDataURL("image/"+format,quality):(croppedCanvasEl||canvasEl).toDataURL("image/"+format);return this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),croppedCanvasEl&&(croppedCanvasEl=null),data},__getCroppedCanvas:function(canvasEl,cropping){var croppedCanvasEl,croppedCtx,shouldCrop="left"in cropping||"top"in cropping||"width"in cropping||"height"in cropping;return shouldCrop&&(croppedCanvasEl=fabric.util.createCanvasElement(),croppedCtx=croppedCanvasEl.getContext("2d"),croppedCanvasEl.width=cropping.width||this.width,croppedCanvasEl.height=cropping.height||this.height,croppedCtx.drawImage(canvasEl,-cropping.left||0,-cropping.top||0)),croppedCanvasEl},__toDataURLWithMultiplier:function(format,quality,cropping,multiplier){var origWidth=this.getWidth(),origHeight=this.getHeight(),scaledWidth=origWidth*multiplier,scaledHeight=origHeight*multiplier,activeObject=this.getActiveObject(),activeGroup=this.getActiveGroup(),ctx=this.contextTop||this.contextContainer;this.setWidth(scaledWidth).setHeight(scaledHeight),ctx.scale(multiplier,multiplier),cropping.left&&(cropping.left*=multiplier),cropping.top&&(cropping.top*=multiplier),cropping.width&&(cropping.width*=multiplier),cropping.height&&(cropping.height*=multiplier),activeGroup?this._tempRemoveBordersControlsFromGroup(activeGroup):activeObject&&this.deactivateAll&&this.deactivateAll(),this.renderAll(!0);var data=this.__toDataURL(format,quality,cropping);return this.width=origWidth,this.height=origHeight,ctx.scale(1/multiplier,1/multiplier),this.setWidth(origWidth).setHeight(origHeight),activeGroup?this._restoreBordersControlsOnGroup(activeGroup):activeObject&&this.setActiveObject&&this.setActiveObject(activeObject),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),data},toDataURLWithMultiplier:function(format,multiplier,quality){return this.toDataURL({format:format,multiplier:multiplier,quality:quality})},_tempRemoveBordersControlsFromGroup:function(group){group.origHasControls=group.hasControls,group.origBorderColor=group.borderColor,group.hasControls=!0,group.borderColor="rgba(0,0,0,0)",group.forEachObject(function(o){o.origBorderColor=o.borderColor,o.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(group){group.hideControls=group.origHideControls,group.borderColor=group.origBorderColor,group.forEachObject(function(o){o.borderColor=o.origBorderColor,delete o.origBorderColor})}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(json,callback,reviver){return this.loadFromJSON(json,callback,reviver)},loadFromJSON:function(json,callback,reviver){if(json){var serialized="string"==typeof json?JSON.parse(json):json;this.clear();var _this=this;return this._enlivenObjects(serialized.objects,function(){_this._setBgOverlay(serialized,callback)},reviver),this}},_setBgOverlay:function(serialized,callback){var _this=this,loaded={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!(serialized.backgroundImage||serialized.overlayImage||serialized.background||serialized.overlay))return void(callback&&callback());var cbIfLoaded=function(){loaded.backgroundImage&&loaded.overlayImage&&loaded.backgroundColor&&loaded.overlayColor&&(_this.renderAll(),callback&&callback())};this.__setBgOverlay("backgroundImage",serialized.backgroundImage,loaded,cbIfLoaded),this.__setBgOverlay("overlayImage",serialized.overlayImage,loaded,cbIfLoaded),this.__setBgOverlay("backgroundColor",serialized.background,loaded,cbIfLoaded),this.__setBgOverlay("overlayColor",serialized.overlay,loaded,cbIfLoaded),cbIfLoaded()},__setBgOverlay:function(property,value,loaded,callback){var _this=this;return value?void("backgroundImage"===property||"overlayImage"===property?fabric.Image.fromObject(value,function(img){_this[property]=img,loaded[property]=!0,callback&&callback()}):this["set"+fabric.util.string.capitalize(property,!0)](value,function(){loaded[property]=!0,callback&&callback()})):void(loaded[property]=!0)},_enlivenObjects:function(objects,callback,reviver){var _this=this;0===objects.length&&callback&&callback();var renderOnAddRemove=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(objects,function(enlivenedObjects){enlivenedObjects.forEach(function(obj,index){_this.insertAt(obj,index,!0)}),_this.renderOnAddRemove=renderOnAddRemove,callback&&callback()},null,reviver)},_toDataURL:function(format,callback){this.clone(function(clone){callback(clone.toDataURL(format))})},_toDataURLWithMultiplier:function(format,multiplier,callback){this.clone(function(clone){callback(clone.toDataURLWithMultiplier(format,multiplier))})},clone:function(callback,properties){var data=JSON.stringify(this.toJSON(properties));this.cloneWithoutData(function(clone){clone.loadFromJSON(data,function(){callback&&callback(clone)})})},cloneWithoutData:function(callback){var el=fabric.document.createElement("canvas");el.width=this.getWidth(),el.height=this.getHeight();var clone=new fabric.Canvas(el);clone.clipTo=this.clipTo,this.backgroundImage?(clone.setBackgroundImage(this.backgroundImage.src,function(){clone.renderAll(),callback&&callback(clone)}),clone.backgroundImageOpacity=this.backgroundImageOpacity,clone.backgroundImageStretch=this.backgroundImageStretch):callback&&callback(clone)}}),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,toFixed=fabric.util.toFixed,capitalize=fabric.util.string.capitalize,degreesToRadians=fabric.util.degreesToRadians,supportsLineDash=fabric.StaticCanvas.supports("setLineDash");fabric.Object||(fabric.Object=fabric.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule shadow clipTo visible backgroundColor".split(" "),initialize:function(options){options&&this.setOptions(options)},_initGradient:function(options){!options.fill||!options.fill.colorStops||options.fill instanceof fabric.Gradient||this.set("fill",new fabric.Gradient(options.fill))},_initPattern:function(options){!options.fill||!options.fill.source||options.fill instanceof fabric.Pattern||this.set("fill",new fabric.Pattern(options.fill)),!options.stroke||!options.stroke.source||options.stroke instanceof fabric.Pattern||this.set("stroke",new fabric.Pattern(options.stroke))},_initClipping:function(options){if(options.clipTo&&"string"==typeof options.clipTo){var functionBody=fabric.util.getFunctionBody(options.clipTo);"undefined"!=typeof functionBody&&(this.clipTo=new Function("ctx",functionBody))}},setOptions:function(options){for(var prop in options)this.set(prop,options[prop]);this._initGradient(options),this._initPattern(options),this._initClipping(options)},transform:function(ctx,fromLeft){ctx.globalAlpha=this.opacity;var center=fromLeft?this._getLeftTopCoords():this.getCenterPoint();ctx.translate(center.x,center.y),ctx.rotate(degreesToRadians(this.angle)),ctx.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(propertiesToInclude){var NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,object={type:this.type,originX:this.originX,originY:this.originY,left:toFixed(this.left,NUM_FRACTION_DIGITS),top:toFixed(this.top,NUM_FRACTION_DIGITS),width:toFixed(this.width,NUM_FRACTION_DIGITS),height:toFixed(this.height,NUM_FRACTION_DIGITS),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:toFixed(this.strokeWidth,NUM_FRACTION_DIGITS),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:toFixed(this.strokeMiterLimit,NUM_FRACTION_DIGITS),scaleX:toFixed(this.scaleX,NUM_FRACTION_DIGITS),scaleY:toFixed(this.scaleY,NUM_FRACTION_DIGITS),angle:toFixed(this.getAngle(),NUM_FRACTION_DIGITS),flipX:this.flipX,flipY:this.flipY,opacity:toFixed(this.opacity,NUM_FRACTION_DIGITS),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor};return this.includeDefaultValues||(object=this._removeDefaultValues(object)),fabric.util.populateWithProperties(this,object,propertiesToInclude),object},toDatalessObject:function(propertiesToInclude){return this.toObject(propertiesToInclude)
},_removeDefaultValues:function(object){var prototype=fabric.util.getKlass(object.type).prototype,stateProperties=prototype.stateProperties;return stateProperties.forEach(function(prop){object[prop]===prototype[prop]&&delete object[prop]}),object},toString:function(){return"#<fabric."+capitalize(this.type)+">"},get:function(property){return this[property]},set:function(key,value){if("object"==typeof key)for(var prop in key)this._set(prop,key[prop]);else"function"==typeof value&&"clipTo"!==key?this._set(key,value(this.get(key))):this._set(key,value);return this},_set:function(key,value){var shouldConstrainValue="scaleX"===key||"scaleY"===key;return shouldConstrainValue&&(value=this._constrainScale(value)),"scaleX"===key&&0>value?(this.flipX=!this.flipX,value*=-1):"scaleY"===key&&0>value?(this.flipY=!this.flipY,value*=-1):"width"===key||"height"===key?this.minScaleLimit=toFixed(Math.min(.1,1/Math.max(this.width,this.height)),2):"shadow"!==key||!value||value instanceof fabric.Shadow||(value=new fabric.Shadow(value)),this[key]=value,this},toggle:function(property){var value=this.get(property);return"boolean"==typeof value&&this.set(property,!value),this},setSourcePath:function(value){return this.sourcePath=value,this},render:function(ctx,noTransform){if(0!==this.width&&0!==this.height&&this.visible){ctx.save(),this._transform(ctx,noTransform),this._setStrokeStyles(ctx),this._setFillStyles(ctx);var m=this.transformMatrix;m&&this.group&&(ctx.translate(-this.group.width/2,-this.group.height/2),ctx.transform(m[0],m[1],m[2],m[3],m[4],m[5])),this._setShadow(ctx),this.clipTo&&fabric.util.clipContext(this,ctx),this._render(ctx,noTransform),this.clipTo&&ctx.restore(),this._removeShadow(ctx),this.active&&!noTransform&&(this.drawBorders(ctx),this.drawControls(ctx)),ctx.restore()}},_transform:function(ctx,noTransform){var m=this.transformMatrix;m&&!this.group&&ctx.setTransform(m[0],m[1],m[2],m[3],m[4],m[5]),noTransform||this.transform(ctx)},_setStrokeStyles:function(ctx){this.stroke&&(ctx.lineWidth=this.strokeWidth,ctx.lineCap=this.strokeLineCap,ctx.lineJoin=this.strokeLineJoin,ctx.miterLimit=this.strokeMiterLimit,ctx.strokeStyle=this.stroke.toLive?this.stroke.toLive(ctx):this.stroke)},_setFillStyles:function(ctx){this.fill&&(ctx.fillStyle=this.fill.toLive?this.fill.toLive(ctx):this.fill)},_setShadow:function(ctx){this.shadow&&(ctx.shadowColor=this.shadow.color,ctx.shadowBlur=this.shadow.blur,ctx.shadowOffsetX=this.shadow.offsetX,ctx.shadowOffsetY=this.shadow.offsetY)},_removeShadow:function(ctx){ctx.shadowColor="",ctx.shadowBlur=ctx.shadowOffsetX=ctx.shadowOffsetY=0},_renderFill:function(ctx){this.fill&&(this.fill.toLive&&(ctx.save(),ctx.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)),ctx.fill(),this.fill.toLive&&ctx.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(ctx))},_renderStroke:function(ctx){this.stroke&&(ctx.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),supportsLineDash?(ctx.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(ctx)):this._renderDashedStroke&&this._renderDashedStroke(ctx),ctx.stroke()):this._stroke?this._stroke(ctx):ctx.stroke(),this._removeShadow(ctx),ctx.restore())},clone:function(callback,propertiesToInclude){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(propertiesToInclude),callback):new fabric.Object(this.toObject(propertiesToInclude))},cloneAsImage:function(callback){var dataUrl=this.toDataURL();return fabric.util.loadImage(dataUrl,function(img){callback&&callback(new fabric.Image(img))}),this},toDataURL:function(options){options||(options={});var el=fabric.util.createCanvasElement(),boundingRect=this.getBoundingRect();el.width=boundingRect.width,el.height=boundingRect.height,fabric.util.wrapElement(el,"div");var canvas=new fabric.Canvas(el);"jpg"===options.format&&(options.format="jpeg"),"jpeg"===options.format&&(canvas.backgroundColor="#fff");var origParams={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new fabric.Point(el.width/2,el.height/2),"center","center");var originalCanvas=this.canvas;canvas.add(this);var data=canvas.toDataURL(options);return this.set(origParams).setCoords(),this.canvas=originalCanvas,canvas.dispose(),canvas=null,data},isType:function(type){return this.type===type},complexity:function(){return 0},toJSON:function(propertiesToInclude){return this.toObject(propertiesToInclude)},setGradient:function(property,options){options||(options={});var gradient={colorStops:[]};gradient.type=options.type||(options.r1||options.r2?"radial":"linear"),gradient.coords={x1:options.x1,y1:options.y1,x2:options.x2,y2:options.y2},(options.r1||options.r2)&&(gradient.coords.r1=options.r1,gradient.coords.r2=options.r2);for(var position in options.colorStops){var color=new fabric.Color(options.colorStops[position]);gradient.colorStops.push({offset:position,color:color.toRgb(),opacity:color.getAlpha()})}return this.set(property,fabric.Gradient.forObject(this,gradient))},setPatternFill:function(options){return this.set("fill",new fabric.Pattern(options))},setShadow:function(options){return this.set("shadow",new fabric.Shadow(options))},setColor:function(color){return this.set("fill",color),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.canvas.centerObject(this),this},remove:function(){return this.canvas.remove(this)},getLocalPointer:function(e,pointer){pointer=pointer||this.canvas.getPointer(e);var objectLeftTop=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:pointer.x-objectLeftTop.x,y:pointer.y-objectLeftTop.y}}}),fabric.util.createAccessors(fabric.Object),fabric.Object.prototype.rotate=fabric.Object.prototype.setAngle,extend(fabric.Object.prototype,fabric.Observable),fabric.Object.NUM_FRACTION_DIGITS=2,fabric.Object.__uid=0)}("undefined"!=typeof exports?exports:this),function(){var degreesToRadians=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(point,originX,originY){var cx=point.x,cy=point.y,strokeWidth=this.stroke?this.strokeWidth:0;return"left"===originX?cx=point.x+(this.getWidth()+strokeWidth*this.scaleX)/2:"right"===originX&&(cx=point.x-(this.getWidth()+strokeWidth*this.scaleX)/2),"top"===originY?cy=point.y+(this.getHeight()+strokeWidth*this.scaleY)/2:"bottom"===originY&&(cy=point.y-(this.getHeight()+strokeWidth*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(cx,cy),point,degreesToRadians(this.angle))},translateToOriginPoint:function(center,originX,originY){var x=center.x,y=center.y,strokeWidth=this.stroke?this.strokeWidth:0;return"left"===originX?x=center.x-(this.getWidth()+strokeWidth*this.scaleX)/2:"right"===originX&&(x=center.x+(this.getWidth()+strokeWidth*this.scaleX)/2),"top"===originY?y=center.y-(this.getHeight()+strokeWidth*this.scaleY)/2:"bottom"===originY&&(y=center.y+(this.getHeight()+strokeWidth*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(x,y),center,degreesToRadians(this.angle))},getCenterPoint:function(){var leftTop=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(leftTop,this.originX,this.originY)},getPointByOrigin:function(originX,originY){var center=this.getCenterPoint();return this.translateToOriginPoint(center,originX,originY)},toLocalPoint:function(point,originX,originY){var x,y,center=this.getCenterPoint(),strokeWidth=this.stroke?this.strokeWidth:0;return originX&&originY?(x="left"===originX?center.x-(this.getWidth()+strokeWidth*this.scaleX)/2:"right"===originX?center.x+(this.getWidth()+strokeWidth*this.scaleX)/2:center.x,y="top"===originY?center.y-(this.getHeight()+strokeWidth*this.scaleY)/2:"bottom"===originY?center.y+(this.getHeight()+strokeWidth*this.scaleY)/2:center.y):(x=this.left,y=this.top),fabric.util.rotatePoint(new fabric.Point(point.x,point.y),center,-degreesToRadians(this.angle)).subtractEquals(new fabric.Point(x,y))},setPositionByOrigin:function(pos,originX,originY){var center=this.translateToCenterPoint(pos,originX,originY),position=this.translateToOriginPoint(center,this.originX,this.originY);this.set("left",position.x),this.set("top",position.y)},adjustPosition:function(to){var angle=degreesToRadians(this.angle),hypotHalf=this.getWidth()/2,xHalf=Math.cos(angle)*hypotHalf,yHalf=Math.sin(angle)*hypotHalf,hypotFull=this.getWidth(),xFull=Math.cos(angle)*hypotFull,yFull=Math.sin(angle)*hypotFull;"center"===this.originX&&"left"===to||"right"===this.originX&&"center"===to?(this.left-=xHalf,this.top-=yHalf):"left"===this.originX&&"center"===to||"center"===this.originX&&"right"===to?(this.left+=xHalf,this.top+=yHalf):"left"===this.originX&&"right"===to?(this.left+=xFull,this.top+=yFull):"right"===this.originX&&"left"===to&&(this.left-=xFull,this.top-=yFull),this.setCoords(),this.originX=to},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})}(),function(){var degreesToRadians=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(pointTL,pointBR){var oCoords=this.oCoords,tl=new fabric.Point(oCoords.tl.x,oCoords.tl.y),tr=new fabric.Point(oCoords.tr.x,oCoords.tr.y),bl=new fabric.Point(oCoords.bl.x,oCoords.bl.y),br=new fabric.Point(oCoords.br.x,oCoords.br.y),intersection=fabric.Intersection.intersectPolygonRectangle([tl,tr,br,bl],pointTL,pointBR);return"Intersection"===intersection.status},intersectsWithObject:function(other){function getCoords(oCoords){return{tl:new fabric.Point(oCoords.tl.x,oCoords.tl.y),tr:new fabric.Point(oCoords.tr.x,oCoords.tr.y),bl:new fabric.Point(oCoords.bl.x,oCoords.bl.y),br:new fabric.Point(oCoords.br.x,oCoords.br.y)}}var thisCoords=getCoords(this.oCoords),otherCoords=getCoords(other.oCoords),intersection=fabric.Intersection.intersectPolygonPolygon([thisCoords.tl,thisCoords.tr,thisCoords.br,thisCoords.bl],[otherCoords.tl,otherCoords.tr,otherCoords.br,otherCoords.bl]);return"Intersection"===intersection.status},isContainedWithinObject:function(other){var boundingRect=other.getBoundingRect(),point1=new fabric.Point(boundingRect.left,boundingRect.top),point2=new fabric.Point(boundingRect.left+boundingRect.width,boundingRect.top+boundingRect.height);return this.isContainedWithinRect(point1,point2)},isContainedWithinRect:function(pointTL,pointBR){var boundingRect=this.getBoundingRect();return boundingRect.left>pointTL.x&&boundingRect.left+boundingRect.width<pointBR.x&&boundingRect.top>pointTL.y&&boundingRect.top+boundingRect.height<pointBR.y},containsPoint:function(point){var lines=this._getImageLines(this.oCoords),xPoints=this._findCrossPoints(point,lines);return 0!==xPoints&&xPoints%2===1},_getImageLines:function(oCoords){return{topline:{o:oCoords.tl,d:oCoords.tr},rightline:{o:oCoords.tr,d:oCoords.br},bottomline:{o:oCoords.br,d:oCoords.bl},leftline:{o:oCoords.bl,d:oCoords.tl}}},_findCrossPoints:function(point,oCoords){var b1,b2,a1,a2,xi,yi,iLine,xcount=0;for(var lineKey in oCoords)if(iLine=oCoords[lineKey],!(iLine.o.y<point.y&&iLine.d.y<point.y||iLine.o.y>=point.y&&iLine.d.y>=point.y||(iLine.o.x===iLine.d.x&&iLine.o.x>=point.x?(xi=iLine.o.x,yi=point.y):(b1=0,b2=(iLine.d.y-iLine.o.y)/(iLine.d.x-iLine.o.x),a1=point.y-b1*point.x,a2=iLine.o.y-b2*iLine.o.x,xi=-(a1-a2)/(b1-b2),yi=a1+b1*xi),xi>=point.x&&(xcount+=1),2!==xcount)))break;return xcount},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var xCoords=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],minX=fabric.util.array.min(xCoords),maxX=fabric.util.array.max(xCoords),width=Math.abs(minX-maxX),yCoords=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],minY=fabric.util.array.min(yCoords),maxY=fabric.util.array.max(yCoords),height=Math.abs(minY-maxY);return{left:minX,top:minY,width:width,height:height}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(value){return Math.abs(value)<this.minScaleLimit?0>value?-this.minScaleLimit:this.minScaleLimit:value},scale:function(value){return value=this._constrainScale(value),0>value&&(this.flipX=!this.flipX,this.flipY=!this.flipY,value*=-1),this.scaleX=value,this.scaleY=value,this.setCoords(),this},scaleToWidth:function(value){var boundingRectFactor=this.getBoundingRectWidth()/this.getWidth();return this.scale(value/this.width/boundingRectFactor)},scaleToHeight:function(value){var boundingRectFactor=this.getBoundingRectHeight()/this.getHeight();return this.scale(value/this.height/boundingRectFactor)},setCoords:function(){var strokeWidth=this.strokeWidth>1?this.strokeWidth:0,padding=this.padding,theta=degreesToRadians(this.angle);this.currentWidth=(this.width+strokeWidth)*this.scaleX+2*padding,this.currentHeight=(this.height+strokeWidth)*this.scaleY+2*padding,this.currentWidth<0&&(this.currentWidth=Math.abs(this.currentWidth));var _hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2)),_angle=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0),offsetX=Math.cos(_angle+theta)*_hypotenuse,offsetY=Math.sin(_angle+theta)*_hypotenuse,sinTh=Math.sin(theta),cosTh=Math.cos(theta),coords=this.getCenterPoint(),tl={x:coords.x-offsetX,y:coords.y-offsetY},tr={x:tl.x+this.currentWidth*cosTh,y:tl.y+this.currentWidth*sinTh},br={x:tr.x-this.currentHeight*sinTh,y:tr.y+this.currentHeight*cosTh},bl={x:tl.x-this.currentHeight*sinTh,y:tl.y+this.currentHeight*cosTh},ml={x:tl.x-this.currentHeight/2*sinTh,y:tl.y+this.currentHeight/2*cosTh},mt={x:tl.x+this.currentWidth/2*cosTh,y:tl.y+this.currentWidth/2*sinTh},mr={x:tr.x-this.currentHeight/2*sinTh,y:tr.y+this.currentHeight/2*cosTh},mb={x:bl.x+this.currentWidth/2*cosTh,y:bl.y+this.currentWidth/2*sinTh},mtr={x:mt.x,y:mt.y};return this.oCoords={tl:tl,tr:tr,br:br,bl:bl,ml:ml,mt:mt,mr:mr,mb:mb,mtr:mtr},this._setCornerCoords&&this._setCornerCoords(),this}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(intersecting){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,intersecting):this.canvas.sendBackwards(this,intersecting),this},bringForward:function(intersecting){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,intersecting):this.canvas.bringForward(this,intersecting),this},moveTo:function(index){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,index):this.canvas.moveTo(this,index),this}}),fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var fill=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",stroke=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",strokeWidth=this.strokeWidth?this.strokeWidth:"0",strokeDashArray=this.strokeDashArray?this.strokeDashArray.join(" "):"",strokeLineCap=this.strokeLineCap?this.strokeLineCap:"butt",strokeLineJoin=this.strokeLineJoin?this.strokeLineJoin:"miter",strokeMiterLimit=this.strokeMiterLimit?this.strokeMiterLimit:"4",opacity="undefined"!=typeof this.opacity?this.opacity:"1",visibility=this.visible?"":" visibility: hidden;",filter=this.shadow&&"text"!==this.type?"filter: url(#SVGID_"+this.shadow.id+");":"";return["stroke: ",stroke,"; ","stroke-width: ",strokeWidth,"; ","stroke-dasharray: ",strokeDashArray,"; ","stroke-linecap: ",strokeLineCap,"; ","stroke-linejoin: ",strokeLineJoin,"; ","stroke-miterlimit: ",strokeMiterLimit,"; ","fill: ",fill,"; ","opacity: ",opacity,";",filter,visibility].join("")},getSvgTransform:function(){var toFixed=fabric.util.toFixed,angle=this.getAngle(),center=this.getCenterPoint(),NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,translatePart="translate("+toFixed(center.x,NUM_FRACTION_DIGITS)+" "+toFixed(center.y,NUM_FRACTION_DIGITS)+")",anglePart=0!==angle?" rotate("+toFixed(angle,NUM_FRACTION_DIGITS)+")":"",scalePart=1===this.scaleX&&1===this.scaleY?"":" scale("+toFixed(this.scaleX,NUM_FRACTION_DIGITS)+" "+toFixed(this.scaleY,NUM_FRACTION_DIGITS)+")",flipXPart=this.flipX?"matrix(-1 0 0 1 0 0) ":"",flipYPart=this.flipY?"matrix(1 0 0 -1 0 0)":"";return[translatePart,anglePart,scalePart,flipXPart,flipYPart].join("")},_createBaseSVGMarkup:function(){var markup=[];return this.fill&&this.fill.toLive&&markup.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&markup.push(this.stroke.toSVG(this,!1)),this.shadow&&markup.push(this.shadow.toSVG(this)),markup}}),fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(prop){return this.get(prop)!==this.originalState[prop]},this)},saveState:function(options){return this.stateProperties.forEach(function(prop){this.originalState[prop]=this.get(prop)},this),options&&options.stateProperties&&options.stateProperties.forEach(function(prop){this.originalState[prop]=this.get(prop)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}}),function(){var getPointer=fabric.util.getPointer,degreesToRadians=fabric.util.degreesToRadians,isVML="undefined"!=typeof G_vmlCanvasManager;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(e,offset){if(!this.hasControls||!this.active)return!1;var xPoints,lines,pointer=getPointer(e,this.canvas.upperCanvasEl),ex=pointer.x-offset.left,ey=pointer.y-offset.top;for(var i in this.oCoords)if(this.isControlVisible(i)&&("mtr"!==i||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==i&&"mr"!==i&&"mb"!==i&&"ml"!==i)&&(lines=this._getImageLines(this.oCoords[i].corner),xPoints=this._findCrossPoints({x:ex,y:ey},lines),0!==xPoints&&xPoints%2===1))return this.__corner=i,i;return!1},_setCornerCoords:function(){var coords=this.oCoords,theta=degreesToRadians(this.angle),newTheta=degreesToRadians(45-this.angle),cornerHypotenuse=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,cosHalfOffset=cornerHypotenuse*Math.cos(newTheta),sinHalfOffset=cornerHypotenuse*Math.sin(newTheta),sinTh=Math.sin(theta),cosTh=Math.cos(theta);coords.tl.corner={tl:{x:coords.tl.x-sinHalfOffset,y:coords.tl.y-cosHalfOffset},tr:{x:coords.tl.x+cosHalfOffset,y:coords.tl.y-sinHalfOffset},bl:{x:coords.tl.x-cosHalfOffset,y:coords.tl.y+sinHalfOffset},br:{x:coords.tl.x+sinHalfOffset,y:coords.tl.y+cosHalfOffset}},coords.tr.corner={tl:{x:coords.tr.x-sinHalfOffset,y:coords.tr.y-cosHalfOffset},tr:{x:coords.tr.x+cosHalfOffset,y:coords.tr.y-sinHalfOffset},br:{x:coords.tr.x+sinHalfOffset,y:coords.tr.y+cosHalfOffset},bl:{x:coords.tr.x-cosHalfOffset,y:coords.tr.y+sinHalfOffset}},coords.bl.corner={tl:{x:coords.bl.x-sinHalfOffset,y:coords.bl.y-cosHalfOffset},bl:{x:coords.bl.x-cosHalfOffset,y:coords.bl.y+sinHalfOffset},br:{x:coords.bl.x+sinHalfOffset,y:coords.bl.y+cosHalfOffset},tr:{x:coords.bl.x+cosHalfOffset,y:coords.bl.y-sinHalfOffset}},coords.br.corner={tr:{x:coords.br.x+cosHalfOffset,y:coords.br.y-sinHalfOffset},bl:{x:coords.br.x-cosHalfOffset,y:coords.br.y+sinHalfOffset},br:{x:coords.br.x+sinHalfOffset,y:coords.br.y+cosHalfOffset},tl:{x:coords.br.x-sinHalfOffset,y:coords.br.y-cosHalfOffset}},coords.ml.corner={tl:{x:coords.ml.x-sinHalfOffset,y:coords.ml.y-cosHalfOffset},tr:{x:coords.ml.x+cosHalfOffset,y:coords.ml.y-sinHalfOffset},bl:{x:coords.ml.x-cosHalfOffset,y:coords.ml.y+sinHalfOffset},br:{x:coords.ml.x+sinHalfOffset,y:coords.ml.y+cosHalfOffset}},coords.mt.corner={tl:{x:coords.mt.x-sinHalfOffset,y:coords.mt.y-cosHalfOffset},tr:{x:coords.mt.x+cosHalfOffset,y:coords.mt.y-sinHalfOffset},bl:{x:coords.mt.x-cosHalfOffset,y:coords.mt.y+sinHalfOffset},br:{x:coords.mt.x+sinHalfOffset,y:coords.mt.y+cosHalfOffset}},coords.mr.corner={tl:{x:coords.mr.x-sinHalfOffset,y:coords.mr.y-cosHalfOffset},tr:{x:coords.mr.x+cosHalfOffset,y:coords.mr.y-sinHalfOffset},bl:{x:coords.mr.x-cosHalfOffset,y:coords.mr.y+sinHalfOffset},br:{x:coords.mr.x+sinHalfOffset,y:coords.mr.y+cosHalfOffset}},coords.mb.corner={tl:{x:coords.mb.x-sinHalfOffset,y:coords.mb.y-cosHalfOffset},tr:{x:coords.mb.x+cosHalfOffset,y:coords.mb.y-sinHalfOffset},bl:{x:coords.mb.x-cosHalfOffset,y:coords.mb.y+sinHalfOffset},br:{x:coords.mb.x+sinHalfOffset,y:coords.mb.y+cosHalfOffset}},coords.mtr.corner={tl:{x:coords.mtr.x-sinHalfOffset+sinTh*this.rotatingPointOffset,y:coords.mtr.y-cosHalfOffset-cosTh*this.rotatingPointOffset},tr:{x:coords.mtr.x+cosHalfOffset+sinTh*this.rotatingPointOffset,y:coords.mtr.y-sinHalfOffset-cosTh*this.rotatingPointOffset},bl:{x:coords.mtr.x-cosHalfOffset+sinTh*this.rotatingPointOffset,y:coords.mtr.y+sinHalfOffset-cosTh*this.rotatingPointOffset},br:{x:coords.mtr.x+sinHalfOffset+sinTh*this.rotatingPointOffset,y:coords.mtr.y+cosHalfOffset-cosTh*this.rotatingPointOffset}}},drawBorders:function(ctx){if(!this.hasBorders)return this;var padding=this.padding,padding2=2*padding,strokeWidth=2*~~(this.strokeWidth/2);ctx.save(),ctx.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,ctx.strokeStyle=this.borderColor;var scaleX=1/this._constrainScale(this.scaleX),scaleY=1/this._constrainScale(this.scaleY);ctx.lineWidth=1/this.borderScaleFactor,ctx.scale(scaleX,scaleY);var w=this.getWidth(),h=this.getHeight();if(ctx.strokeRect(~~(-(w/2)-padding-strokeWidth/2*this.scaleX)-.5,~~(-(h/2)-padding-strokeWidth/2*this.scaleY)-.5,~~(w+padding2+strokeWidth*this.scaleX)+1,~~(h+padding2+strokeWidth*this.scaleY)+1),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var rotateHeight=(this.flipY?h+strokeWidth*this.scaleY+2*padding:-h-strokeWidth*this.scaleY-2*padding)/2;ctx.beginPath(),ctx.moveTo(0,rotateHeight),ctx.lineTo(0,rotateHeight+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),ctx.closePath(),ctx.stroke()}return ctx.restore(),this},drawControls:function(ctx){if(!this.hasControls)return this;var size=this.cornerSize,size2=size/2,strokeWidth2=~~(this.strokeWidth/2),left=-(this.width/2),top=-(this.height/2),paddingX=this.padding/this.scaleX,paddingY=this.padding/this.scaleY,scaleOffsetY=size2/this.scaleY,scaleOffsetX=size2/this.scaleX,scaleOffsetSizeX=(size2-size)/this.scaleX,scaleOffsetSizeY=(size2-size)/this.scaleY,height=this.height,width=this.width,methodName=this.transparentCorners?"strokeRect":"fillRect";return ctx.save(),ctx.lineWidth=1/Math.max(this.scaleX,this.scaleY),ctx.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,ctx.strokeStyle=ctx.fillStyle=this.cornerColor,this._drawControl("tl",ctx,methodName,left-scaleOffsetX-strokeWidth2-paddingX,top-scaleOffsetY-strokeWidth2-paddingY),this._drawControl("tr",ctx,methodName,left+width-scaleOffsetX+strokeWidth2+paddingX,top-scaleOffsetY-strokeWidth2-paddingY),this._drawControl("tr",ctx,methodName,left-scaleOffsetX-strokeWidth2-paddingX,top+height+scaleOffsetSizeY+strokeWidth2+paddingY),this._drawControl("br",ctx,methodName,left+width+scaleOffsetSizeX+strokeWidth2+paddingX,top+height+scaleOffsetSizeY+strokeWidth2+paddingY),this.get("lockUniScaling")||(this._drawControl("mt",ctx,methodName,left+width/2-scaleOffsetX,top-scaleOffsetY-strokeWidth2-paddingY),this._drawControl("mb",ctx,methodName,left+width/2-scaleOffsetX,top+height+scaleOffsetSizeY+strokeWidth2+paddingY),this._drawControl("mb",ctx,methodName,left+width+scaleOffsetSizeX+strokeWidth2+paddingX,top+height/2-scaleOffsetY),this._drawControl("ml",ctx,methodName,left-scaleOffsetX-strokeWidth2-paddingX,top+height/2-scaleOffsetY)),this.hasRotatingPoint&&this._drawControl("mtr",ctx,methodName,left+width/2-scaleOffsetX,this.flipY?top+height+this.rotatingPointOffset/this.scaleY-this.cornerSize/this.scaleX/2+strokeWidth2+paddingY:top-this.rotatingPointOffset/this.scaleY-this.cornerSize/this.scaleY/2-strokeWidth2-paddingY),ctx.restore(),this},_drawControl:function(control,ctx,methodName,left,top){var sizeX=this.cornerSize/this.scaleX,sizeY=this.cornerSize/this.scaleY;this.isControlVisible(control)&&(isVML||this.transparentCorners||ctx.clearRect(left,top,sizeX,sizeY),ctx[methodName](left,top,sizeX,sizeY))},isControlVisible:function(controlName){return this._getControlsVisibility()[controlName]},setControlVisible:function(controlName,visible){return this._getControlsVisibility()[controlName]=visible,this},setControlsVisibility:function(options){options||(options={});for(var p in options)this.setControlVisible(p,options[p]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;return fabric.util.animate({startValue:object.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(value){object.set("left",value),_this.renderAll(),onChange()},onComplete:function(){object.setCoords(),onComplete()}}),this},fxCenterObjectV:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;return fabric.util.animate({startValue:object.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(value){object.set("top",value),_this.renderAll(),onChange()},onComplete:function(){object.setCoords(),onComplete()}}),this},fxRemove:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;return fabric.util.animate({startValue:object.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){object.set("active",!1)},onChange:function(value){object.set("opacity",value),_this.renderAll(),onChange()},onComplete:function(){_this.remove(object),onComplete()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var prop,skipCallbacks,propsToAnimate=[];for(prop in arguments[0])propsToAnimate.push(prop);for(var i=0,len=propsToAnimate.length;len>i;i++)prop=propsToAnimate[i],skipCallbacks=i!==len-1,this._animate(prop,arguments[0][prop],arguments[1],skipCallbacks)}else this._animate.apply(this,arguments);return this},_animate:function(property,to,options,skipCallbacks){var propPair,obj=this;to=to.toString(),options=options?fabric.util.object.clone(options):{},~property.indexOf(".")&&(propPair=property.split("."));var currentValue=propPair?this.get(propPair[0])[propPair[1]]:this.get(property);"from"in options||(options.from=currentValue),to=~to.indexOf("=")?currentValue+parseFloat(to.replace("=","")):parseFloat(to),fabric.util.animate({startValue:options.from,endValue:to,byValue:options.by,easing:options.easing,duration:options.duration,abort:options.abort&&function(){return options.abort.call(obj)},onChange:function(value){propPair?obj[propPair[0]][propPair[1]]=value:obj.set(property,value),skipCallbacks||options.onChange&&options.onChange()},onComplete:function(){skipCallbacks||(obj.setCoords(),options.onComplete&&options.onComplete())}})}}),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,coordProps={x1:1,x2:1,y1:1,y2:1},supportsLineDash=fabric.StaticCanvas.supports("setLineDash");return fabric.Line?void fabric.warn("fabric.Line is already defined"):(fabric.Line=fabric.util.createClass(fabric.Object,{type:"line",initialize:function(points,options){options=options||{},points||(points=[0,0,0,0]),this.callSuper("initialize",options),this.set("x1",points[0]),this.set("y1",points[1]),this.set("x2",points[2]),this.set("y2",points[3]),this._setWidthHeight(options)},_setWidthHeight:function(options){options||(options={}),this.set("width",Math.abs(this.x2-this.x1)||1),this.set("height",Math.abs(this.y2-this.y1)||1),this.set("left","left"in options?options.left:Math.min(this.x1,this.x2)+this.width/2),this.set("top","top"in options?options.top:Math.min(this.y1,this.y2)+this.height/2)},_set:function(key,value){return this[key]=value,key in coordProps&&this._setWidthHeight(),this},_render:function(ctx){ctx.beginPath();var isInPathGroup=this.group&&"path-group"===this.group.type;if(isInPathGroup&&!this.transformMatrix&&ctx.translate(-this.group.width/2+this.left,-this.group.height/2+this.top),!this.strokeDashArray||this.strokeDashArray&&supportsLineDash){var xMult=this.x1<=this.x2?-1:1,yMult=this.y1<=this.y2?-1:1;ctx.moveTo(1===this.width?0:xMult*this.width/2,1===this.height?0:yMult*this.height/2),ctx.lineTo(1===this.width?0:-1*xMult*this.width/2,1===this.height?0:-1*yMult*this.height/2)}ctx.lineWidth=this.strokeWidth;var origStrokeStyle=ctx.strokeStyle;ctx.strokeStyle=this.stroke||ctx.fillStyle,this._renderStroke(ctx),ctx.strokeStyle=origStrokeStyle},_renderDashedStroke:function(ctx){var xMult=this.x1<=this.x2?-1:1,yMult=this.y1<=this.y2?-1:1,x=1===this.width?0:xMult*this.width/2,y=1===this.height?0:yMult*this.height/2;ctx.beginPath(),fabric.util.drawDashedLine(ctx,x,y,-x,-y,this.strokeDashArray),ctx.closePath()},toObject:function(propertiesToInclude){return extend(this.callSuper("toObject",propertiesToInclude),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(reviver){var markup=this._createBaseSVGMarkup();return markup.push("<line ",'x1="',this.get("x1"),'" y1="',this.get("y1"),'" x2="',this.get("x2"),'" y2="',this.get("y2"),'" style="',this.getSvgStyles(),'"/>'),reviver?reviver(markup.join("")):markup.join("")},complexity:function(){return 1}}),fabric.Line.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),fabric.Line.fromElement=function(element,options){var parsedAttributes=fabric.parseAttributes(element,fabric.Line.ATTRIBUTE_NAMES),points=[parsedAttributes.x1||0,parsedAttributes.y1||0,parsedAttributes.x2||0,parsedAttributes.y2||0];return new fabric.Line(points,extend(parsedAttributes,options))},void(fabric.Line.fromObject=function(object){var points=[object.x1,object.y1,object.x2,object.y2];return new fabric.Line(points,object)}))}("undefined"!=typeof exports?exports:this),function(global){"use strict";function isValidRadius(attributes){return"radius"in attributes&&attributes.radius>0}var fabric=global.fabric||(global.fabric={}),piBy2=2*Math.PI,extend=fabric.util.object.extend;return fabric.Circle?void fabric.warn("fabric.Circle is already defined."):(fabric.Circle=fabric.util.createClass(fabric.Object,{type:"circle",initialize:function(options){options=options||{},this.set("radius",options.radius||0),this.callSuper("initialize",options)},_set:function(key,value){return this.callSuper("_set",key,value),"radius"===key&&this.setRadius(value),this},toObject:function(propertiesToInclude){return extend(this.callSuper("toObject",propertiesToInclude),{radius:this.get("radius")})},toSVG:function(reviver){var markup=this._createBaseSVGMarkup();return markup.push("<circle ",'cx="0" cy="0" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),reviver?reviver(markup.join("")):markup.join("")},_render:function(ctx,noTransform){ctx.beginPath(),ctx.globalAlpha=this.group?ctx.globalAlpha*this.opacity:this.opacity,ctx.arc(noTransform?this.left:0,noTransform?this.top:0,this.radius,0,piBy2,!1),ctx.closePath(),this._renderFill(ctx),this._renderStroke(ctx)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")
},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(value){this.radius=value,this.set("width",2*value).set("height",2*value)},complexity:function(){return 1}}),fabric.Circle.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),fabric.Circle.fromElement=function(element,options){options||(options={});var parsedAttributes=fabric.parseAttributes(element,fabric.Circle.ATTRIBUTE_NAMES);if(!isValidRadius(parsedAttributes))throw new Error("value of `r` attribute is required and can not be negative");"left"in parsedAttributes&&(parsedAttributes.left-=options.width/2||0),"top"in parsedAttributes&&(parsedAttributes.top-=options.height/2||0);var obj=new fabric.Circle(extend(parsedAttributes,options));return obj.cx=parseFloat(element.getAttribute("cx"))||0,obj.cy=parseFloat(element.getAttribute("cy"))||0,obj},void(fabric.Circle.fromObject=function(object){return new fabric.Circle(object)}))}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={});return fabric.Triangle?void fabric.warn("fabric.Triangle is already defined"):(fabric.Triangle=fabric.util.createClass(fabric.Object,{type:"triangle",initialize:function(options){options=options||{},this.callSuper("initialize",options),this.set("width",options.width||100).set("height",options.height||100)},_render:function(ctx){var widthBy2=this.width/2,heightBy2=this.height/2;ctx.beginPath(),ctx.moveTo(-widthBy2,heightBy2),ctx.lineTo(0,-heightBy2),ctx.lineTo(widthBy2,heightBy2),ctx.closePath(),this._renderFill(ctx),this._renderStroke(ctx)},_renderDashedStroke:function(ctx){var widthBy2=this.width/2,heightBy2=this.height/2;ctx.beginPath(),fabric.util.drawDashedLine(ctx,-widthBy2,heightBy2,0,-heightBy2,this.strokeDashArray),fabric.util.drawDashedLine(ctx,0,-heightBy2,widthBy2,heightBy2,this.strokeDashArray),fabric.util.drawDashedLine(ctx,widthBy2,heightBy2,-widthBy2,heightBy2,this.strokeDashArray),ctx.closePath()},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),widthBy2=this.width/2,heightBy2=this.height/2,points=[-widthBy2+" "+heightBy2,"0 "+-heightBy2,widthBy2+" "+heightBy2].join(",");return markup.push("<polygon ",'points="',points,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),reviver?reviver(markup.join("")):markup.join("")},complexity:function(){return 1}}),void(fabric.Triangle.fromObject=function(object){return new fabric.Triangle(object)}))}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),piBy2=2*Math.PI,extend=fabric.util.object.extend;return fabric.Ellipse?void fabric.warn("fabric.Ellipse is already defined."):(fabric.Ellipse=fabric.util.createClass(fabric.Object,{type:"ellipse",rx:0,ry:0,initialize:function(options){options=options||{},this.callSuper("initialize",options),this.set("rx",options.rx||0),this.set("ry",options.ry||0),this.set("width",2*this.get("rx")),this.set("height",2*this.get("ry"))},toObject:function(propertiesToInclude){return extend(this.callSuper("toObject",propertiesToInclude),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(reviver){var markup=this._createBaseSVGMarkup();return markup.push("<ellipse ",'rx="',this.get("rx"),'" ry="',this.get("ry"),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),reviver?reviver(markup.join("")):markup.join("")},render:function(ctx,noTransform){return 0!==this.rx&&0!==this.ry?this.callSuper("render",ctx,noTransform):void 0},_render:function(ctx,noTransform){ctx.beginPath(),ctx.save(),ctx.globalAlpha=this.group?ctx.globalAlpha*this.opacity:this.opacity,this.transformMatrix&&this.group&&ctx.translate(this.cx,this.cy),ctx.transform(1,0,0,this.ry/this.rx,0,0),ctx.arc(noTransform?this.left:0,noTransform?this.top:0,this.rx,0,piBy2,!1),this._renderFill(ctx),this._renderStroke(ctx),ctx.restore()},complexity:function(){return 1}}),fabric.Ellipse.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),fabric.Ellipse.fromElement=function(element,options){options||(options={});var parsedAttributes=fabric.parseAttributes(element,fabric.Ellipse.ATTRIBUTE_NAMES),cx=parsedAttributes.left,cy=parsedAttributes.top;"left"in parsedAttributes&&(parsedAttributes.left-=options.width/2||0),"top"in parsedAttributes&&(parsedAttributes.top-=options.height/2||0);var ellipse=new fabric.Ellipse(extend(parsedAttributes,options));return ellipse.cx=cx||0,ellipse.cy=cy||0,ellipse},void(fabric.Ellipse.fromObject=function(object){return new fabric.Ellipse(object)}))}("undefined"!=typeof exports?exports:this),function(global){"use strict";function _setDefaultLeftTopValues(attributes){return attributes.left=attributes.left||0,attributes.top=attributes.top||0,attributes}var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;if(fabric.Rect)return void console.warn("fabric.Rect is already defined");var stateProperties=fabric.Object.prototype.stateProperties.concat();stateProperties.push("rx","ry","x","y"),fabric.Rect=fabric.util.createClass(fabric.Object,{stateProperties:stateProperties,type:"rect",rx:0,ry:0,x:0,y:0,strokeDashArray:null,initialize:function(options){options=options||{},this.callSuper("initialize",options),this._initRxRy(),this.x=options.x||0,this.y=options.y||0},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(ctx){var rx=this.rx||0,ry=this.ry||0,x=-this.width/2,y=-this.height/2,w=this.width,h=this.height,isInPathGroup=this.group&&"path-group"===this.group.type;ctx.beginPath(),ctx.globalAlpha=isInPathGroup?ctx.globalAlpha*this.opacity:this.opacity,this.transformMatrix&&isInPathGroup&&ctx.translate(this.width/2+this.x,this.height/2+this.y),!this.transformMatrix&&isInPathGroup&&ctx.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y);var isRounded=0!==rx||0!==ry;ctx.moveTo(x+rx,y),ctx.lineTo(x+w-rx,y),isRounded&&ctx.quadraticCurveTo(x+w,y,x+w,y+ry,x+w,y+ry),ctx.lineTo(x+w,y+h-ry),isRounded&&ctx.quadraticCurveTo(x+w,y+h,x+w-rx,y+h,x+w-rx,y+h),ctx.lineTo(x+rx,y+h),isRounded&&ctx.quadraticCurveTo(x,y+h,x,y+h-ry,x,y+h-ry),ctx.lineTo(x,y+ry),isRounded&&ctx.quadraticCurveTo(x,y,x+rx,y,x+rx,y),ctx.closePath(),this._renderFill(ctx),this._renderStroke(ctx)},_renderDashedStroke:function(ctx){var x=-this.width/2,y=-this.height/2,w=this.width,h=this.height;ctx.beginPath(),fabric.util.drawDashedLine(ctx,x,y,x+w,y,this.strokeDashArray),fabric.util.drawDashedLine(ctx,x+w,y,x+w,y+h,this.strokeDashArray),fabric.util.drawDashedLine(ctx,x+w,y+h,x,y+h,this.strokeDashArray),fabric.util.drawDashedLine(ctx,x,y+h,x,y,this.strokeDashArray),ctx.closePath()},_normalizeLeftTopProperties:function(parsedAttributes){return"left"in parsedAttributes&&this.set("left",parsedAttributes.left+this.getWidth()/2),this.set("x",parsedAttributes.left||0),"top"in parsedAttributes&&this.set("top",parsedAttributes.top+this.getHeight()/2),this.set("y",parsedAttributes.top||0),this},toObject:function(propertiesToInclude){var object=extend(this.callSuper("toObject",propertiesToInclude),{rx:this.get("rx")||0,ry:this.get("ry")||0,x:this.get("x"),y:this.get("y")});return this.includeDefaultValues||this._removeDefaultValues(object),object},toSVG:function(reviver){var markup=this._createBaseSVGMarkup();return markup.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),reviver?reviver(markup.join("")):markup.join("")},complexity:function(){return 1}}),fabric.Rect.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),fabric.Rect.fromElement=function(element,options){if(!element)return null;var parsedAttributes=fabric.parseAttributes(element,fabric.Rect.ATTRIBUTE_NAMES);parsedAttributes=_setDefaultLeftTopValues(parsedAttributes);var rect=new fabric.Rect(extend(options?fabric.util.object.clone(options):{},parsedAttributes));return rect._normalizeLeftTopProperties(parsedAttributes),rect},fabric.Rect.fromObject=function(object){return new fabric.Rect(object)}}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),toFixed=fabric.util.toFixed;return fabric.Polyline?void fabric.warn("fabric.Polyline is already defined"):(fabric.Polyline=fabric.util.createClass(fabric.Object,{type:"polyline",initialize:function(points,options,skipOffset){options=options||{},this.set("points",points),this.callSuper("initialize",options),this._calcDimensions(skipOffset)},_calcDimensions:function(skipOffset){return fabric.Polygon.prototype._calcDimensions.call(this,skipOffset)},toObject:function(propertiesToInclude){return fabric.Polygon.prototype.toObject.call(this,propertiesToInclude)},toSVG:function(reviver){for(var points=[],markup=this._createBaseSVGMarkup(),i=0,len=this.points.length;len>i;i++)points.push(toFixed(this.points[i].x,2),",",toFixed(this.points[i].y,2)," ");return markup.push("<polyline ",'points="',points.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),reviver?reviver(markup.join("")):markup.join("")},_render:function(ctx){var point;ctx.beginPath(),ctx.moveTo(this.points[0].x,this.points[0].y);for(var i=0,len=this.points.length;len>i;i++)point=this.points[i],ctx.lineTo(point.x,point.y);this._renderFill(ctx),this._renderStroke(ctx)},_renderDashedStroke:function(ctx){var p1,p2;ctx.beginPath();for(var i=0,len=this.points.length;len>i;i++)p1=this.points[i],p2=this.points[i+1]||p1,fabric.util.drawDashedLine(ctx,p1.x,p1.y,p2.x,p2.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),fabric.Polyline.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(),fabric.Polyline.fromElement=function(element,options){if(!element)return null;options||(options={});var points=fabric.parsePointsAttribute(element.getAttribute("points")),parsedAttributes=fabric.parseAttributes(element,fabric.Polyline.ATTRIBUTE_NAMES);return fabric.util.normalizePoints(points,options),new fabric.Polyline(points,fabric.util.object.extend(parsedAttributes,options),!0)},void(fabric.Polyline.fromObject=function(object){var points=object.points;return new fabric.Polyline(points,object,!0)}))}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,min=fabric.util.array.min,max=fabric.util.array.max,toFixed=fabric.util.toFixed;return fabric.Polygon?void fabric.warn("fabric.Polygon is already defined"):(fabric.Polygon=fabric.util.createClass(fabric.Object,{type:"polygon",initialize:function(points,options,skipOffset){options=options||{},this.points=points,this.callSuper("initialize",options),this._calcDimensions(skipOffset)},_calcDimensions:function(skipOffset){var points=this.points,minX=min(points,"x"),minY=min(points,"y"),maxX=max(points,"x"),maxY=max(points,"y");if(this.width=maxX-minX||1,this.height=maxY-minY||1,this.minX=minX,this.minY=minY,!skipOffset){var halfWidth=this.width/2+this.minX,halfHeight=this.height/2+this.minY;this.points.forEach(function(p){p.x-=halfWidth,p.y-=halfHeight},this)}},toObject:function(propertiesToInclude){return extend(this.callSuper("toObject",propertiesToInclude),{points:this.points.concat()})},toSVG:function(reviver){for(var points=[],markup=this._createBaseSVGMarkup(),i=0,len=this.points.length;len>i;i++)points.push(toFixed(this.points[i].x,2),",",toFixed(this.points[i].y,2)," ");return markup.push("<polygon ",'points="',points.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),reviver?reviver(markup.join("")):markup.join("")},_render:function(ctx){var point;ctx.beginPath(),ctx.moveTo(this.points[0].x,this.points[0].y);for(var i=0,len=this.points.length;len>i;i++)point=this.points[i],ctx.lineTo(point.x,point.y);this._renderFill(ctx),(this.stroke||this.strokeDashArray)&&(ctx.closePath(),this._renderStroke(ctx))},_renderDashedStroke:function(ctx){var p1,p2;ctx.beginPath();for(var i=0,len=this.points.length;len>i;i++)p1=this.points[i],p2=this.points[i+1]||this.points[0],fabric.util.drawDashedLine(ctx,p1.x,p1.y,p2.x,p2.y,this.strokeDashArray);ctx.closePath()},complexity:function(){return this.points.length}}),fabric.Polygon.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(),fabric.Polygon.fromElement=function(element,options){if(!element)return null;options||(options={});var points=fabric.parsePointsAttribute(element.getAttribute("points")),parsedAttributes=fabric.parseAttributes(element,fabric.Polygon.ATTRIBUTE_NAMES);return fabric.util.normalizePoints(points,options),new fabric.Polygon(points,extend(parsedAttributes,options),!0)},void(fabric.Polygon.fromObject=function(object){return new fabric.Polygon(object.points,object,!0)}))}("undefined"!=typeof exports?exports:this),function(global){function getX(item){return"H"===item[0]?item[1]:item[item.length-2]}function getY(item){return"V"===item[0]?item[1]:item[item.length-1]}var commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},fabric=global.fabric||(global.fabric={}),min=fabric.util.array.min,max=fabric.util.array.max,extend=fabric.util.object.extend,_toString=Object.prototype.toString,drawArc=fabric.util.drawArc;return fabric.Path?void fabric.warn("fabric.Path is already defined"):(fabric.Path=fabric.util.createClass(fabric.Object,{type:"path",initialize:function(path,options){if(options=options||{},this.setOptions(options),!path)throw new Error("`path` argument is required");var fromArray="[object Array]"===_toString.call(path);this.path=fromArray?path:path.match&&path.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(fromArray||(this.path=this._parsePath()),this._initializePath(options),options.sourcePath&&this.setSourcePath(options.sourcePath))},_initializePath:function(options){var isWidthSet="width"in options&&null!=options.width,isHeightSet="height"in options&&null!=options.width,isLeftSet="left"in options,isTopSet="top"in options,origLeft=isLeftSet?this.left:0,origTop=isTopSet?this.top:0;isWidthSet&&isHeightSet?(isTopSet||(this.top=this.height/2),isLeftSet||(this.left=this.width/2)):(extend(this,this._parseDimensions()),isWidthSet&&(this.width=options.width),isHeightSet&&(this.height=options.height)),this.pathOffset=this.pathOffset||this._calculatePathOffset(origLeft,origTop)},_calculatePathOffset:function(origLeft,origTop){return{x:this.left-origLeft-this.width/2,y:this.top-origTop-this.height/2}},_render:function(ctx){for(var current,tempX,tempY,tempControlX,tempControlY,methodName,previous=null,x=0,y=0,controlX=0,controlY=0,l=-(this.width/2+this.pathOffset.x),t=-(this.height/2+this.pathOffset.y),i=0,len=this.path.length;len>i;++i){switch(current=this.path[i],current[0]){case"l":x+=current[1],y+=current[2],ctx.lineTo(x+l,y+t);break;case"L":x=current[1],y=current[2],ctx.lineTo(x+l,y+t);break;case"h":x+=current[1],ctx.lineTo(x+l,y+t);break;case"H":x=current[1],ctx.lineTo(x+l,y+t);break;case"v":y+=current[1],ctx.lineTo(x+l,y+t);break;case"V":y=current[1],ctx.lineTo(x+l,y+t);break;case"m":x+=current[1],y+=current[2],methodName=!previous||"m"!==previous[0]&&"M"!==previous[0]?"moveTo":"lineTo",ctx[methodName](x+l,y+t);break;case"M":x=current[1],y=current[2],methodName=!previous||"m"!==previous[0]&&"M"!==previous[0]?"moveTo":"lineTo",ctx[methodName](x+l,y+t);break;case"c":tempX=x+current[5],tempY=y+current[6],controlX=x+current[3],controlY=y+current[4],ctx.bezierCurveTo(x+current[1]+l,y+current[2]+t,controlX+l,controlY+t,tempX+l,tempY+t),x=tempX,y=tempY;break;case"C":x=current[5],y=current[6],controlX=current[3],controlY=current[4],ctx.bezierCurveTo(current[1]+l,current[2]+t,controlX+l,controlY+t,x+l,y+t);break;case"s":tempX=x+current[3],tempY=y+current[4],controlX=controlX?2*x-controlX:x,controlY=controlY?2*y-controlY:y,ctx.bezierCurveTo(controlX+l,controlY+t,x+current[1]+l,y+current[2]+t,tempX+l,tempY+t),controlX=x+current[1],controlY=y+current[2],x=tempX,y=tempY;break;case"S":tempX=current[3],tempY=current[4],controlX=2*x-controlX,controlY=2*y-controlY,ctx.bezierCurveTo(controlX+l,controlY+t,current[1]+l,current[2]+t,tempX+l,tempY+t),x=tempX,y=tempY,controlX=current[1],controlY=current[2];break;case"q":tempX=x+current[3],tempY=y+current[4],controlX=x+current[1],controlY=y+current[2],ctx.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t),x=tempX,y=tempY;break;case"Q":tempX=current[3],tempY=current[4],ctx.quadraticCurveTo(current[1]+l,current[2]+t,tempX+l,tempY+t),x=tempX,y=tempY,controlX=current[1],controlY=current[2];break;case"t":tempX=x+current[1],tempY=y+current[2],null===previous[0].match(/[QqTt]/)?(controlX=x,controlY=y):"t"===previous[0]?(controlX=2*x-tempControlX,controlY=2*y-tempControlY):"q"===previous[0]&&(controlX=2*x-controlX,controlY=2*y-controlY),tempControlX=controlX,tempControlY=controlY,ctx.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t),x=tempX,y=tempY,controlX=x+current[1],controlY=y+current[2];break;case"T":tempX=current[1],tempY=current[2],controlX=2*x-controlX,controlY=2*y-controlY,ctx.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t),x=tempX,y=tempY;break;case"a":drawArc(ctx,x+l,y+t,[current[1],current[2],current[3],current[4],current[5],current[6]+x+l,current[7]+y+t]),x+=current[6],y+=current[7];break;case"A":drawArc(ctx,x+l,y+t,[current[1],current[2],current[3],current[4],current[5],current[6]+l,current[7]+t]),x=current[6],y=current[7];break;case"z":case"Z":ctx.closePath()}previous=current}},render:function(ctx,noTransform){if(this.visible){ctx.save();var m=this.transformMatrix;m&&ctx.transform(m[0],m[1],m[2],m[3],m[4],m[5]),noTransform||this.transform(ctx),this._setStrokeStyles(ctx),this._setFillStyles(ctx),this._setShadow(ctx),this.clipTo&&fabric.util.clipContext(this,ctx),ctx.beginPath(),this._render(ctx),this._renderFill(ctx),this._renderStroke(ctx),this.clipTo&&ctx.restore(),this._removeShadow(ctx),!noTransform&&this.active&&(this.drawBorders(ctx),this.drawControls(ctx)),ctx.restore()}},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(propertiesToInclude){var o=extend(this.callSuper("toObject",propertiesToInclude),{path:this.path,pathOffset:this.pathOffset});return this.sourcePath&&(o.sourcePath=this.sourcePath),this.transformMatrix&&(o.transformMatrix=this.transformMatrix),o},toDatalessObject:function(propertiesToInclude){var o=this.toObject(propertiesToInclude);return this.sourcePath&&(o.path=this.sourcePath),delete o.sourcePath,o},toSVG:function(reviver){for(var chunks=[],markup=this._createBaseSVGMarkup(),i=0,len=this.path.length;len>i;i++)chunks.push(this.path[i].join(" "));var path=chunks.join(" ");return markup.push('<g transform="',this.group?"":this.getSvgTransform(),'">',"<path ",'d="',path,'" style="',this.getSvgStyles(),'" transform="translate(',-this.width/2," ",-this.height/2,")",'" stroke-linecap="round" ',"/>","</g>"),reviver?reviver(markup.join("")):markup.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var currentPath,parsed,match,coordsStr,coordsParsed,result=[],coords=[],re=/(-?\.\d+)|(-?\d+(\.\d+)?)/g,i=0,len=this.path.length;len>i;i++){for(currentPath=this.path[i],coordsStr=currentPath.slice(1).trim(),coords.length=0;match=re.exec(coordsStr);)coords.push(match[0]);coordsParsed=[currentPath.charAt(0)];for(var j=0,jlen=coords.length;jlen>j;j++)parsed=parseFloat(coords[j]),isNaN(parsed)||coordsParsed.push(parsed);var command=coordsParsed[0].toLowerCase(),commandLength=commandLengths[command];if(coordsParsed.length-1>commandLength)for(var k=1,klen=coordsParsed.length;klen>k;k+=commandLength)result.push([coordsParsed[0]].concat(coordsParsed.slice(k,k+commandLength)));else result.push(coordsParsed)}return result},_parseDimensions:function(){var aX=[],aY=[],previous={};this.path.forEach(function(item,i){this._getCoordsFromCommand(item,i,aX,aY,previous)},this);var minX=min(aX),minY=min(aY),maxX=max(aX),maxY=max(aY),deltaX=maxX-minX,deltaY=maxY-minY,o={left:this.left+(minX+deltaX/2),top:this.top+(minY+deltaY/2),width:deltaX,height:deltaY};return o},_getCoordsFromCommand:function(item,i,aX,aY,previous){var isLowerCase=!1;"H"!==item[0]&&(previous.x=getX(0===i?item:this.path[i-1])),"V"!==item[0]&&(previous.y=getY(0===i?item:this.path[i-1])),item[0]===item[0].toLowerCase()&&(isLowerCase=!0);var xy=this._getXY(item,isLowerCase,previous),val=parseInt(xy.x,10);isNaN(val)||aX.push(val),val=parseInt(xy.y,10),isNaN(val)||aY.push(val)},_getXY:function(item,isLowerCase,previous){var x=isLowerCase?previous.x+getX(item):"V"===item[0]?previous.x:getX(item),y=isLowerCase?previous.y+getY(item):"H"===item[0]?previous.y:getY(item);return{x:x,y:y}}}),fabric.Path.fromObject=function(object,callback){"string"==typeof object.path?fabric.loadSVGFromURL(object.path,function(elements){var path=elements[0],pathUrl=object.path;delete object.path,fabric.util.object.extend(path,object),path.setSourcePath(pathUrl),callback(path)}):callback(new fabric.Path(object.path,object))},fabric.Path.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(["d"]),fabric.Path.fromElement=function(element,callback,options){var parsedAttributes=fabric.parseAttributes(element,fabric.Path.ATTRIBUTE_NAMES);callback&&callback(new fabric.Path(parsedAttributes.d,extend(parsedAttributes,options)))},void(fabric.Path.async=!0))}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,invoke=fabric.util.array.invoke,parentToObject=fabric.Object.prototype.toObject;return fabric.PathGroup?void fabric.warn("fabric.PathGroup is already defined"):(fabric.PathGroup=fabric.util.createClass(fabric.Path,{type:"path-group",fill:"",initialize:function(paths,options){options=options||{},this.paths=paths||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;this.setOptions(options),this.setCoords(),options.sourcePath&&this.setSourcePath(options.sourcePath)},render:function(ctx){if(this.visible){ctx.save();var m=this.transformMatrix;m&&ctx.transform(m[0],m[1],m[2],m[3],m[4],m[5]),this.transform(ctx),this._setShadow(ctx),this.clipTo&&fabric.util.clipContext(this,ctx);for(var i=0,l=this.paths.length;l>i;++i)this.paths[i].render(ctx,!0);this.clipTo&&ctx.restore(),this._removeShadow(ctx),this.active&&(this.drawBorders(ctx),this.drawControls(ctx)),ctx.restore()}},_set:function(prop,value){if("fill"===prop&&value&&this.isSameColor())for(var i=this.paths.length;i--;)this.paths[i]._set(prop,value);return this.callSuper("_set",prop,value)},toObject:function(propertiesToInclude){var o=extend(parentToObject.call(this,propertiesToInclude),{paths:invoke(this.getObjects(),"toObject",propertiesToInclude)});return this.sourcePath&&(o.sourcePath=this.sourcePath),o},toDatalessObject:function(propertiesToInclude){var o=this.toObject(propertiesToInclude);return this.sourcePath&&(o.paths=this.sourcePath),o},toSVG:function(reviver){for(var objects=this.getObjects(),markup=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"],i=0,len=objects.length;len>i;i++)markup.push(objects[i].toSVG(reviver));return markup.push("</g>"),reviver?reviver(markup.join("")):markup.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var firstPathFill=this.getObjects()[0].get("fill");return this.getObjects().every(function(path){return path.get("fill")===firstPathFill})},complexity:function(){return this.paths.reduce(function(total,path){return total+(path&&path.complexity?path.complexity():0)},0)},getObjects:function(){return this.paths}}),fabric.PathGroup.fromObject=function(object,callback){"string"==typeof object.paths?fabric.loadSVGFromURL(object.paths,function(elements){var pathUrl=object.paths;delete object.paths;var pathGroup=fabric.util.groupSVGElements(elements,object,pathUrl);callback(pathGroup)}):fabric.util.enlivenObjects(object.paths,function(enlivenedObjects){delete object.paths,callback(new fabric.PathGroup(enlivenedObjects,object))})},void(fabric.PathGroup.async=!0))}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,min=fabric.util.array.min,max=fabric.util.array.max,invoke=fabric.util.array.invoke;if(!fabric.Group){var _lockProperties={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};fabric.Group=fabric.util.createClass(fabric.Object,fabric.Collection,{type:"group",initialize:function(objects,options){options=options||{},this._objects=objects||[];for(var i=this._objects.length;i--;)this._objects[i].group=this;this.originalState={},this.callSuper("initialize"),this._calcBounds(),this._updateObjectsCoords(),options&&extend(this,options),this._setOpacityIfSame(),this.setCoords(!0),this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(object){var objectLeft=object.getLeft(),objectTop=object.getTop();object.set({originalLeft:objectLeft,originalTop:objectTop,left:objectLeft-this.left,top:objectTop-this.top}),object.setCoords(),object.__origHasControls=object.hasControls,object.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(object){return this._restoreObjectsState(),this._objects.push(object),object.group=this,this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(object){object.set("active",!0),object.group=this},removeWithUpdate:function(object){return this._moveFlippedObject(object),this._restoreObjectsState(),this.forEachObject(this._setObjectActive,this),this.remove(object),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(object){object.group=this},_onObjectRemoved:function(object){delete object.group,object.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(key,value){if(key in this.delegatedProperties){var i=this._objects.length;for(this[key]=value;i--;)this._objects[i].set(key,value)}else this[key]=value},toObject:function(propertiesToInclude){return extend(this.callSuper("toObject",propertiesToInclude),{objects:invoke(this._objects,"toObject",propertiesToInclude)})},render:function(ctx,noTransform){if(this.visible){ctx.save(),this.transform(ctx),this.clipTo&&fabric.util.clipContext(this,ctx);for(var i=0,len=this._objects.length;len>i;i++)this._renderObject(this._objects[i],ctx);this.clipTo&&ctx.restore(),!noTransform&&this.active&&(this.drawBorders(ctx),this.drawControls(ctx)),ctx.restore()}},_renderObject:function(object,ctx){var originalScaleFactor=object.borderScaleFactor,originalHasRotatingPoint=object.hasRotatingPoint,groupScaleFactor=Math.max(this.scaleX,this.scaleY);object.visible&&(object.borderScaleFactor=groupScaleFactor,object.hasRotatingPoint=!1,object.render(ctx),object.borderScaleFactor=originalScaleFactor,object.hasRotatingPoint=originalHasRotatingPoint)},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},_moveFlippedObject:function(object){var oldOriginX=object.get("originX"),oldOriginY=object.get("originY"),center=object.getCenterPoint();object.set({originX:"center",originY:"center",left:center.x,top:center.y}),this._toggleFlipping(object);var newOrigin=object.getPointByOrigin(oldOriginX,oldOriginY);return object.set({originX:oldOriginX,originY:oldOriginY,left:newOrigin.x,top:newOrigin.y}),this},_toggleFlipping:function(object){this.flipX&&(object.toggle("flipX"),object.set("left",-object.get("left")),object.setAngle(-object.getAngle())),this.flipY&&(object.toggle("flipY"),object.set("top",-object.get("top")),object.setAngle(-object.getAngle()))},_restoreObjectState:function(object){return this._setObjectPosition(object),object.setCoords(),object.hasControls=object.__origHasControls,delete object.__origHasControls,object.set("active",!1),object.setCoords(),delete object.group,this},_setObjectPosition:function(object){var groupLeft=this.getLeft(),groupTop=this.getTop(),rotated=this._getRotatedLeftTop(object);object.set({angle:object.getAngle()+this.getAngle(),left:groupLeft+rotated.left,top:groupTop+rotated.top,scaleX:object.get("scaleX")*this.get("scaleX"),scaleY:object.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(object){var groupAngle=this.getAngle()*(Math.PI/180);return{left:-Math.sin(groupAngle)*object.getTop()*this.get("scaleY")+Math.cos(groupAngle)*object.getLeft()*this.get("scaleX"),top:Math.cos(groupAngle)*object.getTop()*this.get("scaleY")+Math.sin(groupAngle)*object.getLeft()*this.get("scaleX")}},destroy:function(){return this._objects.forEach(this._moveFlippedObject,this),this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(object){object.setCoords()}),this},_setOpacityIfSame:function(){var objects=this.getObjects(),firstValue=objects[0]?objects[0].get("opacity"):1,isSameOpacity=objects.every(function(o){return o.get("opacity")===firstValue});isSameOpacity&&(this.opacity=firstValue)},_calcBounds:function(){for(var o,aX=[],aY=[],i=0,len=this._objects.length;len>i;++i){o=this._objects[i],o.setCoords();for(var prop in o.oCoords)aX.push(o.oCoords[prop].x),aY.push(o.oCoords[prop].y)}this.set(this._getBounds(aX,aY))},_getBounds:function(aX,aY){var minX=min(aX),maxX=max(aX),minY=min(aY),maxY=max(aY),width=maxX-minX||0,height=maxY-minY||0;return{width:width,height:height,left:minX+width/2||0,top:minY+height/2||0}},toSVG:function(reviver){for(var markup=["<g ",'transform="',this.getSvgTransform(),'">'],i=0,len=this._objects.length;len>i;i++)markup.push(this._objects[i].toSVG(reviver));return markup.push("</g>"),reviver?reviver(markup.join("")):markup.join("")},get:function(prop){if(prop in _lockProperties){if(this[prop])return this[prop];for(var i=0,len=this._objects.length;len>i;i++)if(this._objects[i][prop])return!0;return!1}return prop in this.delegatedProperties?this._objects[0]&&this._objects[0].get(prop):this[prop]}}),fabric.Group.fromObject=function(object,callback){fabric.util.enlivenObjects(object.objects,function(enlivenedObjects){delete object.objects,callback&&callback(new fabric.Group(enlivenedObjects,object))})},fabric.Group.async=!0}}("undefined"!=typeof exports?exports:this),function(global){"use strict";var extend=fabric.util.object.extend;return global.fabric||(global.fabric={}),global.fabric.Image?void fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",initialize:function(element,options){options||(options={}),this.filters=[],this.callSuper("initialize",options),this._initElement(element,options),this._initConfig(options),options.filters&&(this.filters=options.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(element,callback){return this._element=element,this._originalElement=element,this._initConfig(),0!==this.filters.length&&this.applyFilters(callback),this},setCrossOrigin:function(value){return this.crossOrigin=value,this._element.crossOrigin=value,this},getOriginalSize:function(){var element=this.getElement();return{width:element.width,height:element.height}},render:function(ctx,noTransform){if(this.visible){ctx.save();var m=this.transformMatrix,isInPathGroup=this.group&&"path-group"===this.group.type;isInPathGroup&&ctx.translate(-this.group.width/2+this.width/2,-this.group.height/2+this.height/2),m&&ctx.transform(m[0],m[1],m[2],m[3],m[4],m[5]),noTransform||this.transform(ctx),ctx.save(),this._setShadow(ctx),this.clipTo&&fabric.util.clipContext(this,ctx),this._render(ctx),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(ctx),this._renderStroke(ctx),this.clipTo&&ctx.restore(),ctx.restore(),this.active&&!noTransform&&(this.drawBorders(ctx),this.drawControls(ctx)),ctx.restore()
}},_stroke:function(ctx){ctx.save(),this._setStrokeStyles(ctx),ctx.beginPath(),ctx.strokeRect(-this.width/2,-this.height/2,this.width,this.height),ctx.closePath(),ctx.restore()},_renderDashedStroke:function(ctx){var x=-this.width/2,y=-this.height/2,w=this.width,h=this.height;ctx.save(),this._setStrokeStyles(ctx),ctx.beginPath(),fabric.util.drawDashedLine(ctx,x,y,x+w,y,this.strokeDashArray),fabric.util.drawDashedLine(ctx,x+w,y,x+w,y+h,this.strokeDashArray),fabric.util.drawDashedLine(ctx,x+w,y+h,x,y+h,this.strokeDashArray),fabric.util.drawDashedLine(ctx,x,y+h,x,y,this.strokeDashArray),ctx.closePath(),ctx.restore()},toObject:function(propertiesToInclude){return extend(this.callSuper("toObject",propertiesToInclude),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(filterObj){return filterObj&&filterObj.toObject()}),crossOrigin:this.crossOrigin})},toSVG:function(reviver){var markup=[];if(markup.push('<g transform="',this.getSvgTransform(),'">','<image xlink:href="',this.getSvgSrc(),'" style="',this.getSvgStyles(),'" transform="translate('+-this.width/2+" "+-this.height/2+")",'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="none"',"></image>"),this.stroke||this.strokeDashArray){var origFill=this.fill;this.fill=null,markup.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>'),this.fill=origFill}return markup.push("</g>"),reviver?reviver(markup.join("")):markup.join("")},getSrc:function(){return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(callback,propertiesToInclude){this.constructor.fromObject(this.toObject(propertiesToInclude),callback)},applyFilters:function(callback){if(0===this.filters.length)return this._element=this._originalElement,void(callback&&callback());var imgEl=this._originalElement,canvasEl=fabric.util.createCanvasElement(),replacement=fabric.util.createImage(),_this=this;return canvasEl.width=imgEl.width,canvasEl.height=imgEl.height,canvasEl.getContext("2d").drawImage(imgEl,0,0,imgEl.width,imgEl.height),this.filters.forEach(function(filter){filter&&filter.applyTo(canvasEl)}),replacement.width=imgEl.width,replacement.height=imgEl.height,fabric.isLikelyNode?(replacement.src=canvasEl.toBuffer(void 0,fabric.Image.pngCompression),_this._element=replacement,callback&&callback()):(replacement.onload=function(){_this._element=replacement,callback&&callback(),replacement.onload=canvasEl=imgEl=null},replacement.src=canvasEl.toDataURL("image/png")),this},_render:function(ctx){ctx.drawImage(this._element,-this.width/2,-this.height/2,this.width,this.height)},_resetWidthHeight:function(){var element=this.getElement();this.set("width",element.width),this.set("height",element.height)},_initElement:function(element){this.setElement(fabric.util.getById(element)),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(options){options||(options={}),this.setOptions(options),this._setWidthHeight(options),this._element.crossOrigin=this.crossOrigin},_initFilters:function(object,callback){object.filters&&object.filters.length?fabric.util.enlivenObjects(object.filters,function(enlivenedObjects){callback&&callback(enlivenedObjects)},"fabric.Image.filters"):callback&&callback()},_setWidthHeight:function(options){this.width="width"in options?options.width:this.getElement().width||0,this.height="height"in options?options.height:this.getElement().height||0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(object,callback){fabric.util.loadImage(object.src,function(img){fabric.Image.prototype._initFilters.call(object,object,function(filters){object.filters=filters||[];var instance=new fabric.Image(img,object);callback&&callback(instance)})},null,object.crossOrigin)},fabric.Image.fromURL=function(url,callback,imgOptions){fabric.util.loadImage(url,function(img){callback(new fabric.Image(img,imgOptions))},null,imgOptions&&imgOptions.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height xlink:href".split(" ")),fabric.Image.fromElement=function(element,callback,options){var parsedAttributes=fabric.parseAttributes(element,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(parsedAttributes["xlink:href"],callback,extend(options?fabric.util.object.clone(options):{},parsedAttributes))},fabric.Image.async=!0,void(fabric.Image.pngCompression=1))}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var angle=this.getAngle()%360;return angle>0?90*Math.round((angle-1)/90):90*Math.round(angle/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(value){_this.setAngle(value),onChange()},onComplete:function(){_this.setCoords(),onComplete()},onStart:function(){_this.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(object){return object.straighten(),this.renderAll(),this},fxStraightenObject:function(object){return object.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Brightness=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Brightness",initialize:function(options){options=options||{},this.brightness=options.brightness||100},applyTo:function(canvasEl){for(var context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,brightness=this.brightness,i=0,len=data.length;len>i;i+=4)data[i]+=brightness,data[i+1]+=brightness,data[i+2]+=brightness;context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper("toObject"),{brightness:this.brightness})}}),fabric.Image.filters.Brightness.fromObject=function(object){return new fabric.Image.filters.Brightness(object)}}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Convolute=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Convolute",initialize:function(options){options=options||{},this.opaque=options.opaque,this.matrix=options.matrix||[0,0,0,0,1,0,0,0,0];var canvasEl=fabric.util.createCanvasElement();this.tmpCtx=canvasEl.getContext("2d")},_createImageData:function(w,h){return this.tmpCtx.createImageData(w,h)},applyTo:function(canvasEl){for(var weights=this.matrix,context=canvasEl.getContext("2d"),pixels=context.getImageData(0,0,canvasEl.width,canvasEl.height),side=Math.round(Math.sqrt(weights.length)),halfSide=Math.floor(side/2),src=pixels.data,sw=pixels.width,sh=pixels.height,w=sw,h=sh,output=this._createImageData(w,h),dst=output.data,alphaFac=this.opaque?1:0,y=0;h>y;y++)for(var x=0;w>x;x++){for(var sy=y,sx=x,dstOff=4*(y*w+x),r=0,g=0,b=0,a=0,cy=0;side>cy;cy++)for(var cx=0;side>cx;cx++){var scy=sy+cy-halfSide,scx=sx+cx-halfSide;if(!(0>scy||scy>sh||0>scx||scx>sw)){var srcOff=4*(scy*sw+scx),wt=weights[cy*side+cx];r+=src[srcOff]*wt,g+=src[srcOff+1]*wt,b+=src[srcOff+2]*wt,a+=src[srcOff+3]*wt}}dst[dstOff]=r,dst[dstOff+1]=g,dst[dstOff+2]=b,dst[dstOff+3]=a+alphaFac*(255-a)}context.putImageData(output,0,0)},toObject:function(){return extend(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),fabric.Image.filters.Convolute.fromObject=function(object){return new fabric.Image.filters.Convolute(object)}}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.GradientTransparency=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(options){options=options||{},this.threshold=options.threshold||100},applyTo:function(canvasEl){for(var context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,threshold=this.threshold,total=data.length,i=0,len=data.length;len>i;i+=4)data[i+3]=threshold+255*(total-i)/total;context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper("toObject"),{threshold:this.threshold})}}),fabric.Image.filters.GradientTransparency.fromObject=function(object){return new fabric.Image.filters.GradientTransparency(object)}}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={});fabric.Image.filters.Grayscale=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(canvasEl){for(var average,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,len=imageData.width*imageData.height*4,index=0;len>index;)average=(data[index]+data[index+1]+data[index+2])/3,data[index]=average,data[index+1]=average,data[index+2]=average,index+=4;context.putImageData(imageData,0,0)}}),fabric.Image.filters.Grayscale.fromObject=function(){return new fabric.Image.filters.Grayscale}}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={});fabric.Image.filters.Invert=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Invert",applyTo:function(canvasEl){var i,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length;for(i=0;iLen>i;i+=4)data[i]=255-data[i],data[i+1]=255-data[i+1],data[i+2]=255-data[i+2];context.putImageData(imageData,0,0)}}),fabric.Image.filters.Invert.fromObject=function(){return new fabric.Image.filters.Invert}}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Mask=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Mask",initialize:function(options){options=options||{},this.mask=options.mask,this.channel=[0,1,2,3].indexOf(options.channel)>-1?options.channel:0},applyTo:function(canvasEl){if(this.mask){var i,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,maskEl=this.mask.getElement(),maskCanvasEl=fabric.util.createCanvasElement(),channel=this.channel,iLen=imageData.width*imageData.height*4;maskCanvasEl.width=maskEl.width,maskCanvasEl.height=maskEl.height,maskCanvasEl.getContext("2d").drawImage(maskEl,0,0,maskEl.width,maskEl.height);var maskImageData=maskCanvasEl.getContext("2d").getImageData(0,0,maskEl.width,maskEl.height),maskData=maskImageData.data;for(i=0;iLen>i;i+=4)data[i+3]=maskData[i+channel];context.putImageData(imageData,0,0)}},toObject:function(){return extend(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),fabric.Image.filters.Mask.fromObject=function(object,callback){fabric.util.loadImage(object.mask.src,function(img){object.mask=new fabric.Image(img,object.mask),callback&&callback(new fabric.Image.filters.Mask(object))})},fabric.Image.filters.Mask.async=!0}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Noise=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Noise",initialize:function(options){options=options||{},this.noise=options.noise||100},applyTo:function(canvasEl){for(var rand,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,noise=this.noise,i=0,len=data.length;len>i;i+=4)rand=(.5-Math.random())*noise,data[i]+=rand,data[i+1]+=rand,data[i+2]+=rand;context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper("toObject"),{noise:this.noise})}}),fabric.Image.filters.Noise.fromObject=function(object){return new fabric.Image.filters.Noise(object)}}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Pixelate=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(options){options=options||{},this.blocksize=options.blocksize||4},applyTo:function(canvasEl){var index,i,j,r,g,b,a,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=imageData.height,jLen=imageData.width;for(i=0;iLen>i;i+=this.blocksize)for(j=0;jLen>j;j+=this.blocksize){index=4*i*jLen+4*j,r=data[index],g=data[index+1],b=data[index+2],a=data[index+3];for(var _i=i,_ilen=i+this.blocksize;_ilen>_i;_i++)for(var _j=j,_jlen=j+this.blocksize;_jlen>_j;_j++)index=4*_i*jLen+4*_j,data[index]=r,data[index+1]=g,data[index+2]=b,data[index+3]=a}context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper("toObject"),{blocksize:this.blocksize})}}),fabric.Image.filters.Pixelate.fromObject=function(object){return new fabric.Image.filters.Pixelate(object)}}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.RemoveWhite=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(options){options=options||{},this.threshold=options.threshold||30,this.distance=options.distance||20},applyTo:function(canvasEl){for(var r,g,b,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,threshold=this.threshold,distance=this.distance,limit=255-threshold,abs=Math.abs,i=0,len=data.length;len>i;i+=4)r=data[i],g=data[i+1],b=data[i+2],r>limit&&g>limit&&b>limit&&abs(r-g)<distance&&abs(r-b)<distance&&abs(g-b)<distance&&(data[i+3]=1);context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),fabric.Image.filters.RemoveWhite.fromObject=function(object){return new fabric.Image.filters.RemoveWhite(object)}}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={});fabric.Image.filters.Sepia=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(canvasEl){var i,avg,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length;for(i=0;iLen>i;i+=4)avg=.3*data[i]+.59*data[i+1]+.11*data[i+2],data[i]=avg+100,data[i+1]=avg+50,data[i+2]=avg+255;context.putImageData(imageData,0,0)}}),fabric.Image.filters.Sepia.fromObject=function(){return new fabric.Image.filters.Sepia}}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={});fabric.Image.filters.Sepia2=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(canvasEl){var i,r,g,b,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length;for(i=0;iLen>i;i+=4)r=data[i],g=data[i+1],b=data[i+2],data[i]=(.393*r+.769*g+.189*b)/1.351,data[i+1]=(.349*r+.686*g+.168*b)/1.203,data[i+2]=(.272*r+.534*g+.131*b)/2.14;context.putImageData(imageData,0,0)}}),fabric.Image.filters.Sepia2.fromObject=function(){return new fabric.Image.filters.Sepia2}}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Tint=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Tint",initialize:function(options){options=options||{},this.color=options.color||"#000000",this.opacity="undefined"!=typeof options.opacity?options.opacity:new fabric.Color(this.color).getAlpha()},applyTo:function(canvasEl){var i,tintR,tintG,tintB,r,g,b,alpha1,source,context=canvasEl.getContext("2d"),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length;for(source=new fabric.Color(this.color).getSource(),tintR=source[0]*this.opacity,tintG=source[1]*this.opacity,tintB=source[2]*this.opacity,alpha1=1-this.opacity,i=0;iLen>i;i+=4)r=data[i],g=data[i+1],b=data[i+2],data[i]=tintR+r*alpha1,data[i+1]=tintG+g*alpha1,data[i+2]=tintB+b*alpha1;context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),fabric.Image.filters.Tint.fromObject=function(object){return new fabric.Image.filters.Tint(object)}}("undefined"!=typeof exports?exports:this),function(global){"use strict";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,clone=fabric.util.object.clone,toFixed=fabric.util.toFixed,supportsLineDash=fabric.StaticCanvas.supports("setLineDash");if(fabric.Text)return void fabric.warn("fabric.Text is already defined");var stateProperties=fabric.Object.prototype.stateProperties.concat();stateProperties.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","useNative","path"),fabric.Text=fabric.util.createClass(fabric.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,textDecoration:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,textBackgroundColor:"",path:null,useNative:!0,stateProperties:stateProperties,stroke:null,shadow:null,initialize:function(text,options){options=options||{},this.text=text,this.__skipDimension=!0,this.setOptions(options),this.__skipDimension=!1,this._initDimensions(),this.setCoords()},_initDimensions:function(){if(!this.__skipDimension){var canvasEl=fabric.util.createCanvasElement();this._render(canvasEl.getContext("2d"))}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(ctx){var isInPathGroup=this.group&&"path-group"===this.group.type;isInPathGroup&&!this.transformMatrix?ctx.translate(-this.group.width/2+this.left,-this.group.height/2+this.top):isInPathGroup&&this.transformMatrix&&ctx.translate(-this.group.width/2,-this.group.height/2),"undefined"==typeof Cufon||this.useNative===!0?this._renderViaNative(ctx):this._renderViaCufon(ctx)},_renderViaNative:function(ctx){var textLines=this.text.split(this._reNewline);this.transform(ctx,fabric.isLikelyNode),this._setTextStyles(ctx),this.width=this._getTextWidth(ctx,textLines),this.height=this._getTextHeight(ctx,textLines),this.clipTo&&fabric.util.clipContext(this,ctx),this._renderTextBackground(ctx,textLines),this._translateForTextAlign(ctx),this._renderText(ctx,textLines),"left"!==this.textAlign&&"justify"!==this.textAlign&&ctx.restore(),this._renderTextDecoration(ctx,textLines),this.clipTo&&ctx.restore(),this._setBoundaries(ctx,textLines),this._totalLineHeight=0},_renderText:function(ctx,textLines){ctx.save(),this._setShadow(ctx),this._renderTextFill(ctx,textLines),this._renderTextStroke(ctx,textLines),this._removeShadow(ctx),ctx.restore()},_translateForTextAlign:function(ctx){"left"!==this.textAlign&&"justify"!==this.textAlign&&(ctx.save(),ctx.translate("center"===this.textAlign?this.width/2:this.width,0))},_setBoundaries:function(ctx,textLines){this._boundaries=[];for(var i=0,len=textLines.length;len>i;i++){var lineWidth=this._getLineWidth(ctx,textLines[i]),lineLeftOffset=this._getLineLeftOffset(lineWidth);this._boundaries.push({height:this.fontSize*this.lineHeight,width:lineWidth,left:lineLeftOffset})}},_setTextStyles:function(ctx){this._setFillStyles(ctx),this._setStrokeStyles(ctx),ctx.textBaseline="alphabetic",this.skipTextAlign||(ctx.textAlign=this.textAlign),ctx.font=this._getFontDeclaration()},_getTextHeight:function(ctx,textLines){return this.fontSize*textLines.length*this.lineHeight},_getTextWidth:function(ctx,textLines){for(var maxWidth=ctx.measureText(textLines[0]||"|").width,i=1,len=textLines.length;len>i;i++){var currentLineWidth=ctx.measureText(textLines[i]).width;currentLineWidth>maxWidth&&(maxWidth=currentLineWidth)}return maxWidth},_renderChars:function(method,ctx,chars,left,top){ctx[method](chars,left,top)},_renderTextLine:function(method,ctx,line,left,top,lineIndex){if(top-=this.fontSize/4,"justify"!==this.textAlign)return void this._renderChars(method,ctx,line,left,top,lineIndex);var lineWidth=ctx.measureText(line).width,totalWidth=this.width;if(totalWidth>lineWidth)for(var words=line.split(/\s+/),wordsWidth=ctx.measureText(line.replace(/\s+/g,"")).width,widthDiff=totalWidth-wordsWidth,numSpaces=words.length-1,spaceWidth=widthDiff/numSpaces,leftOffset=0,i=0,len=words.length;len>i;i++)this._renderChars(method,ctx,words[i],left+leftOffset,top,lineIndex),leftOffset+=ctx.measureText(words[i]).width+spaceWidth;else this._renderChars(method,ctx,line,left,top,lineIndex)},_getLeftOffset:function(){return fabric.isLikelyNode?0:-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(ctx,textLines){if(this.fill||this.skipFillStrokeCheck){this._boundaries=[];for(var lineHeights=0,i=0,len=textLines.length;len>i;i++){var heightOfLine=this._getHeightOfLine(ctx,i,textLines);lineHeights+=heightOfLine,this._renderTextLine("fillText",ctx,textLines[i],this._getLeftOffset(),this._getTopOffset()+lineHeights,i)}}},_renderTextStroke:function(ctx,textLines){if(this.stroke||this.skipFillStrokeCheck){var lineHeights=0;ctx.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),supportsLineDash&&ctx.setLineDash(this.strokeDashArray)),ctx.beginPath();for(var i=0,len=textLines.length;len>i;i++){var heightOfLine=this._getHeightOfLine(ctx,i,textLines);lineHeights+=heightOfLine,this._renderTextLine("strokeText",ctx,textLines[i],this._getLeftOffset(),this._getTopOffset()+lineHeights,i)}ctx.closePath(),ctx.restore()}},_getHeightOfLine:function(){return this.fontSize*this.lineHeight},_renderTextBackground:function(ctx,textLines){this._renderTextBoxBackground(ctx),this._renderTextLinesBackground(ctx,textLines)},_renderTextBoxBackground:function(ctx){this.backgroundColor&&(ctx.save(),ctx.fillStyle=this.backgroundColor,ctx.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),ctx.restore())},_renderTextLinesBackground:function(ctx,textLines){if(this.textBackgroundColor){ctx.save(),ctx.fillStyle=this.textBackgroundColor;for(var i=0,len=textLines.length;len>i;i++)if(""!==textLines[i]){var lineWidth=this._getLineWidth(ctx,textLines[i]),lineLeftOffset=this._getLineLeftOffset(lineWidth);ctx.fillRect(this._getLeftOffset()+lineLeftOffset,this._getTopOffset()+i*this.fontSize*this.lineHeight,lineWidth,this.fontSize*this.lineHeight)}ctx.restore()}},_getLineLeftOffset:function(lineWidth){return"center"===this.textAlign?(this.width-lineWidth)/2:"right"===this.textAlign?this.width-lineWidth:0},_getLineWidth:function(ctx,line){return"justify"===this.textAlign?this.width:ctx.measureText(line).width},_renderTextDecoration:function(ctx,textLines){function renderLinesAtOffset(offset){for(var i=0,len=textLines.length;len>i;i++){var lineWidth=_this._getLineWidth(ctx,textLines[i]),lineLeftOffset=_this._getLineLeftOffset(lineWidth);ctx.fillRect(_this._getLeftOffset()+lineLeftOffset,~~(offset+i*_this._getHeightOfLine(ctx,i,textLines)-halfOfVerticalBox),lineWidth,1)}}if(this.textDecoration){var halfOfVerticalBox=this._getTextHeight(ctx,textLines)/2,_this=this;this.textDecoration.indexOf("underline")>-1&&renderLinesAtOffset(this.fontSize*this.lineHeight),this.textDecoration.indexOf("line-through")>-1&&renderLinesAtOffset(this.fontSize*this.lineHeight-this.fontSize/2),this.textDecoration.indexOf("overline")>-1&&renderLinesAtOffset(this.fontSize*this.lineHeight-this.fontSize)}},_getFontDeclaration:function(){return[fabric.isLikelyNode?this.fontWeight:this.fontStyle,fabric.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",fabric.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(ctx,noTransform){this.visible&&(ctx.save(),this._render(ctx),!noTransform&&this.active&&(this.drawBorders(ctx),this.drawControls(ctx)),ctx.restore())},toObject:function(propertiesToInclude){var object=extend(this.callSuper("toObject",propertiesToInclude),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,path:this.path,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative});return this.includeDefaultValues||this._removeDefaultValues(object),object},toSVG:function(reviver){var markup=[],textLines=this.text.split(this._reNewline),offsets=this._getSVGLeftTopOffsets(textLines),textAndBg=this._getSVGTextAndBg(offsets.lineTop,offsets.textLeft,textLines),shadowSpans=this._getSVGShadows(offsets.lineTop,textLines);return offsets.textTop+=this._fontAscent?this._fontAscent/5*this.lineHeight:0,this._wrapSVGTextAndBg(markup,textAndBg,shadowSpans,offsets),reviver?reviver(markup.join("")):markup.join("")},_getSVGLeftTopOffsets:function(textLines){var lineTop=this.useNative?this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight,textLeft=-(this.width/2),textTop=this.useNative?this.fontSize-1:this.height/2-textLines.length*this.fontSize-this._totalLineHeight;return{textLeft:textLeft,textTop:textTop,lineTop:lineTop}},_wrapSVGTextAndBg:function(markup,textAndBg,shadowSpans,offsets){markup.push('<g transform="',this.getSvgTransform(),'">',textAndBg.textBgRects.join(""),"<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',toFixed(offsets.textLeft,2)," ",toFixed(offsets.textTop,2),')">',shadowSpans.join(""),textAndBg.textSpans.join(""),"</text>","</g>")},_getSVGShadows:function(lineHeight,textLines){var i,len,shadowSpans=[],lineTopOffsetMultiplier=1;if(!this.shadow||!this._boundaries)return shadowSpans;for(i=0,len=textLines.length;len>i;i++)if(""!==textLines[i]){var lineLeftOffset=this._boundaries&&this._boundaries[i]?this._boundaries[i].left:0;shadowSpans.push('<tspan x="',toFixed(lineLeftOffset+lineTopOffsetMultiplier+this.shadow.offsetX,2),0===i||this.useNative?'" y':'" dy','="',toFixed(this.useNative?lineHeight*i-this.height/2+this.shadow.offsetY:lineHeight+(0===i?this.shadow.offsetY:0),2),'" ',this._getFillAttributes(this.shadow.color),">",fabric.util.string.escapeXml(textLines[i]),"</tspan>"),lineTopOffsetMultiplier=1}else lineTopOffsetMultiplier++;return shadowSpans},_getSVGTextAndBg:function(lineHeight,textLeftOffset,textLines){var textSpans=[],textBgRects=[],lineTopOffsetMultiplier=1;this._setSVGBg(textBgRects);for(var i=0,len=textLines.length;len>i;i++)""!==textLines[i]?(this._setSVGTextLineText(textLines[i],i,textSpans,lineHeight,lineTopOffsetMultiplier,textBgRects),lineTopOffsetMultiplier=1):lineTopOffsetMultiplier++,this.textBackgroundColor&&this._boundaries&&this._setSVGTextLineBg(textBgRects,i,textLeftOffset,lineHeight);return{textSpans:textSpans,textBgRects:textBgRects}},_setSVGTextLineText:function(textLine,i,textSpans,lineHeight,lineTopOffsetMultiplier){var lineLeftOffset=this._boundaries&&this._boundaries[i]?toFixed(this._boundaries[i].left,2):0;textSpans.push('<tspan x="',lineLeftOffset,'" ',0===i||this.useNative?"y":"dy",'="',toFixed(this.useNative?lineHeight*i-this.height/2:lineHeight*lineTopOffsetMultiplier,2),'" ',this._getFillAttributes(this.fill),">",fabric.util.string.escapeXml(textLine),"</tspan>")},_setSVGTextLineBg:function(textBgRects,i,textLeftOffset,lineHeight){textBgRects.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',toFixed(textLeftOffset+this._boundaries[i].left,2),'" y="',toFixed(lineHeight*i-this.height/2,2),'" width="',toFixed(this._boundaries[i].width,2),'" height="',toFixed(this._boundaries[i].height,2),'"></rect>')},_setSVGBg:function(textBgRects){this.backgroundColor&&this._boundaries&&textBgRects.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',toFixed(-this.width/2,2),'" y="',toFixed(-this.height/2,2),'" width="',toFixed(this.width,2),'" height="',toFixed(this.height,2),'"></rect>')},_getFillAttributes:function(value){var fillColor=value&&"string"==typeof value?new fabric.Color(value):"";return fillColor&&fillColor.getSource()&&1!==fillColor.getAlpha()?'opacity="'+fillColor.getAlpha()+'" fill="'+fillColor.setAlpha(1).toRgb()+'"':'fill="'+value+'"'},_set:function(key,value){"fontFamily"===key&&this.path&&(this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+value+"$3")),this.callSuper("_set",key,value),key in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),fabric.Text.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y font-family font-style font-weight font-size text-decoration".split(" ")),fabric.Text.fromElement=function(element,options){if(!element)return null;var parsedAttributes=fabric.parseAttributes(element,fabric.Text.ATTRIBUTE_NAMES);options=fabric.util.object.extend(options?fabric.util.object.clone(options):{},parsedAttributes);var text=new fabric.Text(element.textContent,options);return text.set({left:text.getLeft()+text.getWidth()/2,top:text.getTop()-text.getHeight()/2}),text},fabric.Text.fromObject=function(object){return new fabric.Text(object.text,clone(object))},fabric.util.createAccessors(fabric.Text)}("undefined"!=typeof exports?exports:this),function(){var clone=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,skipFillStrokeCheck:!0,_reSpace:/\s|\n/,_fontSizeFraction:4,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(text,options){this.styles=options?options.styles||{}:{},this.callSuper("initialize",text,options),this.initBehavior(),fabric.IText.instances.push(this),this.__lineWidths={},this.__lineHeights={},this.__lineOffsets={}},isEmptyStyles:function(){if(!this.styles)return!0;var obj=this.styles;for(var p1 in obj)for(var p2 in obj[p1])for(var p3 in obj[p1][p2])return!1;return!0},setSelectionStart:function(index){this.selectionStart=index,this.hiddenTextarea&&(this.hiddenTextarea.selectionStart=index)},setSelectionEnd:function(index){this.selectionEnd=index,this.hiddenTextarea&&(this.hiddenTextarea.selectionEnd=index)},getSelectionStyles:function(){var loc=this.get2DCursorLocation();return this.styles[loc.lineIndex]?this.styles[loc.lineIndex][loc.charIndex]||{}:{}},setSelectionStyles:function(styles){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,styles);
else for(var i=this.selectionStart;i<this.selectionEnd;i++)this._extendStyles(i,styles);return this},_extendStyles:function(index,styles){var loc=this.get2DCursorLocation(index);this.styles[loc.lineIndex]||(this.styles[loc.lineIndex]={}),this.styles[loc.lineIndex][loc.charIndex]||(this.styles[loc.lineIndex][loc.charIndex]={}),fabric.util.object.extend(this.styles[loc.lineIndex][loc.charIndex],styles)},_render:function(ctx){this.callSuper("_render",ctx),this.ctx=ctx,this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var boundaries,chars=this.text.split("");this.selectionStart===this.selectionEnd?(boundaries=this._getCursorBoundaries(chars,"cursor"),this.renderCursor(boundaries)):(boundaries=this._getCursorBoundaries(chars,"selection"),this.renderSelection(chars,boundaries))}},get2DCursorLocation:function(selectionStart){"undefined"==typeof selectionStart&&(selectionStart=this.selectionStart);var textBeforeCursor=this.text.slice(0,selectionStart),linesBeforeCursor=textBeforeCursor.split(this._reNewline);return{lineIndex:linesBeforeCursor.length-1,charIndex:linesBeforeCursor[linesBeforeCursor.length-1].length}},getCurrentCharFontSize:function(lineIndex,charIndex){return this.styles[lineIndex]&&this.styles[lineIndex][0===charIndex?0:charIndex-1]&&this.styles[lineIndex][0===charIndex?0:charIndex-1].fontSize||this.fontSize},getCurrentCharColor:function(lineIndex,charIndex){return this.styles[lineIndex]&&this.styles[lineIndex][0===charIndex?0:charIndex-1]&&this.styles[lineIndex][0===charIndex?0:charIndex-1].fill||this.cursorColor},_getCursorBoundaries:function(chars,typeOfBoundaries){var cursorLocation=this.get2DCursorLocation(),textLines=this.text.split(this._reNewline),left=Math.round(this._getLeftOffset()),top=-this.height/2,offsets=this._getCursorBoundariesOffsets(chars,typeOfBoundaries,cursorLocation,textLines);return{left:left,top:top,leftOffset:offsets.left+offsets.lineLeft,topOffset:offsets.top}},_getCursorBoundariesOffsets:function(chars,typeOfBoundaries,cursorLocation,textLines){for(var lineLeftOffset=0,lineIndex=0,charIndex=0,leftOffset=0,topOffset="cursor"===typeOfBoundaries?this._getHeightOfLine(this.ctx,0)-this.getCurrentCharFontSize(cursorLocation.lineIndex,cursorLocation.charIndex):0,i=0;i<this.selectionStart;i++){if("\n"===chars[i]){leftOffset=0;var index=lineIndex+("cursor"===typeOfBoundaries?1:0);topOffset+=this._getCachedLineHeight(index),lineIndex++,charIndex=0}else leftOffset+=this._getWidthOfChar(this.ctx,chars[i],lineIndex,charIndex),charIndex++;lineLeftOffset=this._getCachedLineOffset(lineIndex,textLines)}return this._clearCache(),{top:topOffset,left:leftOffset,lineLeft:lineLeftOffset}},_clearCache:function(){this.__lineWidths={},this.__lineHeights={},this.__lineOffsets={}},_getCachedLineHeight:function(index){return this.__lineHeights[index]||(this.__lineHeights[index]=this._getHeightOfLine(this.ctx,index))},_getCachedLineWidth:function(lineIndex,textLines){return this.__lineWidths[lineIndex]||(this.__lineWidths[lineIndex]=this._getWidthOfLine(this.ctx,lineIndex,textLines))},_getCachedLineOffset:function(lineIndex,textLines){var widthOfLine=this._getCachedLineWidth(lineIndex,textLines);return this.__lineOffsets[lineIndex]||(this.__lineOffsets[lineIndex]=this._getLineLeftOffset(widthOfLine))},renderCursor:function(boundaries){var ctx=this.ctx;ctx.save();var cursorLocation=this.get2DCursorLocation(),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex,charHeight=this.getCurrentCharFontSize(lineIndex,charIndex);ctx.fillStyle=this.getCurrentCharColor(lineIndex,charIndex),ctx.globalAlpha=this._currentCursorOpacity,ctx.fillRect(boundaries.left+boundaries.leftOffset,boundaries.top+boundaries.topOffset,this.cursorWidth/this.scaleX,charHeight),ctx.restore()},renderSelection:function(chars,boundaries){var ctx=this.ctx;ctx.save(),ctx.fillStyle=this.selectionColor;for(var cursorLocation=this.get2DCursorLocation(),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex,textLines=this.text.split(this._reNewline),origLineIndex=lineIndex,i=this.selectionStart;i<this.selectionEnd;i++)if("\n"===chars[i])boundaries.leftOffset=0,boundaries.topOffset+=this._getHeightOfLine(ctx,lineIndex),lineIndex++,charIndex=0;else if(i!==this.text.length){var charWidth=this._getWidthOfChar(ctx,chars[i],lineIndex,charIndex),lineOffset=this._getLineLeftOffset(this._getWidthOfLine(ctx,lineIndex,textLines))||0;lineIndex===origLineIndex&&(lineOffset=0),ctx.fillRect(boundaries.left+boundaries.leftOffset+lineOffset,boundaries.top+boundaries.topOffset,charWidth,this._getHeightOfLine(ctx,lineIndex)),boundaries.leftOffset+=charWidth,charIndex++}ctx.restore()},_renderChars:function(method,ctx,line,left,top,lineIndex){if(this.isEmptyStyles())return this._renderCharsFast(method,ctx,line,left,top);this.skipTextAlign=!0,left-="center"===this.textAlign?this.width/2:"right"===this.textAlign?this.width:0;var textLines=this.text.split(this._reNewline),lineWidth=this._getWidthOfLine(ctx,lineIndex,textLines),lineHeight=this._getHeightOfLine(ctx,lineIndex,textLines),lineLeftOffset=this._getLineLeftOffset(lineWidth),chars=line.split("");left+=lineLeftOffset||0,ctx.save();for(var i=0,len=chars.length;len>i;i++)this._renderChar(method,ctx,lineIndex,i,chars[i],left,top,lineHeight);ctx.restore()},_renderCharsFast:function(method,ctx,line,left,top){this.skipTextAlign=!1,"fillText"===method&&this.fill&&this.callSuper("_renderChars",method,ctx,line,left,top),"strokeText"===method&&this.stroke&&this.callSuper("_renderChars",method,ctx,line,left,top)},_renderChar:function(method,ctx,lineIndex,i,_char,left,top,lineHeight){var decl,charWidth;if(this.styles&&this.styles[lineIndex]&&(decl=this.styles[lineIndex][i])){var shouldStroke=decl.stroke||this.stroke,shouldFill=decl.fill||this.fill;ctx.save(),charWidth=this._applyCharStylesGetWidth(ctx,_char,lineIndex,i,decl),shouldFill&&ctx.fillText(_char,left,top),shouldStroke&&ctx.strokeText(_char,left,top),this._renderCharDecoration(ctx,decl,left,top,charWidth,lineHeight),ctx.restore(),ctx.translate(charWidth,0)}else"strokeText"===method&&this.stroke&&ctx[method](_char,left,top),"fillText"===method&&this.fill&&ctx[method](_char,left,top),charWidth=this._applyCharStylesGetWidth(ctx,_char,lineIndex,i),this._renderCharDecoration(ctx,null,left,top,charWidth,lineHeight),ctx.translate(ctx.measureText(_char).width,0)},_renderCharDecoration:function(ctx,styleDeclaration,left,top,charWidth,lineHeight){var textDecoration=styleDeclaration?styleDeclaration.textDecoration||this.textDecoration:this.textDecoration;textDecoration&&(textDecoration.indexOf("underline")>-1&&this._renderCharDecorationAtOffset(ctx,left,top+this.fontSize/this._fontSizeFraction,charWidth,0),textDecoration.indexOf("line-through")>-1&&this._renderCharDecorationAtOffset(ctx,left,top+this.fontSize/this._fontSizeFraction,charWidth,lineHeight/this._fontSizeFraction),textDecoration.indexOf("overline")>-1&&this._renderCharDecorationAtOffset(ctx,left,top,charWidth,lineHeight-this.fontSize/this._fontSizeFraction))},_renderCharDecorationAtOffset:function(ctx,left,top,charWidth,offset){ctx.fillRect(left,top-offset,charWidth,1)},_renderTextLine:function(method,ctx,line,left,top,lineIndex){top+=this.fontSize/4,this.callSuper("_renderTextLine",method,ctx,line,left,top,lineIndex)},_renderTextDecoration:function(ctx,textLines){return this.isEmptyStyles()?this.callSuper("_renderTextDecoration",ctx,textLines):void 0},_renderTextLinesBackground:function(ctx,textLines){if(this.textBackgroundColor||this.styles){ctx.save(),this.textBackgroundColor&&(ctx.fillStyle=this.textBackgroundColor);for(var lineHeights=0,fractionOfFontSize=this.fontSize/this._fontSizeFraction,i=0,len=textLines.length;len>i;i++){var heightOfLine=this._getHeightOfLine(ctx,i,textLines);if(""!==textLines[i]){var lineWidth=this._getWidthOfLine(ctx,i,textLines),lineLeftOffset=this._getLineLeftOffset(lineWidth);if(this.textBackgroundColor&&(ctx.fillStyle=this.textBackgroundColor,ctx.fillRect(this._getLeftOffset()+lineLeftOffset,this._getTopOffset()+lineHeights+fractionOfFontSize,lineWidth,heightOfLine)),this.styles[i])for(var j=0,jlen=textLines[i].length;jlen>j;j++)if(this.styles[i]&&this.styles[i][j]&&this.styles[i][j].textBackgroundColor){var _char=textLines[i][j];ctx.fillStyle=this.styles[i][j].textBackgroundColor,ctx.fillRect(this._getLeftOffset()+lineLeftOffset+this._getWidthOfCharsAt(ctx,i,j,textLines),this._getTopOffset()+lineHeights+fractionOfFontSize,this._getWidthOfChar(ctx,_char,i,j,textLines)+1,heightOfLine)}lineHeights+=heightOfLine}else lineHeights+=heightOfLine}ctx.restore()}},_getCacheProp:function(_char,styleDeclaration){return _char+styleDeclaration.fontFamily+styleDeclaration.fontSize+styleDeclaration.fontWeight+styleDeclaration.fontStyle+styleDeclaration.shadow},_applyCharStylesGetWidth:function(ctx,_char,lineIndex,charIndex,decl){var styleDeclaration=decl||this.styles[lineIndex]&&this.styles[lineIndex][charIndex];styleDeclaration=styleDeclaration?clone(styleDeclaration):{},this._applyFontStyles(styleDeclaration);var cacheProp=this._getCacheProp(_char,styleDeclaration);if(this.isEmptyStyles()&&this._charWidthsCache[cacheProp])return this._charWidthsCache[cacheProp];"string"==typeof styleDeclaration.shadow&&(styleDeclaration.shadow=new fabric.Shadow(styleDeclaration.shadow));var fill=styleDeclaration.fill||this.fill;return ctx.fillStyle=fill.toLive?fill.toLive(ctx):fill,styleDeclaration.stroke&&(ctx.strokeStyle=styleDeclaration.stroke&&styleDeclaration.stroke.toLive?styleDeclaration.stroke.toLive(ctx):styleDeclaration.stroke),ctx.lineWidth=styleDeclaration.strokeWidth||this.strokeWidth,ctx.font=this._getFontDeclaration.call(styleDeclaration),this._setShadow.call(styleDeclaration,ctx),this._charWidthsCache[cacheProp]||(this._charWidthsCache[cacheProp]=ctx.measureText(_char).width),this._charWidthsCache[cacheProp]},_applyFontStyles:function(styleDeclaration){styleDeclaration.fontFamily||(styleDeclaration.fontFamily=this.fontFamily),styleDeclaration.fontSize||(styleDeclaration.fontSize=this.fontSize),styleDeclaration.fontWeight||(styleDeclaration.fontWeight=this.fontWeight),styleDeclaration.fontStyle||(styleDeclaration.fontStyle=this.fontStyle)},_getWidthOfChar:function(ctx,_char,lineIndex,charIndex){ctx.save();var width=this._applyCharStylesGetWidth(ctx,_char,lineIndex,charIndex);return ctx.restore(),width},_getHeightOfChar:function(ctx,_char,lineIndex,charIndex){return this.styles[lineIndex]&&this.styles[lineIndex][charIndex]?this.styles[lineIndex][charIndex].fontSize||this.fontSize:this.fontSize},_getWidthOfCharAt:function(ctx,lineIndex,charIndex,lines){lines=lines||this.text.split(this._reNewline);var _char=lines[lineIndex].split("")[charIndex];return this._getWidthOfChar(ctx,_char,lineIndex,charIndex)},_getHeightOfCharAt:function(ctx,lineIndex,charIndex,lines){lines=lines||this.text.split(this._reNewline);var _char=lines[lineIndex].split("")[charIndex];return this._getHeightOfChar(ctx,_char,lineIndex,charIndex)},_getWidthOfCharsAt:function(ctx,lineIndex,charIndex,lines){for(var width=0,i=0;charIndex>i;i++)width+=this._getWidthOfCharAt(ctx,lineIndex,i,lines);return width},_getWidthOfLine:function(ctx,lineIndex,textLines){return this._getWidthOfCharsAt(ctx,lineIndex,textLines[lineIndex].length,textLines)},_getTextWidth:function(ctx,textLines){if(this.isEmptyStyles())return this.callSuper("_getTextWidth",ctx,textLines);for(var maxWidth=this._getWidthOfLine(ctx,0,textLines),i=1,len=textLines.length;len>i;i++){var currentLineWidth=this._getWidthOfLine(ctx,i,textLines);currentLineWidth>maxWidth&&(maxWidth=currentLineWidth)}return maxWidth},_getHeightOfLine:function(ctx,lineIndex,textLines){textLines=textLines||this.text.split(this._reNewline);for(var maxHeight=this._getHeightOfChar(ctx,textLines[lineIndex][0],lineIndex,0),line=textLines[lineIndex],chars=line.split(""),i=1,len=chars.length;len>i;i++){var currentCharHeight=this._getHeightOfChar(ctx,chars[i],lineIndex,i);currentCharHeight>maxHeight&&(maxHeight=currentCharHeight)}return maxHeight*this.lineHeight},_getTextHeight:function(ctx,textLines){for(var height=0,i=0,len=textLines.length;len>i;i++)height+=this._getHeightOfLine(ctx,i,textLines);return height},_getTopOffset:function(){var topOffset=fabric.Text.prototype._getTopOffset.call(this);return topOffset-this.fontSize/this._fontSizeFraction},toObject:function(propertiesToInclude){return fabric.util.object.extend(this.callSuper("toObject",propertiesToInclude),{styles:clone(this.styles)})}}),fabric.IText.fromObject=function(object){return new fabric.IText(object.text,clone(object))},fabric.IText.instances=[]}(),function(){var clone=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initKeyHandlers(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.initHiddenTextarea()},initSelectedHandler:function(){this.on("selected",function(){var _this=this;setTimeout(function(){_this.selected=!0},100),this._hasCanvasHandlers||(this._initCanvasHandlers(),this._hasCanvasHandlers=!0)})},_initCanvasHandlers:function(){var _this=this;this.canvas.on("selection:cleared",function(options){options.e&&_this.canvas.containsPoint(options.e,_this)||_this.exitEditing()}),this.canvas.on("mouse:up",function(){this.getObjects("i-text").forEach(function(obj){obj.__isMousedown=!1})})},_tick:function(){var _this=this;this._abortCursorAnimation||this.animate("_currentCursorOpacity",1,{duration:this.cursorDuration,onComplete:function(){_this._onTickComplete()},onChange:function(){_this.canvas&&_this.canvas.renderAll()},abort:function(){return _this._abortCursorAnimation}})},_onTickComplete:function(){if(!this._abortCursorAnimation){var _this=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){_this.animate("_currentCursorOpacity",0,{duration:this.cursorDuration/2,onComplete:function(){_this._tick()},onChange:function(){_this.canvas&&_this.canvas.renderAll()},abort:function(){return _this._abortCursorAnimation}})},100)}},initDelayedCursor:function(){var _this=this;this._cursorTimeout2&&clearTimeout(this._cursorTimeout2),this._cursorTimeout2=setTimeout(function(){_this._abortCursorAnimation=!1,_this._tick()},this.cursorDelay)},abortCursorAnimation:function(){this._abortCursorAnimation=!0,clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,this.canvas&&this.canvas.renderAll();var _this=this;setTimeout(function(){_this._abortCursorAnimation=!1},10)},selectAll:function(){this.selectionStart=0,this.selectionEnd=this.text.length},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(startFrom){var offset=0,index=startFrom-1;if(this._reSpace.test(this.text.charAt(index)))for(;this._reSpace.test(this.text.charAt(index));)offset++,index--;for(;/\S/.test(this.text.charAt(index))&&index>-1;)offset++,index--;return startFrom-offset},findWordBoundaryRight:function(startFrom){var offset=0,index=startFrom;if(this._reSpace.test(this.text.charAt(index)))for(;this._reSpace.test(this.text.charAt(index));)offset++,index++;for(;/\S/.test(this.text.charAt(index))&&index<this.text.length;)offset++,index++;return startFrom+offset},findLineBoundaryLeft:function(startFrom){for(var offset=0,index=startFrom-1;!/\n/.test(this.text.charAt(index))&&index>-1;)offset++,index--;return startFrom-offset},findLineBoundaryRight:function(startFrom){for(var offset=0,index=startFrom;!/\n/.test(this.text.charAt(index))&&index<this.text.length;)offset++,index++;return startFrom+offset},getNumNewLinesInSelectedText:function(){for(var selectedText=this.getSelectedText(),numNewLines=0,i=0,chars=selectedText.split(""),len=chars.length;len>i;i++)"\n"===chars[i]&&numNewLines++;return numNewLines},searchWordBoundary:function(selectionStart,direction){for(var index=selectionStart,_char=this.text.charAt(index),reNonWord=/[ \n\.,;!\?\-]/;!reNonWord.test(_char)&&index>0&&index<this.text.length;)index+=direction,_char=this.text.charAt(index);return reNonWord.test(_char)&&"\n"!==_char&&(index+=1===direction?0:1),index},selectWord:function(selectionStart){var newSelectionStart=this.searchWordBoundary(selectionStart,-1),newSelectionEnd=this.searchWordBoundary(selectionStart,1);this.setSelectionStart(newSelectionStart),this.setSelectionEnd(newSelectionEnd)},selectLine:function(selectionStart){var newSelectionStart=this.findLineBoundaryLeft(selectionStart),newSelectionEnd=this.findLineBoundaryRight(selectionStart);this.setSelectionStart(newSelectionStart),this.setSelectionEnd(newSelectionEnd)},enterEditing:function(){return!this.isEditing&&this.editable?(this.exitEditingOnOthers(),this.isEditing=!0,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.canvas&&this.canvas.renderAll(),this.fire("editing:entered"),this):void 0},exitEditingOnOthers:function(){fabric.IText.instances.forEach(function(obj){obj!==this&&obj.exitEditing()},this)},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){this.hiddenTextarea&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.focus())},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.hiddenTextarea.blur(),this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),this},_removeExtraneousStyles:function(){var textLines=this.text.split(this._reNewline);for(var prop in this.styles)textLines[prop]||delete this.styles[prop]},_removeCharsFromTo:function(start,end){for(var i=end;i!==start;){var prevIndex=this.get2DCursorLocation(i).charIndex;i--;var index=this.get2DCursorLocation(i).charIndex,isNewline=index>prevIndex;isNewline?this.removeStyleObject(isNewline,i+1):this.removeStyleObject(0===this.get2DCursorLocation(i).charIndex,i)}this.text=this.text.slice(0,start)+this.text.slice(end)},insertChars:function(_chars){var isEndOfLine="\n"===this.text.slice(this.selectionStart,this.selectionStart+1);this.text=this.text.slice(0,this.selectionStart)+_chars+this.text.slice(this.selectionEnd),this.selectionStart===this.selectionEnd?this.insertStyleObject(_chars,isEndOfLine):this.selectionEnd-this.selectionStart>1,this.selectionStart+=_chars.length,this.selectionEnd=this.selectionStart,this.canvas&&this.canvas.renderAll().renderAll(),this.setCoords(),this.fire("text:changed")},insertNewlineStyleObject:function(lineIndex,charIndex,isEndOfLine){this.shiftLineStyles(lineIndex,1),this.styles[lineIndex+1]||(this.styles[lineIndex+1]={});var currentCharStyle=this.styles[lineIndex][charIndex-1],newLineStyles={};if(isEndOfLine)newLineStyles[0]=clone(currentCharStyle),this.styles[lineIndex+1]=newLineStyles;else{for(var index in this.styles[lineIndex])parseInt(index,10)>=charIndex&&(newLineStyles[parseInt(index,10)-charIndex]=this.styles[lineIndex][index],delete this.styles[lineIndex][index]);this.styles[lineIndex+1]=newLineStyles}},insertCharStyleObject:function(lineIndex,charIndex){var currentLineStyles=this.styles[lineIndex],currentLineStylesCloned=clone(currentLineStyles);0===charIndex&&(charIndex=1);for(var index in currentLineStylesCloned){var numericIndex=parseInt(index,10);numericIndex>=charIndex&&(currentLineStyles[numericIndex+1]=currentLineStylesCloned[numericIndex])}this.styles[lineIndex][charIndex]=clone(currentLineStyles[charIndex-1])},insertStyleObject:function(_chars,isEndOfLine){if(!this.isEmptyStyles()){var cursorLocation=this.get2DCursorLocation(),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex;this.styles[lineIndex]||(this.styles[lineIndex]={}),"\n"===_chars?this.insertNewlineStyleObject(lineIndex,charIndex,isEndOfLine):this.insertCharStyleObject(lineIndex,charIndex)}},shiftLineStyles:function(lineIndex,offset){var clonedStyles=clone(this.styles);for(var line in this.styles){var numericLine=parseInt(line,10);numericLine>lineIndex&&(this.styles[numericLine+offset]=clonedStyles[numericLine])}},removeStyleObject:function(isBeginningOfLine,index){var cursorLocation=this.get2DCursorLocation(index),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex;if(isBeginningOfLine){var textLines=this.text.split(this._reNewline),textOnPreviousLine=textLines[lineIndex-1],newCharIndexOnPrevLine=textOnPreviousLine.length;this.styles[lineIndex-1]||(this.styles[lineIndex-1]={});for(charIndex in this.styles[lineIndex])this.styles[lineIndex-1][parseInt(charIndex,10)+newCharIndexOnPrevLine]=this.styles[lineIndex][charIndex];this.shiftLineStyles(lineIndex,-1)}else{var currentLineStyles=this.styles[lineIndex];if(currentLineStyles){var offset=this.selectionStart===this.selectionEnd?-1:0;delete currentLineStyles[charIndex+offset]}var currentLineStylesCloned=clone(currentLineStyles);for(var i in currentLineStylesCloned){var numericIndex=parseInt(i,10);numericIndex>=charIndex&&0!==numericIndex&&(currentLineStyles[numericIndex-1]=currentLineStylesCloned[numericIndex],delete currentLineStyles[numericIndex])}}},insertNewline:function(){this.insertChars("\n")}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(options){this.__newClickTime=+new Date;var newPointer=this.canvas.getPointer(options.e);this.isTripleClick(newPointer)?(this.fire("tripleclick",options),this._stopEvent(options.e)):this.isDoubleClick(newPointer)&&(this.fire("dblclick",options),this._stopEvent(options.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=newPointer},isDoubleClick:function(newPointer){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===newPointer.x&&this.__lastPointer.y===newPointer.y},isTripleClick:function(newPointer){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===newPointer.x&&this.__lastPointer.y===newPointer.y},_stopEvent:function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMousemoveHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(options){this.selectWord(this.getSelectionStartFromPointer(options.e))}),this.on("tripleclick",function(options){this.selectLine(this.getSelectionStartFromPointer(options.e))})},initMousedownHandler:function(){this.on("mousedown",function(options){var pointer=this.canvas.getPointer(options.e);this.__mousedownX=pointer.x,this.__mousedownY=pointer.y,this.__isMousedown=!0,this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea),this.isEditing?(this.setCursorByClick(options.e),this.__selectionStartOnMouseDown=this.selectionStart):this.exitEditingOnOthers()})},initMousemoveHandler:function(){this.on("mousemove",function(options){if(this.__isMousedown&&this.isEditing){var newSelectionStart=this.getSelectionStartFromPointer(options.e);newSelectionStart>=this.__selectionStartOnMouseDown?(this.setSelectionStart(this.__selectionStartOnMouseDown),this.setSelectionEnd(newSelectionStart)):(this.setSelectionStart(newSelectionStart),this.setSelectionEnd(this.__selectionStartOnMouseDown))}})},_isObjectMoved:function(e){var pointer=this.canvas.getPointer(e);return this.__mousedownX!==pointer.x||this.__mousedownY!==pointer.y},initMouseupHandler:function(){this.on("mouseup",function(options){this.__isMousedown=!1,this._isObjectMoved(options.e)||this.selected&&this.enterEditing()})},setCursorByClick:function(e){var newSelectionStart=this.getSelectionStartFromPointer(e);e.shiftKey?newSelectionStart<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(newSelectionStart)):this.setSelectionEnd(newSelectionStart):(this.setSelectionStart(newSelectionStart),this.setSelectionEnd(newSelectionStart))},_getLocalRotatedPointer:function(e){var pointer=this.canvas.getPointer(e),pClicked=new fabric.Point(pointer.x,pointer.y),pLeftTop=new fabric.Point(this.left,this.top),rotated=fabric.util.rotatePoint(pClicked,pLeftTop,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(e,rotated)},getSelectionStartFromPointer:function(e){for(var newSelectionStart,mouseOffset=this._getLocalRotatedPointer(e),textLines=this.text.split(this._reNewline),prevWidth=0,width=0,height=0,charIndex=0,i=0,len=textLines.length;len>i;i++){height+=this._getHeightOfLine(this.ctx,i)*this.scaleY;var widthOfLine=this._getWidthOfLine(this.ctx,i,textLines),lineLeftOffset=this._getLineLeftOffset(widthOfLine);width=lineLeftOffset,this.flipX&&(textLines[i]=textLines[i].split("").reverse().join(""));for(var j=0,jlen=textLines[i].length;jlen>j;j++){var _char=textLines[i][j];if(prevWidth=width,width+=this._getWidthOfChar(this.ctx,_char,i,this.flipX?jlen-j:j)*this.scaleX,!(height<=mouseOffset.y||width<=mouseOffset.x))return this._getNewSelectionStartFromOffset(mouseOffset,prevWidth,width,charIndex+i,jlen);charIndex++}}return"undefined"==typeof newSelectionStart?this.text.length:void 0},_getNewSelectionStartFromOffset:function(mouseOffset,prevWidth,width,index,jlen){var distanceBtwLastCharAndCursor=mouseOffset.x-prevWidth,distanceBtwNextCharAndCursor=width-mouseOffset.x,offset=distanceBtwNextCharAndCursor>distanceBtwLastCharAndCursor?0:1,newSelectionStart=index+offset;return this.flipX&&(newSelectionStart=jlen-newSelectionStart),newSelectionStart>this.text.length&&(newSelectionStart=this.text.length),newSelectionStart}}),fabric.util.object.extend(fabric.IText.prototype,{initKeyHandlers:function(){fabric.util.addListener(fabric.document,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(fabric.document,"keypress",this.onKeyPress.bind(this))},initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.style.cssText="position: absolute; top: 0; left: -9999px",fabric.document.body.appendChild(this.hiddenTextarea)},_keysMap:{8:"removeChars",13:"insertNewline",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",67:"copy",86:"paste",88:"cut"},onKeyDown:function(e){if(this.isEditing){if(e.keyCode in this._keysMap)this[this._keysMap[e.keyCode]](e);else{if(!(e.keyCode in this._ctrlKeysMap&&(e.ctrlKey||e.metaKey)))return;this[this._ctrlKeysMap[e.keyCode]](e)}e.preventDefault(),e.stopPropagation(),this.canvas&&this.canvas.renderAll()}},forwardDelete:function(e){this.selectionStart===this.selectionEnd&&this.moveCursorRight(e),this.removeChars(e)},copy:function(){var selectedText=this.getSelectedText();this.copiedText=selectedText},paste:function(){this.copiedText&&this.insertChars(this.copiedText)},cut:function(e){this.copy(),this.removeChars(e)},onKeyPress:function(e){!this.isEditing||e.metaKey||e.ctrlKey||8===e.keyCode||13===e.keyCode||(this.insertChars(String.fromCharCode(e.which)),e.preventDefault(),e.stopPropagation())},getDownCursorOffset:function(e,isRight){var _char,lineLeftOffset,selectionProp=isRight?this.selectionEnd:this.selectionStart,textLines=this.text.split(this._reNewline),textBeforeCursor=this.text.slice(0,selectionProp),textAfterCursor=this.text.slice(selectionProp),textOnSameLineBeforeCursor=textBeforeCursor.slice(textBeforeCursor.lastIndexOf("\n")+1),textOnSameLineAfterCursor=textAfterCursor.match(/(.*)\n?/)[1],textOnNextLine=(textAfterCursor.match(/.*\n(.*)\n?/)||{})[1]||"",cursorLocation=this.get2DCursorLocation(selectionProp);if(cursorLocation.lineIndex===textLines.length-1||e.metaKey)return this.text.length-selectionProp;var widthOfSameLineBeforeCursor=this._getWidthOfLine(this.ctx,cursorLocation.lineIndex,textLines);lineLeftOffset=this._getLineLeftOffset(widthOfSameLineBeforeCursor);for(var widthOfCharsOnSameLineBeforeCursor=lineLeftOffset,lineIndex=cursorLocation.lineIndex,i=0,len=textOnSameLineBeforeCursor.length;len>i;i++)_char=textOnSameLineBeforeCursor[i],widthOfCharsOnSameLineBeforeCursor+=this._getWidthOfChar(this.ctx,_char,lineIndex,i);var indexOnNextLine=this._getIndexOnNextLine(cursorLocation,textOnNextLine,widthOfCharsOnSameLineBeforeCursor,textLines);return textOnSameLineAfterCursor.length+1+indexOnNextLine},_getIndexOnNextLine:function(cursorLocation,textOnNextLine,widthOfCharsOnSameLineBeforeCursor,textLines){for(var foundMatch,lineIndex=cursorLocation.lineIndex+1,widthOfNextLine=this._getWidthOfLine(this.ctx,lineIndex,textLines),lineLeftOffset=this._getLineLeftOffset(widthOfNextLine),widthOfCharsOnNextLine=lineLeftOffset,indexOnNextLine=0,j=0,jlen=textOnNextLine.length;jlen>j;j++){var _char=textOnNextLine[j],widthOfChar=this._getWidthOfChar(this.ctx,_char,lineIndex,j);if(widthOfCharsOnNextLine+=widthOfChar,widthOfCharsOnNextLine>widthOfCharsOnSameLineBeforeCursor){foundMatch=!0;var leftEdge=widthOfCharsOnNextLine-widthOfChar,rightEdge=widthOfCharsOnNextLine,offsetFromLeftEdge=Math.abs(leftEdge-widthOfCharsOnSameLineBeforeCursor),offsetFromRightEdge=Math.abs(rightEdge-widthOfCharsOnSameLineBeforeCursor);indexOnNextLine=offsetFromLeftEdge>offsetFromRightEdge?j+1:j;break}}return foundMatch||(indexOnNextLine=textOnNextLine.length),indexOnNextLine},moveCursorDown:function(e){this.abortCursorAnimation(),this._currentCursorOpacity=1;var offset=this.getDownCursorOffset(e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorDownWithShift(offset):this.moveCursorDownWithoutShift(offset),this.initDelayedCursor()},moveCursorDownWithoutShift:function(offset){this._selectionDirection="right",this.selectionStart+=offset,this.selectionStart>this.text.length&&(this.selectionStart=this.text.length),this.selectionEnd=this.selectionStart},moveCursorDownWithShift:function(offset){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?(this.selectionStart+=offset,void(this._selectionDirection="left")):(this._selectionDirection="right",this.selectionEnd+=offset,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length),void 0)},getUpCursorOffset:function(e,isRight){var selectionProp=isRight?this.selectionEnd:this.selectionStart,cursorLocation=this.get2DCursorLocation(selectionProp);if(0===cursorLocation.lineIndex||e.metaKey)return selectionProp;var _char,lineLeftOffset,textBeforeCursor=this.text.slice(0,selectionProp),textOnSameLineBeforeCursor=textBeforeCursor.slice(textBeforeCursor.lastIndexOf("\n")+1),textOnPreviousLine=(textBeforeCursor.match(/\n?(.*)\n.*$/)||{})[1]||"",textLines=this.text.split(this._reNewline),widthOfSameLineBeforeCursor=this._getWidthOfLine(this.ctx,cursorLocation.lineIndex,textLines);lineLeftOffset=this._getLineLeftOffset(widthOfSameLineBeforeCursor);for(var widthOfCharsOnSameLineBeforeCursor=lineLeftOffset,lineIndex=cursorLocation.lineIndex,i=0,len=textOnSameLineBeforeCursor.length;len>i;i++)_char=textOnSameLineBeforeCursor[i],widthOfCharsOnSameLineBeforeCursor+=this._getWidthOfChar(this.ctx,_char,lineIndex,i);
var indexOnPrevLine=this._getIndexOnPrevLine(cursorLocation,textOnPreviousLine,widthOfCharsOnSameLineBeforeCursor,textLines);return textOnPreviousLine.length-indexOnPrevLine+textOnSameLineBeforeCursor.length},_getIndexOnPrevLine:function(cursorLocation,textOnPreviousLine,widthOfCharsOnSameLineBeforeCursor,textLines){for(var foundMatch,lineIndex=cursorLocation.lineIndex-1,widthOfPreviousLine=this._getWidthOfLine(this.ctx,lineIndex,textLines),lineLeftOffset=this._getLineLeftOffset(widthOfPreviousLine),widthOfCharsOnPreviousLine=lineLeftOffset,indexOnPrevLine=0,j=0,jlen=textOnPreviousLine.length;jlen>j;j++){var _char=textOnPreviousLine[j],widthOfChar=this._getWidthOfChar(this.ctx,_char,lineIndex,j);if(widthOfCharsOnPreviousLine+=widthOfChar,widthOfCharsOnPreviousLine>widthOfCharsOnSameLineBeforeCursor){foundMatch=!0;var leftEdge=widthOfCharsOnPreviousLine-widthOfChar,rightEdge=widthOfCharsOnPreviousLine,offsetFromLeftEdge=Math.abs(leftEdge-widthOfCharsOnSameLineBeforeCursor),offsetFromRightEdge=Math.abs(rightEdge-widthOfCharsOnSameLineBeforeCursor);indexOnPrevLine=offsetFromLeftEdge>offsetFromRightEdge?j:j-1;break}}return foundMatch||(indexOnPrevLine=textOnPreviousLine.length-1),indexOnPrevLine},moveCursorUp:function(e){this.abortCursorAnimation(),this._currentCursorOpacity=1;var offset=this.getUpCursorOffset(e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorUpWithShift(offset):this.moveCursorUpWithoutShift(offset),this.initDelayedCursor()},moveCursorUpWithShift:function(offset){if(this.selectionStart===this.selectionEnd)this.selectionStart-=offset;else{if("right"===this._selectionDirection)return this.selectionEnd-=offset,void(this._selectionDirection="right");this.selectionStart-=offset}this.selectionStart<0&&(this.selectionStart=0),this._selectionDirection="left"},moveCursorUpWithoutShift:function(offset){this.selectionStart===this.selectionEnd&&(this.selectionStart-=offset),this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd=this.selectionStart,this._selectionDirection="left"},moveCursorLeft:function(e){(0!==this.selectionStart||0!==this.selectionEnd)&&(this.abortCursorAnimation(),this._currentCursorOpacity=1,e.shiftKey?this.moveCursorLeftWithShift(e):this.moveCursorLeftWithoutShift(e),this.initDelayedCursor())},_move:function(e,prop,direction){e.altKey?this[prop]=this["findWordBoundary"+direction](this[prop]):e.metaKey?this[prop]=this["findLineBoundary"+direction](this[prop]):this[prop]+="Left"===direction?-1:1},_moveLeft:function(e,prop){this._move(e,prop,"Left")},_moveRight:function(e,prop){this._move(e,prop,"Right")},moveCursorLeftWithoutShift:function(e){this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this._moveLeft(e,"selectionStart"),this.selectionEnd=this.selectionStart},moveCursorLeftWithShift:function(e){"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(e,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(e,"selectionStart"),"\n"===this.text.charAt(this.selectionStart)&&this.selectionStart--,this.selectionStart<0&&(this.selectionStart=0))},moveCursorRight:function(e){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,e.shiftKey?this.moveCursorRightWithShift(e):this.moveCursorRightWithoutShift(e),this.initDelayedCursor())},moveCursorRightWithShift:function(e){"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(e,"selectionStart"):(this._selectionDirection="right",this._moveRight(e,"selectionEnd"),"\n"===this.text.charAt(this.selectionEnd-1)&&this.selectionEnd++,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length))},moveCursorRightWithoutShift:function(e){this._selectionDirection="right",this.selectionStart===this.selectionEnd?(this._moveRight(e,"selectionStart"),this.selectionEnd=this.selectionStart):(this.selectionEnd+=this.getNumNewLinesInSelectedText(),this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length),this.selectionStart=this.selectionEnd)},removeChars:function(e){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(e):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.selectionEnd=this.selectionStart,this._removeExtraneousStyles(),this.canvas&&this.canvas.renderAll().renderAll(),this.setCoords(),this.fire("text:changed")},_removeCharsNearCursor:function(e){if(0!==this.selectionStart)if(e.metaKey){var leftLineBoundary=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(leftLineBoundary,this.selectionStart),this.selectionStart=leftLineBoundary}else if(e.altKey){var leftWordBoundary=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(leftWordBoundary,this.selectionStart),this.selectionStart=leftWordBoundary}else{var isBeginningOfLine="\n"===this.text.slice(this.selectionStart-1,this.selectionStart);this.removeStyleObject(isBeginningOfLine),this.selectionStart--,this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)}}}),fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(textLine,lineIndex,textSpans,lineHeight,lineTopOffsetMultiplier,textBgRects){this.styles[lineIndex]?this._setSVGTextLineChars(textLine,lineIndex,textSpans,lineHeight,lineTopOffsetMultiplier,textBgRects):this.callSuper("_setSVGTextLineText",textLine,lineIndex,textSpans,lineHeight,lineTopOffsetMultiplier)},_setSVGTextLineChars:function(textLine,lineIndex,textSpans,lineHeight,lineTopOffsetMultiplier,textBgRects){for(var yProp=0===lineIndex||this.useNative?"y":"dy",chars=textLine.split(""),charOffset=0,lineLeftOffset=this._getSVGLineLeftOffset(lineIndex),lineTopOffset=this._getSVGLineTopOffset(lineIndex),heightOfLine=this._getHeightOfLine(this.ctx,lineIndex),i=0,len=chars.length;len>i;i++){var styleDecl=this.styles[lineIndex][i]||{};textSpans.push(this._createTextCharSpan(chars[i],styleDecl,lineLeftOffset,lineTopOffset,yProp,charOffset));var charWidth=this._getWidthOfChar(this.ctx,chars[i],lineIndex,i);styleDecl.textBackgroundColor&&textBgRects.push(this._createTextCharBg(styleDecl,lineLeftOffset,lineTopOffset,heightOfLine,charWidth,charOffset)),charOffset+=charWidth}},_getSVGLineLeftOffset:function(lineIndex){return this._boundaries&&this._boundaries[lineIndex]?fabric.util.toFixed(this._boundaries[lineIndex].left,2):0},_getSVGLineTopOffset:function(lineIndex){for(var lineTopOffset=0,j=0;lineIndex>=j;j++)lineTopOffset+=this._getHeightOfLine(this.ctx,j);return lineTopOffset-this.height/2},_createTextCharBg:function(styleDecl,lineLeftOffset,lineTopOffset,heightOfLine,charWidth,charOffset){return['<rect fill="',styleDecl.textBackgroundColor,'" transform="translate(',-this.width/2," ",-this.height+heightOfLine,")",'" x="',lineLeftOffset+charOffset,'" y="',lineTopOffset+heightOfLine,'" width="',charWidth,'" height="',heightOfLine,'"></rect>'].join("")},_createTextCharSpan:function(_char,styleDecl,lineLeftOffset,lineTopOffset,yProp,charOffset){var fillStyles=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},styleDecl));return['<tspan x="',lineLeftOffset+charOffset,'" ',yProp,'="',lineTopOffset,'" ',styleDecl.fontFamily?'font-family="'+styleDecl.fontFamily.replace(/"/g,"'")+'" ':"",styleDecl.fontSize?'font-size="'+styleDecl.fontSize+'" ':"",styleDecl.fontStyle?'font-style="'+styleDecl.fontStyle+'" ':"",styleDecl.fontWeight?'font-weight="'+styleDecl.fontWeight+'" ':"",styleDecl.textDecoration?'text-decoration="'+styleDecl.textDecoration+'" ':"",'style="',fillStyles,'">',fabric.util.string.escapeXml(_char),"</tspan>"].join("")}}),function(){function request(url,encoding,callback){var oURL=URL.parse(url);oURL.port||(oURL.port=0===oURL.protocol.indexOf("https:")?443:80);var reqHandler=443===oURL.port?HTTPS:HTTP,req=reqHandler.request({hostname:oURL.hostname,port:oURL.port,path:oURL.path,method:"GET"},function(response){var body="";encoding&&response.setEncoding(encoding),response.on("end",function(){callback(body)}),response.on("data",function(chunk){200===response.statusCode&&(body+=chunk)})});req.on("error",function(err){fabric.log(err.errno===process.ECONNREFUSED?"ECONNREFUSED: connection refused to "+oURL.hostname+":"+oURL.port:err.message)}),req.end()}function request_fs(path,callback){var fs=require("fs");fs.readFile(path,function(err,data){if(err)throw fabric.log(err),err;callback(data)})}if("undefined"==typeof document||"undefined"==typeof window){var DOMParser=new require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;fabric.util.loadImage=function(url,callback,context){var createImageAndCallBack=function(data){img.src=new Buffer(data,"binary"),img._src=url,callback&&callback.call(context,img)},img=new Image;url&&(url instanceof Buffer||0===url.indexOf("data"))?(img.src=img._src=url,callback&&callback.call(context,img)):url&&0!==url.indexOf("http")?request_fs(url,createImageAndCallBack):url?request(url,"binary",createImageAndCallBack):callback&&callback.call(context,url)},fabric.loadSVGFromURL=function(url,callback,reviver){url=url.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim(),0!==url.indexOf("http")?request_fs(url,function(body){fabric.loadSVGFromString(body,callback,reviver)}):request(url,"",function(body){fabric.loadSVGFromString(body,callback,reviver)})},fabric.loadSVGFromString=function(string,callback,reviver){var doc=(new DOMParser).parseFromString(string);fabric.parseSVGDocument(doc.documentElement,function(results,options){callback&&callback(results,options)},reviver)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.Image.fromObject=function(object,callback){fabric.util.loadImage(object.src,function(img){var oImg=new fabric.Image(img);oImg._initConfig(object),oImg._initFilters(object,function(filters){oImg.filters=filters||[],callback&&callback(oImg)})})},fabric.createCanvasForNode=function(width,height){var canvasEl=fabric.document.createElement("canvas"),nodeCanvas=new Canvas(width||600,height||600);canvasEl.style={},canvasEl.width=nodeCanvas.width,canvasEl.height=nodeCanvas.height;var FabricCanvas=fabric.Canvas||fabric.StaticCanvas,fabricCanvas=new FabricCanvas(canvasEl);return fabricCanvas.contextContainer=nodeCanvas.getContext("2d"),fabricCanvas.nodeCanvas=nodeCanvas,fabricCanvas.Font=Canvas.Font,fabricCanvas},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(opts){return this.nodeCanvas.createJPEGStream(opts)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(width){return origSetWidth.call(this,width),this.nodeCanvas.width=width,this},fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(height){return origSetHeight.call(this,height),this.nodeCanvas.height=height,this},fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}}(),window.Modernizr=function(a,b,c){function D(a){j.cssText=a}function E(a,b){return D(n.join(a+";")+(b||""))}function F(a,b){return typeof a===b}function G(a,b){return!!~(""+a).indexOf(b)}function H(a,b){for(var d in a){var e=a[d];if(!G(e,"-")&&j[e]!==c)return"pfx"==b?e:!0}return!1}function I(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:F(f,"function")?f.bind(d||b):f}return!1}function J(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+p.join(d+" ")+d).split(" ");return F(b,"string")||F(b,"undefined")?H(e,b):(e=(a+" "+q.join(d+" ")+d).split(" "),I(e,b,c))}function K(){e.input=function(c){for(var d=0,e=c.length;e>d;d++)u[c[d]]=c[d]in k;return u.list&&(u.list=!!b.createElement("datalist")&&!!a.HTMLDataListElement),u}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),e.inputtypes=function(a){for(var e,f,h,d=0,i=a.length;i>d;d++)k.setAttribute("type",f=a[d]),e="text"!==k.type,e&&(k.value=l,k.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(f)&&k.style.WebkitAppearance!==c?(g.appendChild(k),h=b.defaultView,e=h.getComputedStyle&&"textfield"!==h.getComputedStyle(k,null).WebkitAppearance&&0!==k.offsetHeight,g.removeChild(k)):/^(search|tel)$/.test(f)||(e=/^(url|email)$/.test(f)?k.checkValidity&&k.checkValidity()===!1:k.value!=l)),t[a[d]]=!!e;return t}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var x,C,d="2.6.2",e={},f=!0,g=b.documentElement,h="modernizr",i=b.createElement(h),j=i.style,k=b.createElement("input"),l=":)",m={}.toString,n=" -webkit- -moz- -o- -ms- ".split(" "),o="Webkit Moz O ms",p=o.split(" "),q=o.toLowerCase().split(" "),r={svg:"http://www.w3.org/2000/svg"},s={},t={},u={},v=[],w=v.slice,y=function(a,c,d,e){var f,i,j,k,l=b.createElement("div"),m=b.body,n=m||b.createElement("body");if(parseInt(d,10))for(;d--;)j=b.createElement("div"),j.id=e?e[d]:h+(d+1),l.appendChild(j);return f=["&#173;",'<style id="s',h,'">',a,"</style>"].join(""),l.id=h,(m?l:n).innerHTML+=f,n.appendChild(l),m||(n.style.background="",n.style.overflow="hidden",k=g.style.overflow,g.style.overflow="hidden",g.appendChild(n)),i=c(l,a),m?l.parentNode.removeChild(l):(n.parentNode.removeChild(n),g.style.overflow=k),!!i},z=function(b){var c=a.matchMedia||a.msMatchMedia;if(c)return c(b).matches;var d;return y("@media "+b+" { #"+h+" { position: absolute; } }",function(b){d="absolute"==(a.getComputedStyle?getComputedStyle(b,null):b.currentStyle).position}),d},A=function(){function d(d,e){e=e||b.createElement(a[d]||"div"),d="on"+d;var f=d in e;return f||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(d,""),f=F(e[d],"function"),F(e[d],"undefined")||(e[d]=c),e.removeAttribute(d))),e=null,f}var a={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return d}(),B={}.hasOwnProperty;C=F(B,"undefined")||F(B.call,"undefined")?function(a,b){return b in a&&F(a.constructor.prototype[b],"undefined")}:function(a,b){return B.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if("function"!=typeof c)throw new TypeError;var d=w.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(w.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(w.call(arguments)))};return e}),s.flexbox=function(){return J("flexWrap")},s.canvas=function(){var a=b.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")},s.canvastext=function(){return!!e.canvas&&!!F(b.createElement("canvas").getContext("2d").fillText,"function")},s.webgl=function(){return!!a.WebGLRenderingContext},s.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:y(["@media (",n.join("touch-enabled),("),h,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=9===a.offsetTop}),c},s.geolocation=function(){return"geolocation"in navigator},s.postmessage=function(){return!!a.postMessage},s.websqldatabase=function(){return!!a.openDatabase},s.indexedDB=function(){return!!J("indexedDB",a)},s.hashchange=function(){return A("hashchange",a)&&(b.documentMode===c||b.documentMode>7)},s.history=function(){return!!a.history&&!!history.pushState},s.draganddrop=function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},s.websockets=function(){return"WebSocket"in a||"MozWebSocket"in a},s.rgba=function(){return D("background-color:rgba(150,255,150,.5)"),G(j.backgroundColor,"rgba")},s.hsla=function(){return D("background-color:hsla(120,40%,100%,.5)"),G(j.backgroundColor,"rgba")||G(j.backgroundColor,"hsla")},s.multiplebgs=function(){return D("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(j.background)},s.backgroundsize=function(){return J("backgroundSize")},s.borderimage=function(){return J("borderImage")},s.borderradius=function(){return J("borderRadius")},s.boxshadow=function(){return J("boxShadow")},s.textshadow=function(){return""===b.createElement("div").style.textShadow},s.opacity=function(){return E("opacity:.55"),/^0.55$/.test(j.opacity)},s.cssanimations=function(){return J("animationName")},s.csscolumns=function(){return J("columnCount")},s.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";return D((a+"-webkit- ".split(" ").join(b+a)+n.join(c+a)).slice(0,-a.length)),G(j.backgroundImage,"gradient")},s.cssreflections=function(){return J("boxReflect")},s.csstransforms=function(){return!!J("transform")},s.csstransforms3d=function(){var a=!!J("perspective");return a&&"webkitPerspective"in g.style&&y("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b){a=9===b.offsetLeft&&3===b.offsetHeight}),a},s.csstransitions=function(){return J("transition")},s.fontface=function(){var a;return y('@font-face {font-family:"font";src:url("https://")}',function(c,d){var e=b.getElementById("smodernizr"),f=e.sheet||e.styleSheet,g=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"";a=/src/i.test(g)&&0===g.indexOf(d.split(" ")[0])}),a},s.generatedcontent=function(){var a;return y(["#",h,"{font:0/0 a}#",h,':after{content:"',l,'";visibility:hidden;font:3px/1 a}'].join(""),function(b){a=b.offsetHeight>=3}),a},s.video=function(){var a=b.createElement("video"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(d){}return c},s.audio=function(){var a=b.createElement("audio"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),c.mp3=a.canPlayType("audio/mpeg;").replace(/^no$/,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(d){}return c},s.localstorage=function(){try{return localStorage.setItem(h,h),localStorage.removeItem(h),!0}catch(a){return!1}},s.sessionstorage=function(){try{return sessionStorage.setItem(h,h),sessionStorage.removeItem(h),!0}catch(a){return!1}},s.webworkers=function(){return!!a.Worker},s.applicationcache=function(){return!!a.applicationCache},s.svg=function(){return!!b.createElementNS&&!!b.createElementNS(r.svg,"svg").createSVGRect},s.inlinesvg=function(){var a=b.createElement("div");return a.innerHTML="<svg/>",(a.firstChild&&a.firstChild.namespaceURI)==r.svg},s.smil=function(){return!!b.createElementNS&&/SVGAnimate/.test(m.call(b.createElementNS(r.svg,"animate")))},s.svgclippaths=function(){return!!b.createElementNS&&/SVGClipPath/.test(m.call(b.createElementNS(r.svg,"clipPath")))};for(var L in s)C(s,L)&&(x=L.toLowerCase(),e[x]=s[L](),v.push((e[x]?"":"no-")+x));return e.input||K(),e.addTest=function(a,b){if("object"==typeof a)for(var d in a)C(a,d)&&e.addTest(d,a[d]);else{if(a=a.toLowerCase(),e[a]!==c)return e;b="function"==typeof b?b():b,"undefined"!=typeof f&&f&&(g.className+=" "+(b?"":"no-")+a),e[a]=b}return e},D(""),i=k=null,function(a,b){function k(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function l(){var a=r.elements;return"string"==typeof a?a.split(" "):a}function m(a){var b=i[a[g]];return b||(b={},h++,a[g]=h,i[h]=b),b}function n(a,c,f){if(c||(c=b),j)return c.createElement(a);f||(f=m(c));var g;return g=f.cache[a]?f.cache[a].cloneNode():e.test(a)?(f.cache[a]=f.createElem(a)).cloneNode():f.createElem(a),g.canHaveChildren&&!d.test(a)?f.frag.appendChild(g):g}function o(a,c){if(a||(a=b),j)return a.createDocumentFragment();c=c||m(a);for(var d=c.frag.cloneNode(),e=0,f=l(),g=f.length;g>e;e++)d.createElement(f[e]);return d}function p(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return r.shivMethods?n(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+l().join().replace(/\w+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(r,b.frag)}function q(a){a||(a=b);var c=m(a);return r.shivCSS&&!f&&!c.hasCSS&&(c.hasCSS=!!k(a,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),j||p(a,c),a}var f,j,c=a.html5||{},d=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,e=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,g="_html5shiv",h=0,i={};!function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",f="hidden"in a,j=1==a.childNodes.length||function(){b.createElement("a");var a=b.createDocumentFragment();return"undefined"==typeof a.cloneNode||"undefined"==typeof a.createDocumentFragment||"undefined"==typeof a.createElement}()}catch(c){f=!0,j=!0}}();var r={elements:c.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:c.shivCSS!==!1,supportsUnknownElements:j,shivMethods:c.shivMethods!==!1,type:"default",shivDocument:q,createElement:n,createDocumentFragment:o};a.html5=r,q(b)}(this,b),e._version=d,e._prefixes=n,e._domPrefixes=q,e._cssomPrefixes=p,e.mq=z,e.hasEvent=A,e.testProp=function(a){return H([a])},e.testAllProps=J,e.testStyles=y,e.prefixed=function(a,b,c){return b?J(a,b,c):J(a,"pfx")},g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(f?" js "+v.join(" "):""),e}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==o.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=p.shift();q=1,a?a.t?m(function(){("c"==a.t?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&&g(l.readyState)&&(u.r=o=1,!q&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&m(function(){t.removeChild(l)},50);for(var d in y[c])y[c].hasOwnProperty(d)&&y[c][d].onload()}}var j=j||B.errorTimeout,l=b.createElement(a),o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};1===y[c]&&(r=1,y[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),"img"!=a&&(r||2===y[c]?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||"j",e(a)?i("c"==b?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),1==p.length&&h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var A,B,l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName("script")[0],o={}.toString,p=[],q=0,r="MozAppearance"in l.style,s=r&&!!b.createRange().compareNode,t=s?l:n.parentNode,l=a.opera&&"[object Opera]"==o.call(a.opera),l=!!b.attachEvent&&!l,u=r?"object":l?"script":"img",v=l?"script":u,w=Array.isArray||function(a){return"[object Array]"==o.call(a)},x=[],y={},z={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}};B=function(a){function b(a){var e,f,g,a=a.split("!"),b=x.length,c=a.pop(),d=a.length,c={url:c,origUrl:c,prefixes:a};for(f=0;d>f;f++)g=a[f].split("="),(e=z[g.shift()])&&(c=e(c,g));for(f=0;b>f;f++)c=x[f](c);return c}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(y[i.url]?i.noexec=!0:y[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),y[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var c,b=0;for(c in a)a.hasOwnProperty(c)&&b++;return b}(),a)a.hasOwnProperty(n)&&(!c&&!--m&&(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&&l()}var m,n,h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f;c(h?a.yep:a.nope,!!i),i&&c(i)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(w(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):w(j)?B(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",A=function(){b.removeEventListener("DOMContentLoaded",A,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var l,o,k=b.createElement("script"),e=e||B.errorTimeout;k.src=a;for(o in d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&&g(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},m(function(){l||(l=1,c(1))},e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var j,e=b.createElement("link"),c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},$(document).ready(function(){console.log("load page")});
//# sourceMappingURL=application.min.js.map